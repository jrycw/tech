<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Tech&#39;n&#39;Take</title>
<link>https://tech.ycwu.space/</link>
<atom:link href="https://tech.ycwu.space/index.xml" rel="self" type="application/rss+xml"/>
<description>This is Jerry Wu&#39;s Tech&#39;n&#39;take.</description>
<generator>quarto-1.7.31</generator>
<lastBuildDate>Mon, 26 May 2025 00:00:00 GMT</lastBuildDate>
<item>
  <title>Styling tricks in Great Tables</title>
  <dc:creator>Jerry Wu</dc:creator>
  <link>https://tech.ycwu.space/posts/styling-tricks-table-body/20250526.html</link>
  <description><![CDATA[ 





<p>This post highlights a powerful yet underused feature in Great Tables: using existing columns to style the table body via <a href="https://posit-dev.github.io/great-tables/reference/from_column.html">from_column()</a>.</p>
<p>Let’s say you have the following Polars DataFrame <code>df</code>:</p>
<div id="902ae5b0" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> polars <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pl</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> great_tables <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> GT, from_column, loc, style</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> great_tables.data <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> films</span>
<span id="cb1-4"></span>
<span id="cb1-5"></span>
<span id="cb1-6">df_style <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.DataFrame(</span>
<span id="cb1-7">    {</span>
<span id="cb1-8">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>: [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"papayawhip"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightblue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightgreen"</span>],</span>
<span id="cb1-9">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"size"</span>: [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"small"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x-large"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"medium"</span>],</span>
<span id="cb1-10">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight"</span>: [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lighter"</span>],</span>
<span id="cb1-11">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"align"</span>: [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>],</span>
<span id="cb1-12">    }</span>
<span id="cb1-13">)</span>
<span id="cb1-14"></span>
<span id="cb1-15">columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"run_time"</span>]</span>
<span id="cb1-16"></span>
<span id="cb1-17">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.concat(</span>
<span id="cb1-18">    [</span>
<span id="cb1-19">        pl.from_pandas(films.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>).loc[:, columns]),</span>
<span id="cb1-20">        df_style,</span>
<span id="cb1-21">    ],</span>
<span id="cb1-22">    how<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"horizontal"</span>,</span>
<span id="cb1-23">)</span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(df)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (3, 7)
┌──────┬───────────────────────────┬──────────┬────────────┬─────────┬─────────┬────────┐
│ year ┆ title                     ┆ run_time ┆ color      ┆ size    ┆ weight  ┆ align  │
│ ---  ┆ ---                       ┆ ---      ┆ ---        ┆ ---     ┆ ---     ┆ ---    │
│ i64  ┆ str                       ┆ str      ┆ str        ┆ str     ┆ str     ┆ str    │
╞══════╪═══════════════════════════╪══════════╪════════════╪═════════╪═════════╪════════╡
│ 1946 ┆ The Lovers                ┆ 1h 30m   ┆ papayawhip ┆ small   ┆ normal  ┆ right  │
│ 1946 ┆ Anna and the King of Siam ┆ 2h 8m    ┆ lightblue  ┆ x-large ┆ bold    ┆ center │
│ 1946 ┆ Blood and Fire            ┆ 1h 40m   ┆ lightgreen ┆ medium  ┆ lighter ┆ left   │
└──────┴───────────────────────────┴──────────┴────────────┴─────────┴─────────┴────────┘</code></pre>
</div>
</div>
<p>The <code>color</code>, <code>size</code>, <code>weight</code>, and <code>align</code> columns contain style-related metadata. We can use <code>from_column()</code> to map this metadata to four styling options provided by Great Tables—<a href="https://posit-dev.github.io/great-tables/reference/style.fill.html">style.fill()</a>, <a href="https://posit-dev.github.io/great-tables/reference/style.text.html">style.text()</a>, <a href="https://posit-dev.github.io/great-tables/reference/style.borders.html">style.borders()</a>, and <a href="https://posit-dev.github.io/great-tables/reference/style.css.html">style.css()</a>—all of which are built on the internal <code>CellStyle</code> class.</p>
<div id="f5147271" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">(</span>
<span id="cb3-2">    GT(df)</span>
<span id="cb3-3">    .tab_style(</span>
<span id="cb3-4">        style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb3-5">            style.fill(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>from_column(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>)),</span>
<span id="cb3-6">            style.text(</span>
<span id="cb3-7">                size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>from_column(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"size"</span>),</span>
<span id="cb3-8">                weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>from_column(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight"</span>),</span>
<span id="cb3-9">                align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>from_column(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"align"</span>),</span>
<span id="cb3-10">            ),</span>
<span id="cb3-11">        ],</span>
<span id="cb3-12">        locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body(columns),</span>
<span id="cb3-13">    )</span>
<span id="cb3-14">    .cols_hide(df_style.columns)</span>
<span id="cb3-15">    .opt_stylize(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>)</span>
<span id="cb3-16">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div id="exrbqsgvfa" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#exrbqsgvfa table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#exrbqsgvfa thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#exrbqsgvfa p { margin: 0; padding: 0; }
 #exrbqsgvfa .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #5F5F5F; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #5F5F5F; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #exrbqsgvfa .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #exrbqsgvfa .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #exrbqsgvfa .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #exrbqsgvfa .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #exrbqsgvfa .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #5F5F5F; }
 #exrbqsgvfa .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #5F5F5F; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #5F5F5F; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #exrbqsgvfa .gt_col_heading { color: #FFFFFF; background-color: #5F5F5F; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #exrbqsgvfa .gt_column_spanner_outer { color: #FFFFFF; background-color: #5F5F5F; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #exrbqsgvfa .gt_column_spanner_outer:first-child { padding-left: 0; }
 #exrbqsgvfa .gt_column_spanner_outer:last-child { padding-right: 0; }
 #exrbqsgvfa .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #5F5F5F; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #exrbqsgvfa .gt_spanner_row { border-bottom-style: hidden; }
 #exrbqsgvfa .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #5F5F5F; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #5F5F5F; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #exrbqsgvfa .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #5F5F5F; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #5F5F5F; vertical-align: middle; }
 #exrbqsgvfa .gt_from_md> :first-child { margin-top: 0; }
 #exrbqsgvfa .gt_from_md> :last-child { margin-bottom: 0; }
 #exrbqsgvfa .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: none; border-top-width: 1px; border-top-color: #D5D5D5; border-left-style: none; border-left-width: 1px; border-left-color: #D5D5D5; border-right-style: none; border-right-width: 1px; border-right-color: #D5D5D5; vertical-align: middle; overflow-x: hidden; }
 #exrbqsgvfa .gt_stub { color: #333333; background-color: #D5D5D5; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D5D5D5; padding-left: 5px; padding-right: 5px; }
 #exrbqsgvfa .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #exrbqsgvfa .gt_row_group_first td { border-top-width: 2px; }
 #exrbqsgvfa .gt_row_group_first th { border-top-width: 2px; }
 #exrbqsgvfa .gt_striped { background-color: #F4F4F4; }
 #exrbqsgvfa .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #5F5F5F; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #5F5F5F; }
 #exrbqsgvfa .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #exrbqsgvfa .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #exrbqsgvfa .gt_left { text-align: left; }
 #exrbqsgvfa .gt_center { text-align: center; }
 #exrbqsgvfa .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #exrbqsgvfa .gt_font_normal { font-weight: normal; }
 #exrbqsgvfa .gt_font_bold { font-weight: bold; }
 #exrbqsgvfa .gt_font_italic { font-style: italic; }
 #exrbqsgvfa .gt_super { font-size: 65%; }
 #exrbqsgvfa .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #exrbqsgvfa .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>

<tr class="gt_col_headings">
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="year">year</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="title">title</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="run_time">run_time</th>
</tr>
</thead>
<tbody class="gt_table_body">
  <tr>
    <td style="background-color: papayawhip; font-size: small;text-align: right;font-weight: normal;" class="gt_row gt_right">1946</td>
    <td style="background-color: papayawhip; font-size: small;text-align: right;font-weight: normal;" class="gt_row gt_left">The Lovers</td>
    <td style="background-color: papayawhip; font-size: small;text-align: right;font-weight: normal;" class="gt_row gt_left">1h 30m</td>
  </tr>
  <tr>
    <td style="background-color: lightblue; font-size: x-large;text-align: center;font-weight: bold;" class="gt_row gt_right gt_striped">1946</td>
    <td style="background-color: lightblue; font-size: x-large;text-align: center;font-weight: bold;" class="gt_row gt_left gt_striped">Anna and the King of Siam</td>
    <td style="background-color: lightblue; font-size: x-large;text-align: center;font-weight: bold;" class="gt_row gt_left gt_striped">2h 8m</td>
  </tr>
  <tr>
    <td style="background-color: lightgreen; font-size: medium;text-align: left;font-weight: lighter;" class="gt_row gt_right">1946</td>
    <td style="background-color: lightgreen; font-size: medium;text-align: left;font-weight: lighter;" class="gt_row gt_left">Blood and Fire</td>
    <td style="background-color: lightgreen; font-size: medium;text-align: left;font-weight: lighter;" class="gt_row gt_left">1h 40m</td>
  </tr>
</tbody>


</table>

</div>
        
</div>
</div>
<p><strong>One last note:</strong> <code>from_column()</code> works with both Pandas and Polars DataFrames. For Polars users, you can also pass expressions directly without wrapping them in <code>from_column()</code>. The following code produces the same styled table as shown above:</p>
<div id="c27f9302" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">(</span>
<span id="cb4-2">    GT(df)</span>
<span id="cb4-3">    .tab_style(</span>
<span id="cb4-4">        style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb4-5">            style.fill(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>)),</span>
<span id="cb4-6">            style.text(</span>
<span id="cb4-7">                size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"size"</span>), weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight"</span>), align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"align"</span>)</span>
<span id="cb4-8">            ),</span>
<span id="cb4-9">        ],</span>
<span id="cb4-10">        locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body(columns),</span>
<span id="cb4-11">    )</span>
<span id="cb4-12">    .cols_hide(df_style.columns)</span>
<span id="cb4-13">    .opt_stylize(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>)</span>
<span id="cb4-14">)</span></code></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Disclaimer
</div>
</div>
<div class="callout-body-container callout-body">
<p>This post was drafted by me, with AI assistance to refine the content.</p>
</div>
</div>



 ]]></description>
  <category>python</category>
  <category>pandas</category>
  <category>polars</category>
  <category>gt</category>
  <guid>https://tech.ycwu.space/posts/styling-tricks-table-body/20250526.html</guid>
  <pubDate>Mon, 26 May 2025 00:00:00 GMT</pubDate>
  <media:content url="https://tech.ycwu.space/posts/styling-tricks-table-body/table_body.png" medium="image" type="image/png" height="49" width="144"/>
</item>
<item>
  <title>case_when() in Polars</title>
  <dc:creator>Jerry Wu</dc:creator>
  <link>https://tech.ycwu.space/posts/casewhen-in-polars/20250525.html</link>
  <description><![CDATA[ 





<p>This is a follow-up to my <a href="../../posts/polars-custom-expr-namespace/20250417.html">previous post</a>.</p>
<p>While the conditional branching mechanism of <a href="https://docs.pola.rs/api/python/stable/reference/expressions/api/polars.when.html">pl.when().then().otherwise()</a> is quite powerful, I often find it a bit verbose—especially when the conditions are complex. In those cases, it becomes harder to validate the correctness of each branch at a glance.</p>
<p>On the other hand, I find the <a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.case_when.html">pd.Series.case_when()</a> pattern in Pandas slightly more concise and readable. However, I’ve always wished it supported a fallback mechanism like Polars’ <code>.otherwise()</code>.</p>
<p>In the end, I thought it would be interesting to borrow the concept behind <code>pd.Series.case_when()</code> and implement it as a standalone utility function in Polars.</p>
<section id="case_when" class="level2">
<h2 class="anchored" data-anchor-id="case_when"><code>case_when()</code></h2>
<p>The <code>case_when()</code> function accepts two arguments:</p>
<ul>
<li><code>caselist</code>: A list of two-element tuples, where the first item is the condition (used in <code>pl.when()</code>), and the second is the corresponding result expression (used in <code>.then()</code>).</li>
<li><code>otherwise</code>: A fallback expression used in <code>.otherwise()</code> if no conditions match.</li>
</ul>
<p>The given example demonstrates how <code>case_when()</code> can simplify conditional logic compared to the more verbose <code>pl.when().then().otherwise()</code> chain.</p>
<div id="762b03c1" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> functools <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> cache</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Any</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> polars <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pl</span>
<span id="cb1-5"></span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> case_when(</span>
<span id="cb1-8">    caselist: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">tuple</span>[pl.Expr, pl.Expr]], otherwise: pl.Expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb1-9">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.Expr:</span>
<span id="cb1-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Simplifies conditional logic in Polars by chaining multiple `when-then` expressions.</span></span>
<span id="cb1-12"></span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Parameters</span></span>
<span id="cb1-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    ----------</span></span>
<span id="cb1-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    caselist</span></span>
<span id="cb1-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        A list of (condition, value) pairs. Each condition is evaluated in order,</span></span>
<span id="cb1-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        and the corresponding value is returned when a condition is met.</span></span>
<span id="cb1-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    otherwise</span></span>
<span id="cb1-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        The fallback value to use if none of the conditions match.</span></span>
<span id="cb1-20"></span>
<span id="cb1-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Returns</span></span>
<span id="cb1-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    -------</span></span>
<span id="cb1-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    pl.Expr</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Examples:</span></span>
<span id="cb1-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    -------</span></span>
<span id="cb1-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    ```python</span></span>
<span id="cb1-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    import polars as pl</span></span>
<span id="cb1-29"></span>
<span id="cb1-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    df = pl.DataFrame({"x": [1, 2, 3, 4]})</span></span>
<span id="cb1-31"></span>
<span id="cb1-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    expr = case_when(</span></span>
<span id="cb1-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        caselist=[</span></span>
<span id="cb1-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            (pl.col("x") &lt; 2, pl.lit("small")),</span></span>
<span id="cb1-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            (pl.col("x") &lt; 4, pl.lit("medium"))</span></span>
<span id="cb1-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        ],</span></span>
<span id="cb1-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        otherwise=pl.lit("large"),</span></span>
<span id="cb1-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    ).alias("size")</span></span>
<span id="cb1-39"></span>
<span id="cb1-40"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    # This is equivalent to writing:</span></span>
<span id="cb1-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    # expr = (</span></span>
<span id="cb1-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    #     pl.when(pl.col("x") &lt; 2)</span></span>
<span id="cb1-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    #       .then(pl.lit("small"))</span></span>
<span id="cb1-44"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    #       .when(pl.col("x") &lt; 4)</span></span>
<span id="cb1-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    #       .then(pl.lit("medium"))</span></span>
<span id="cb1-46"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    #       .otherwise(pl.lit("large"))</span></span>
<span id="cb1-47"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    #       .alias("size")</span></span>
<span id="cb1-48"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    # )</span></span>
<span id="cb1-49"></span>
<span id="cb1-50"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    df.with_columns(expr)</span></span>
<span id="cb1-51"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    ```</span></span>
<span id="cb1-52"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    shape: (4, 2)</span></span>
<span id="cb1-53"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    ┌─────┬────────┐</span></span>
<span id="cb1-54"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    │ x   ┆ size   │</span></span>
<span id="cb1-55"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    │ --- ┆ ---    │</span></span>
<span id="cb1-56"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    │ i64 ┆ str    │</span></span>
<span id="cb1-57"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    ├─────┼────────┤</span></span>
<span id="cb1-58"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    │ 1   ┆ small  │</span></span>
<span id="cb1-59"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    │ 2   ┆ medium │</span></span>
<span id="cb1-60"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    │ 3   ┆ medium │</span></span>
<span id="cb1-61"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    │ 4   ┆ large  │</span></span>
<span id="cb1-62"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    └─────┴────────┘</span></span>
<span id="cb1-63"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb1-64">    case0, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cases <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> caselist</span>
<span id="cb1-65">    first_when, first_then <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> case0</span>
<span id="cb1-66"></span>
<span id="cb1-67">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># first</span></span>
<span id="cb1-68">    expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.when(first_when).then(first_then)</span>
<span id="cb1-69"></span>
<span id="cb1-70">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># middles</span></span>
<span id="cb1-71">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> when, then <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> cases:</span>
<span id="cb1-72">        expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr.when(when).then(then)</span>
<span id="cb1-73"></span>
<span id="cb1-74">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># last</span></span>
<span id="cb1-75">    expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr.otherwise(otherwise)</span>
<span id="cb1-76"></span>
<span id="cb1-77">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> expr</span></code></pre></div>
</div>
</section>
<section id="custom-expression-namespace" class="level2">
<h2 class="anchored" data-anchor-id="custom-expression-namespace">Custom Expression Namespace</h2>
<p>With <code>case_when()</code> in place, we can refactor the <code>DiscreteSplitter</code> expression namespace like this:</p>
<div id="2e82eb14" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@cache</span></span>
<span id="cb2-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> _mod_expr(n: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.Expr:</span>
<span id="cb2-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> pl.int_range(pl.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(), dtype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pl.UInt32).mod(n)</span>
<span id="cb2-4"></span>
<span id="cb2-5"></span>
<span id="cb2-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> _litify(lits: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[pl.lit]:</span>
<span id="cb2-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> [pl.lit(lit) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> lit <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> lits]</span>
<span id="cb2-8"></span>
<span id="cb2-9"></span>
<span id="cb2-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@pl.api.register_expr_namespace</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"spt"</span>)</span>
<span id="cb2-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> DiscreteSplitter:</span>
<span id="cb2-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, expr: pl.Expr) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb2-13">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr</span>
<span id="cb2-14"></span>
<span id="cb2-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> _get_expr(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, lits: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[Any], name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb2-16">        n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(lits)</span>
<span id="cb2-17">        mod_expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> _mod_expr(n)</span>
<span id="cb2-18">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>litified, litified_otherwise <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> _litify(lits)</span>
<span id="cb2-19">        caselist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [(mod_expr.eq(i), lit) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i, lit <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(litified)]</span>
<span id="cb2-20">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> case_when(caselist, litified_otherwise).alias(name)</span>
<span id="cb2-21"></span>
<span id="cb2-22">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> binarize(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, lit1: Any, lit2: Any, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"binarized"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.Expr:</span>
<span id="cb2-23">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.bucketize([lit1, lit2], name)</span>
<span id="cb2-24"></span>
<span id="cb2-25">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> trinarize(</span>
<span id="cb2-26">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, lit1: Any, lit2: Any, lit3: Any, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trinarized"</span></span>
<span id="cb2-27">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.Expr:</span>
<span id="cb2-28">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.bucketize([lit1, lit2, lit3], name)</span>
<span id="cb2-29"></span>
<span id="cb2-30">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> bucketize(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, lits: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[Any], name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bucketized"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.Expr:</span>
<span id="cb2-31">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._get_expr(lits, name)</span></code></pre></div>
</div>
<p>Now, <code>bucketize()</code> is the primary method that encapsulates the core logic for categorical mapping. <code>binarize()</code> and <code>trinarize()</code> are just convenient wrappers for common cases.</p>
<p>Here’s a simple example of using the custom expression namespace:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb3-2">    pl.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">97</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">77</span>]})</span>
<span id="cb3-3">    .with_row_index(offset<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-4">    .with_columns(</span>
<span id="cb3-5">        pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>).spt.binarize(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightblue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"papayawhip"</span>),</span>
<span id="cb3-6">        pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>).spt.trinarize(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"one"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"three"</span>),</span>
<span id="cb3-7">        pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>).spt.bucketize([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]),</span>
<span id="cb3-8">    )</span>
<span id="cb3-9">)</span></code></pre></div>
<pre><code>shape: (9, 5)
┌───────┬─────┬────────────┬────────────┬────────────┐
│ index ┆ n   ┆ binarized  ┆ trinarized ┆ bucketized │
│ ---   ┆ --- ┆ ---        ┆ ---        ┆ ---        │
│ u32   ┆ i64 ┆ str        ┆ str        ┆ i32        │
╞═══════╪═════╪════════════╪════════════╪════════════╡
│ 1     ┆ 100 ┆ lightblue  ┆ one        ┆ 1          │
│ 2     ┆ 50  ┆ papayawhip ┆ two        ┆ 2          │
│ 3     ┆ 72  ┆ lightblue  ┆ three      ┆ 3          │
│ 4     ┆ 83  ┆ papayawhip ┆ one        ┆ 4          │
│ 5     ┆ 97  ┆ lightblue  ┆ two        ┆ 1          │
│ 6     ┆ 42  ┆ papayawhip ┆ three      ┆ 2          │
│ 7     ┆ 20  ┆ lightblue  ┆ one        ┆ 3          │
│ 8     ┆ 51  ┆ papayawhip ┆ two        ┆ 4          │
│ 9     ┆ 77  ┆ lightblue  ┆ three      ┆ 1          │
└───────┴─────┴────────────┴────────────┴────────────┘</code></pre>
</section>
<section id="custom-dataframe-namespace" class="level2">
<h2 class="anchored" data-anchor-id="custom-dataframe-namespace">Custom DataFrame Namespace</h2>
<p>Instead of relying on <a href="https://docs.pola.rs/api/python/stable/reference/dataframe/api/polars.DataFrame.with_row_index.html">pl.DataFrame.with_row_index()</a>, we can also use <code>_mod_expr()</code> directly to enable similar categorization.</p>
<p>Here’s how the <code>DiscreteSplitter</code> can be implemented as a custom DataFrame namespace:</p>
<div id="300aad6e" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@pl.api.register_dataframe_namespace</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"spt"</span>)</span>
<span id="cb5-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> DiscreteSplitter:</span>
<span id="cb5-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, df: pl.DataFrame) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb5-4">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df</span>
<span id="cb5-5"></span>
<span id="cb5-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> _get_expr(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, lits: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[Any], name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb5-7">        n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(lits)</span>
<span id="cb5-8">        mod_expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> _mod_expr(n)</span>
<span id="cb5-9">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>litified, litified_otherwise <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> _litify(lits)</span>
<span id="cb5-10">        caselist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [(mod_expr.eq(i), lit) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i, lit <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(litified)]</span>
<span id="cb5-11">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> case_when(caselist, litified_otherwise).alias(name)</span>
<span id="cb5-12"></span>
<span id="cb5-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> _get_final_df(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, lits: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[Any], name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="cb5-14">        cls <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">type</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>)</span>
<span id="cb5-15">        expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._get_expr(lits, name)</span>
<span id="cb5-16">        new_spt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cls(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._df.with_columns(expr))</span>
<span id="cb5-17">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> new_spt._df</span>
<span id="cb5-18"></span>
<span id="cb5-19">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> binarize(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, lit1: Any, lit2: Any, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"binarized"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="cb5-20">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.bucketize([lit1, lit2], name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>name)</span>
<span id="cb5-21"></span>
<span id="cb5-22">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> trinarize(</span>
<span id="cb5-23">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, lit1: Any, lit2: Any, lit3: Any, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trinarized"</span></span>
<span id="cb5-24">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="cb5-25">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.bucketize([lit1, lit2, lit3], name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>name)</span>
<span id="cb5-26"></span>
<span id="cb5-27">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> bucketize(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, lits: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[Any], name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bucketized"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="cb5-28">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._get_final_df(lits, name)</span></code></pre></div>
</div>
<p>Example usage:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb6-2">    pl.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">97</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">77</span>]})</span>
<span id="cb6-3">    .spt.binarize(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightblue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"papayawhip"</span>)</span>
<span id="cb6-4">    .spt.trinarize(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"one"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"three"</span>)</span>
<span id="cb6-5">    .spt.bucketize([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>])</span>
<span id="cb6-6">    .with_row_index(offset<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-7">)</span></code></pre></div>
<pre><code>shape: (9, 5)
┌───────┬─────┬────────────┬────────────┬────────────┐
│ index ┆ n   ┆ binarized  ┆ trinarized ┆ bucketized │
│ ---   ┆ --- ┆ ---        ┆ ---        ┆ ---        │
│ u32   ┆ i64 ┆ str        ┆ str        ┆ i32        │
╞═══════╪═════╪════════════╪════════════╪════════════╡
│ 1     ┆ 100 ┆ lightblue  ┆ one        ┆ 1          │
│ 2     ┆ 50  ┆ papayawhip ┆ two        ┆ 2          │
│ 3     ┆ 72  ┆ lightblue  ┆ three      ┆ 3          │
│ 4     ┆ 83  ┆ papayawhip ┆ one        ┆ 4          │
│ 5     ┆ 97  ┆ lightblue  ┆ two        ┆ 1          │
│ 6     ┆ 42  ┆ papayawhip ┆ three      ┆ 2          │
│ 7     ┆ 20  ┆ lightblue  ┆ one        ┆ 3          │
│ 8     ┆ 51  ┆ papayawhip ┆ two        ┆ 4          │
│ 9     ┆ 77  ┆ lightblue  ┆ three      ┆ 1          │
└───────┴─────┴────────────┴────────────┴────────────┘</code></pre>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Extracting the conditional logic into a standalone <code>case_when()</code> function turned out to be both a practical and satisfying exercise—perfect for a rainy afternoon of coding. It not only improves readability but also makes the branching logic easier to reuse and reason about.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Disclaimer
</div>
</div>
<div class="callout-body-container callout-body">
<p>This post was drafted by me, with AI assistance to refine the content.</p>
</div>
</div>


</section>

 ]]></description>
  <category>python</category>
  <category>polars</category>
  <guid>https://tech.ycwu.space/posts/casewhen-in-polars/20250525.html</guid>
  <pubDate>Sun, 25 May 2025 00:00:00 GMT</pubDate>
  <media:content url="https://tech.ycwu.space/posts/casewhen-in-polars/code.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Custom Row Selector in Great Tables</title>
  <dc:creator>Jerry Wu</dc:creator>
  <link>https://tech.ycwu.space/posts/gt-row-selector/20250511.html</link>
  <description><![CDATA[ 





<p>This short post shows how we can create custom row selectors in Great Tables by leveraging the row index. While <a href="https://github.com/posit-dev/great-tables/issues/678">it</a> may or may not be adopted by the team, I thought it would be fun to document it here on the blog.</p>
<p>I recently created a utility called <a href="https://github.com/posit-dev/great-tables/compare/main...jrycw:great-tables:feat-every_n_row">every_n_row()</a>, designed to work with both Pandas and Polars DataFrames (support for <code>pyarrow</code> is still under investigation). With <code>every_n_row()</code>, we can easily target alternating rows—for example, select odd rows using <code>every_n_row(2)</code> and even rows using either <code>every_n_row(2, 1)</code> or <code>~every_n_row(2)</code>.</p>
<div id="67432712" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> polars <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pl</span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> great_tables <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> GT, every_n_row, loc, style</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> great_tables.data <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> countrypops</span>
<span id="cb1-5"></span>
<span id="cb1-6">df_pd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> countrypops.sample(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>).loc[:, [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"country_name"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"population"</span>]]</span>
<span id="cb1-7">df_pl <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.from_pandas(df_pd)</span>
<span id="cb1-8"></span>
<span id="cb1-9">(</span>
<span id="cb1-10">    GT(df_pd)</span>
<span id="cb1-11">    .tab_style(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.fill(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightblue"</span>), locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body(rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>every_n_row(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)))</span>
<span id="cb1-12">    .tab_style(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.fill(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"papayawhip"</span>), locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body(rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>every_n_row(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)))</span>
<span id="cb1-13">    .opt_stylize(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pink"</span>)</span>
<span id="cb1-14">)</span>
<span id="cb1-15"></span>
<span id="cb1-16">(</span>
<span id="cb1-17">    GT(df_pl)</span>
<span id="cb1-18">    .tab_style(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.fill(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightblue"</span>), locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body(rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>every_n_row(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)))</span>
<span id="cb1-19">    .tab_style(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.fill(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"papayawhip"</span>), locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body(rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=~</span>every_n_row(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)))</span>
<span id="cb1-20">    .opt_stylize(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pink"</span>)</span>
<span id="cb1-21">)</span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tech.ycwu.space/posts/gt-row-selector/every_n_row.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Row Selector: every_n_row"></p>
</figure>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Disclaimer
</div>
</div>
<div class="callout-body-container callout-body">
<p>This post was drafted by me, with AI assistance to refine the content.</p>
</div>
</div>



 ]]></description>
  <category>python</category>
  <category>pandas</category>
  <category>polars</category>
  <category>gt</category>
  <guid>https://tech.ycwu.space/posts/gt-row-selector/20250511.html</guid>
  <pubDate>Sun, 11 May 2025 00:00:00 GMT</pubDate>
  <media:content url="https://tech.ycwu.space/posts/gt-row-selector/every_n_row.png" medium="image" type="image/png" height="112" width="144"/>
</item>
<item>
  <title>Polars Custom Expression Namespace</title>
  <dc:creator>Jerry Wu</dc:creator>
  <link>https://tech.ycwu.space/posts/polars-custom-expr-namespace/20250417.html</link>
  <description><![CDATA[ 





<p>Today I explored how to register a <strong>custom expression namespace</strong> in Polars. This feature turned out to be super helpful for solving a common problem I run into when building tables or plots—<strong>colorizing rows based on their row index</strong>.</p>
<p>Here is the code snippet: <img src="https://tech.ycwu.space/posts/polars-custom-expr-namespace/code.png" class="img-fluid quarto-figure quarto-figure-center" alt="Code Snippet"></p>
<div id="9c5b62be" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Show full code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Any</span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> polars <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pl</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> great_tables <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> GT, loc, style</span>
<span id="cb1-5"></span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@pl.api.register_expr_namespace</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"spt"</span>)</span>
<span id="cb1-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> DiscreteSplitter:</span>
<span id="cb1-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, expr: pl.Expr) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb1-10">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr</span>
<span id="cb1-11"></span>
<span id="cb1-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> _mod_expr(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, n: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.Expr:</span>
<span id="cb1-13">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> pl.int_range(pl.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(), dtype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pl.UInt32).mod(n)</span>
<span id="cb1-14"></span>
<span id="cb1-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> binarize(</span>
<span id="cb1-16">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, lit1: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, lit2: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"binarized"</span></span>
<span id="cb1-17">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.Expr:</span>
<span id="cb1-18">        mod_expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._mod_expr(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb1-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb1-20">            pl.when(mod_expr.eq(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb1-21">            .then(pl.lit(lit1))</span>
<span id="cb1-22">            .otherwise(pl.lit(lit2))</span>
<span id="cb1-23">            .alias(name)</span>
<span id="cb1-24">        )</span>
<span id="cb1-25"></span>
<span id="cb1-26">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> trinarize(</span>
<span id="cb1-27">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, lit1: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, lit2: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, lit3: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trinarized"</span></span>
<span id="cb1-28">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.Expr:</span>
<span id="cb1-29">        mod_expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._mod_expr(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb1-30">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb1-31">            pl.when(mod_expr.eq(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb1-32">            .then(pl.lit(lit1))</span>
<span id="cb1-33">            .when(mod_expr.eq(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb1-34">            .then(pl.lit(lit2))</span>
<span id="cb1-35">            .otherwise(pl.lit(lit3))</span>
<span id="cb1-36">            .alias(name)</span>
<span id="cb1-37">        )</span>
<span id="cb1-38"></span>
<span id="cb1-39">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> bucketize(</span>
<span id="cb1-40">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, lits: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[Any], name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bucketized"</span></span>
<span id="cb1-41">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.Expr:</span>
<span id="cb1-42">        mod_expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._mod_expr(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(lits))</span>
<span id="cb1-43"></span>
<span id="cb1-44">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># first</span></span>
<span id="cb1-45">        expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.when(mod_expr.eq(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)).then(pl.lit(lits[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]))</span>
<span id="cb1-46"></span>
<span id="cb1-47">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># middles</span></span>
<span id="cb1-48">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i, one_lit <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(lits[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb1-49">            expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr.when(mod_expr.eq(i)).then(pl.lit(one_lit))</span>
<span id="cb1-50"></span>
<span id="cb1-51">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># last</span></span>
<span id="cb1-52">        expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr.otherwise(pl.lit(lits[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]))</span>
<span id="cb1-53">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> expr.alias(name)</span>
<span id="cb1-54"></span>
<span id="cb1-55"></span>
<span id="cb1-56">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb1-57">    pl.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">97</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">77</span>]})</span>
<span id="cb1-58">    .with_row_index(offset<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-59">    .with_columns(</span>
<span id="cb1-60">        pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>).spt.binarize(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightblue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"papayawhip"</span>),</span>
<span id="cb1-61">        pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>).spt.trinarize(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"one"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"three"</span>),</span>
<span id="cb1-62">        pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>).spt.bucketize([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]),</span>
<span id="cb1-63">    )</span>
<span id="cb1-64">)</span>
<span id="cb1-65"></span>
<span id="cb1-66">(</span>
<span id="cb1-67">    GT(df)</span>
<span id="cb1-68">    .tab_style(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.fill(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"binarized"</span>)), locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body())</span>
<span id="cb1-69">    .opt_stylize(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb1-70">)</span></code></pre></div>
</details>
</div>
<section id="step-by-step-breakdown" class="level2">
<h2 class="anchored" data-anchor-id="step-by-step-breakdown">Step-by-Step Breakdown</h2>
<section id="registering-the-namespace" class="level3">
<h3 class="anchored" data-anchor-id="registering-the-namespace">Registering the Namespace</h3>
<p>We use <a href="https://docs.pola.rs/api/python/stable/reference/api/polars.api.register_expr_namespace.html"><code>pl.api.register_expr_namespace()</code></a> to attach our class to the <code>spt</code> namespace. Once registered, we can call our methods like this: <code>pl.col("any").spt.binarize(...)</code>.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@pl.api.register_expr_namespace</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"spt"</span>)</span>
<span id="cb2-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> DiscreteSplitter:</span>
<span id="cb2-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, expr: pl.Expr) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb2-4">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr</span></code></pre></div>
</section>
<section id="helper-row-index-based-modulo-expression" class="level3">
<h3 class="anchored" data-anchor-id="helper-row-index-based-modulo-expression">Helper: Row-Index Based Modulo Expression</h3>
<p>To assign values based on row position, we need a way to refer to the row index inside an expression. Polars provides a trick using <code>pl.int_range(pl.len())</code>, as shown in <a href="https://docs.pola.rs/api/python/stable/reference/dataframe/api/polars.DataFrame.with_row_index.html">pl.DataFrame.with_row_index()</a>.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@pl.api.register_expr_namespace</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"spt"</span>)</span>
<span id="cb3-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> DiscreteSplitter:</span>
<span id="cb3-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> _mod_expr(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, n: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.Expr:</span>
<span id="cb3-4">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> pl.int_range(pl.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(), dtype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pl.UInt32).mod(n)</span></code></pre></div>
</section>
<section id="binarize-two-groups" class="level3">
<h3 class="anchored" data-anchor-id="binarize-two-groups"><code>binarize</code>: Two Groups</h3>
<p>This method maps alternating rows into two categories using <a href="https://docs.pola.rs/api/python/stable/reference/expressions/api/polars.when.html#polars.when">pl.when().then().otherwise()</a>.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@pl.api.register_expr_namespace</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"spt"</span>)</span>
<span id="cb4-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> DiscreteSplitter:</span>
<span id="cb4-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> binarize(</span>
<span id="cb4-4">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, lit1: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, lit2: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"binarized"</span></span>
<span id="cb4-5">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.Expr:</span>
<span id="cb4-6">        mod_expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._mod_expr(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb4-7">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb4-8">            pl.when(mod_expr.eq(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb4-9">            .then(pl.lit(lit1))</span>
<span id="cb4-10">            .otherwise(pl.lit(lit2))</span>
<span id="cb4-11">            .alias(name)</span>
<span id="cb4-12">        )</span></code></pre></div>
</section>
<section id="trinarize-three-groups" class="level3">
<h3 class="anchored" data-anchor-id="trinarize-three-groups"><code>trinarize</code>: Three Groups</h3>
<p>Similar to <code>binarize</code>, but splits the rows into three groups using two <code>when().then()</code> branches before the final <code>otherwise()</code>.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@pl.api.register_expr_namespace</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"spt"</span>)</span>
<span id="cb5-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> DiscreteSplitter:</span>
<span id="cb5-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> trinarize(</span>
<span id="cb5-4">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, lit1: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, lit2: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, lit3: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trinarized"</span></span>
<span id="cb5-5">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.Expr:</span>
<span id="cb5-6">        mod_expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._mod_expr(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb5-7">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb5-8">            pl.when(mod_expr.eq(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb5-9">            .then(pl.lit(lit1))</span>
<span id="cb5-10">            .when(mod_expr.eq(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb5-11">            .then(pl.lit(lit2))</span>
<span id="cb5-12">            .otherwise(pl.lit(lit3))</span>
<span id="cb5-13">            .alias(name)</span>
<span id="cb5-14">        )</span></code></pre></div>
</section>
<section id="bucketize-n-groups" class="level3">
<h3 class="anchored" data-anchor-id="bucketize-n-groups"><code>bucketize</code>: N Groups</h3>
<p>A generalized version of the above, which dynamically assigns values from a list across <code>n</code> groups:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@pl.api.register_expr_namespace</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"spt"</span>)</span>
<span id="cb6-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> DiscreteSplitter:</span>
<span id="cb6-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> bucketize(</span>
<span id="cb6-4">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, lits: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[Any], name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bucketized"</span></span>
<span id="cb6-5">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.Expr:</span>
<span id="cb6-6">        mod_expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._mod_expr(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(lits))</span>
<span id="cb6-7"></span>
<span id="cb6-8">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># first</span></span>
<span id="cb6-9">        expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.when(mod_expr.eq(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)).then(pl.lit(lits[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]))</span>
<span id="cb6-10"></span>
<span id="cb6-11">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># middles</span></span>
<span id="cb6-12">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i, one_lit <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(lits[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb6-13">            expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr.when(mod_expr.eq(i)).then(pl.lit(one_lit))</span>
<span id="cb6-14"></span>
<span id="cb6-15">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># last</span></span>
<span id="cb6-16">        expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr.otherwise(pl.lit(lits[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]))</span>
<span id="cb6-17">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> expr.alias(name)</span></code></pre></div>
</section>
<section id="example-usage" class="level3">
<h3 class="anchored" data-anchor-id="example-usage">Example Usage</h3>
<p>Here’s a simple example that demonstrates how the custom namespace works in practice:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb7-2">    pl.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">97</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">77</span>]})</span>
<span id="cb7-3">    .with_row_index(offset<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb7-4">    .with_columns(</span>
<span id="cb7-5">        pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>).spt.binarize(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightblue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"papayawhip"</span>),</span>
<span id="cb7-6">        pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>).spt.trinarize(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"one"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"three"</span>),</span>
<span id="cb7-7">        pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>).spt.bucketize([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]),</span>
<span id="cb7-8">    )</span>
<span id="cb7-9">)</span></code></pre></div>
<p>This produces the following DataFrame:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">shape: (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb8-2">┌───────┬─────┬────────────┬────────────┬────────────┐</span>
<span id="cb8-3">│ index ┆ n   ┆ binarized  ┆ trinarized ┆ bucketized │</span>
<span id="cb8-4">│ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span>   ┆ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span> ┆ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span>        ┆ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span>        ┆ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span>        │</span>
<span id="cb8-5">│ u32   ┆ i64 ┆ <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>        ┆ <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>        ┆ i32        │</span>
<span id="cb8-6">╞═══════╪═════╪════════════╪════════════╪════════════╡</span>
<span id="cb8-7">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>     ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> ┆ lightblue  ┆ one        ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>          │</span>
<span id="cb8-8">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>     ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>  ┆ papayawhip ┆ two        ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>          │</span>
<span id="cb8-9">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>     ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>  ┆ lightblue  ┆ three      ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>          │</span>
<span id="cb8-10">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>     ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span>  ┆ papayawhip ┆ one        ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>          │</span>
<span id="cb8-11">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>     ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">97</span>  ┆ lightblue  ┆ two        ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>          │</span>
<span id="cb8-12">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>     ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>  ┆ papayawhip ┆ three      ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>          │</span>
<span id="cb8-13">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>     ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>  ┆ lightblue  ┆ one        ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>          │</span>
<span id="cb8-14">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>     ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>  ┆ papayawhip ┆ two        ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>          │</span>
<span id="cb8-15">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>     ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">77</span>  ┆ lightblue  ┆ three      ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>          │</span>
<span id="cb8-16">└───────┴─────┴────────────┴────────────┴────────────┘</span></code></pre></div>
<p>Note: Since the custom logic is based on the row index rather than actual column values, you can safely use <code>pl.col("")</code> as a placeholder when calling the namespace methods.</p>
<p>Each new column shows how rows are grouped using the row index modulo 2, 3, or 4—useful for highlighting patterns or applying styling.</p>
<p>For instance, you can use the <code>binarized</code> column with Great Tables like this:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">(</span>
<span id="cb9-2">    GT(df)</span>
<span id="cb9-3">    .tab_style(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.fill(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"binarized"</span>)), locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body())</span>
<span id="cb9-4">    .opt_stylize(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb9-5">)</span></code></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tech.ycwu.space/posts/polars-custom-expr-namespace/gt.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Table with alternating row colors"></p>
</figure>
</div>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">Conclusion</h3>
<p>Registering a custom expression namespace in Polars is a powerful way to encapsulate and reuse logic across your codebase. In this post, we created a <code>DiscreteSplitter</code> class to simplify index-based grouping, enabling operations like <code>binarize</code>, <code>trinarize</code>, and <code>bucketize</code>. This approach keeps your expressions clean and composable, especially when generating tables or plots that require styling based on row position.</p>
<p>It’s also worth noting that Polars supports similar registration for Series, LazyFrame, and DataFrame objects—check out the <a href="https://docs.pola.rs/api/python/stable/reference/api.html">official documentation</a> for more details.</p>
</section>
<section id="remark" class="level3">
<h3 class="anchored" data-anchor-id="remark">Remark</h3>
<p>Here’s a rough draft showing how to achieve a similar effect using the DataFrame namespace. I might revisit and refine this approach in the future.</p>
<div id="0ddb2279" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show full code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Any</span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> polars <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pl</span>
<span id="cb10-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> great_tables <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> GT, loc, style</span>
<span id="cb10-5"></span>
<span id="cb10-6"></span>
<span id="cb10-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@pl.api.register_dataframe_namespace</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"spt"</span>)</span>
<span id="cb10-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> DiscreteSplitter:</span>
<span id="cb10-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, df: pl.DataFrame) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb10-10">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df</span>
<span id="cb10-11">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._mod_colname <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mod"</span></span>
<span id="cb10-12">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._mod_col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.col(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._mod_colname)</span>
<span id="cb10-13">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._idx_colname <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index"</span></span>
<span id="cb10-14">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._idx_col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.col(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._idx_colname)</span>
<span id="cb10-15"></span>
<span id="cb10-16">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> _get_df(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, n: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="cb10-17">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._df.with_row_index(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._idx_colname).with_columns(</span>
<span id="cb10-18">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._idx_col.mod(n).alias(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._mod_colname)</span>
<span id="cb10-19">        )</span>
<span id="cb10-20"></span>
<span id="cb10-21">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> _get_final_df(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, n: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>, expr: pl.Expr) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="cb10-22">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb10-23">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._get_df(n)</span>
<span id="cb10-24">            .with_columns(expr)</span>
<span id="cb10-25">            .drop([<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._idx_colname, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._mod_colname])</span>
<span id="cb10-26">        )</span>
<span id="cb10-27"></span>
<span id="cb10-28">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> binarize(</span>
<span id="cb10-29">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, lit1: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, lit2: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"binarized"</span></span>
<span id="cb10-30">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="cb10-31">        n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb10-32"></span>
<span id="cb10-33">        expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb10-34">            pl.when(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._mod_col.eq(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb10-35">            .then(pl.lit(lit1))</span>
<span id="cb10-36">            .otherwise(pl.lit(lit2))</span>
<span id="cb10-37">            .alias(name)</span>
<span id="cb10-38">        )</span>
<span id="cb10-39"></span>
<span id="cb10-40">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._get_final_df(n, expr)</span>
<span id="cb10-41">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._df</span>
<span id="cb10-42"></span>
<span id="cb10-43">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> trinarize(</span>
<span id="cb10-44">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, lit1: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, lit2: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, lit3: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trinarized"</span></span>
<span id="cb10-45">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="cb10-46">        n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb10-47"></span>
<span id="cb10-48">        expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb10-49">            pl.when(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._mod_col.eq(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb10-50">            .then(pl.lit(lit1))</span>
<span id="cb10-51">            .when(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._mod_col.eq(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb10-52">            .then(pl.lit(lit2))</span>
<span id="cb10-53">            .otherwise(pl.lit(lit3))</span>
<span id="cb10-54">            .alias(name)</span>
<span id="cb10-55">        )</span>
<span id="cb10-56"></span>
<span id="cb10-57">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._get_final_df(n, expr)</span>
<span id="cb10-58">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._df</span>
<span id="cb10-59"></span>
<span id="cb10-60">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> bucketize(</span>
<span id="cb10-61">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, lits: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[Any], name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bucketized"</span></span>
<span id="cb10-62">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="cb10-63">        n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(lits)</span>
<span id="cb10-64"></span>
<span id="cb10-65">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># first</span></span>
<span id="cb10-66">        expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.when(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._mod_col.eq(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)).then(pl.lit(lits[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]))</span>
<span id="cb10-67"></span>
<span id="cb10-68">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># middles</span></span>
<span id="cb10-69">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i, one_lit <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(lits[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb10-70">            expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr.when(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._mod_col.eq(i)).then(pl.lit(one_lit))</span>
<span id="cb10-71"></span>
<span id="cb10-72">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># last</span></span>
<span id="cb10-73">        expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr.otherwise(pl.lit(lits[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]))</span>
<span id="cb10-74"></span>
<span id="cb10-75">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># alias</span></span>
<span id="cb10-76">        expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr.alias(name)</span>
<span id="cb10-77"></span>
<span id="cb10-78">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._get_final_df(n, expr)</span>
<span id="cb10-79">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._df</span>
<span id="cb10-80"></span>
<span id="cb10-81"></span>
<span id="cb10-82">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb10-83">    pl.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">97</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">77</span>]})</span>
<span id="cb10-84">    .spt.binarize(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightblue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"papayawhip"</span>)</span>
<span id="cb10-85">    .spt.trinarize(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"one"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"three"</span>)</span>
<span id="cb10-86">    .spt.bucketize([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>])</span>
<span id="cb10-87">    .with_row_index(offset<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-88">)</span>
<span id="cb10-89"></span>
<span id="cb10-90">(</span>
<span id="cb10-91">    GT(df)</span>
<span id="cb10-92">    .tab_style(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.fill(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"binarized"</span>)), locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body())</span>
<span id="cb10-93">    .opt_stylize(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb10-94">)</span></code></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Disclaimer
</div>
</div>
<div class="callout-body-container callout-body">
<p>This post was drafted by me, with AI assistance to refine the content.</p>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>python</category>
  <category>polars</category>
  <guid>https://tech.ycwu.space/posts/polars-custom-expr-namespace/20250417.html</guid>
  <pubDate>Thu, 17 Apr 2025 00:00:00 GMT</pubDate>
  <media:content url="https://tech.ycwu.space/posts/polars-custom-expr-namespace/code.png" medium="image" type="image/png" height="205" width="144"/>
</item>
<item>
  <title>Clone the Reciprocal Tariffs Table Using Plotnine</title>
  <dc:creator>Jerry Wu</dc:creator>
  <link>https://tech.ycwu.space/posts/clone-reciprocal-tariffs-table-p9/20250416.html</link>
  <description><![CDATA[ 





<p>This post presents a recreated visualization using Polars and plotnine, based on my <a href="../../posts/clone-reciprocal-tariffs-table/20250403.html">earlier work</a>.</p>
<p>Below is the final figure: <img src="https://tech.ycwu.space/posts/clone-reciprocal-tariffs-table-p9/reciprocal_tariffs_p9.png" class="img-fluid quarto-figure quarto-figure-center" alt="Cloned Reciprocal Tariffs Table"></p>
<div id="23436daf" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Show full code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> polars <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pl</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> matplotlib.figure <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Figure</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> plotnine <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> (</span>
<span id="cb1-4">    aes,</span>
<span id="cb1-5">    element_blank,</span>
<span id="cb1-6">    element_rect,</span>
<span id="cb1-7">    element_text,</span>
<span id="cb1-8">    geom_segment,</span>
<span id="cb1-9">    geom_text,</span>
<span id="cb1-10">    ggplot,</span>
<span id="cb1-11">    position_nudge,</span>
<span id="cb1-12">    scale_color_identity,</span>
<span id="cb1-13">    scale_size_identity,</span>
<span id="cb1-14">    scale_y_discrete,</span>
<span id="cb1-15">    theme,</span>
<span id="cb1-16">    theme_void,</span>
<span id="cb1-17">    watermark,</span>
<span id="cb1-18">)</span>
<span id="cb1-19"></span>
<span id="cb1-20"></span>
<span id="cb1-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># source1: https://truthsocial.com/@realDonaldTrump/114270398531479278</span></span>
<span id="cb1-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># source2:</span></span>
<span id="cb1-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># "https://upload.wikimedia.org/wikipedia/commons/</span></span>
<span id="cb1-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># thumb/3/36/Seal_of_the_President_of_the_United_States.svg/</span></span>
<span id="cb1-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 800px-Seal_of_the_President_of_the_United_States.svg.png"</span></span>
<span id="cb1-26">logo_filename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"logo_resized.png"</span></span>
<span id="cb1-27"></span>
<span id="cb1-28">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb1-29">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"country"</span>: [</span>
<span id="cb1-30">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"China"</span>,</span>
<span id="cb1-31">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"European Union"</span>,</span>
<span id="cb1-32">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vietnam"</span>,</span>
<span id="cb1-33">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Taiwan"</span>,</span>
<span id="cb1-34">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Japan"</span>,</span>
<span id="cb1-35">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"India"</span>,</span>
<span id="cb1-36">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"South Korea"</span>,</span>
<span id="cb1-37">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Thailand"</span>,</span>
<span id="cb1-38">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Switzerland"</span>,</span>
<span id="cb1-39">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Indonesia"</span>,</span>
<span id="cb1-40">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Malaysia"</span>,</span>
<span id="cb1-41">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cambodia"</span>,</span>
<span id="cb1-42">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"United Kingdom"</span>,</span>
<span id="cb1-43">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"South Africa"</span>,</span>
<span id="cb1-44">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Brazil"</span>,</span>
<span id="cb1-45">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bangladesh"</span>,</span>
<span id="cb1-46">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Singapore"</span>,</span>
<span id="cb1-47">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Israel"</span>,</span>
<span id="cb1-48">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Philippines"</span>,</span>
<span id="cb1-49">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chile"</span>,</span>
<span id="cb1-50">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Australia"</span>,</span>
<span id="cb1-51">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pakistan"</span>,</span>
<span id="cb1-52">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Turkey"</span>,</span>
<span id="cb1-53">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sri Lanka"</span>,</span>
<span id="cb1-54">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Colombia"</span>,</span>
<span id="cb1-55">    ],</span>
<span id="cb1-56">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tariffs_charged"</span>: [</span>
<span id="cb1-57">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"67%"</span>,</span>
<span id="cb1-58">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"39%"</span>,</span>
<span id="cb1-59">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"90%"</span>,</span>
<span id="cb1-60">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"64%"</span>,</span>
<span id="cb1-61">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"46%"</span>,</span>
<span id="cb1-62">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"52%"</span>,</span>
<span id="cb1-63">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"50%"</span>,</span>
<span id="cb1-64">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"72%"</span>,</span>
<span id="cb1-65">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"61%"</span>,</span>
<span id="cb1-66">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"64%"</span>,</span>
<span id="cb1-67">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"47%"</span>,</span>
<span id="cb1-68">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"97%"</span>,</span>
<span id="cb1-69">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-70">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"60%"</span>,</span>
<span id="cb1-71">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-72">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"74%"</span>,</span>
<span id="cb1-73">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-74">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"33%"</span>,</span>
<span id="cb1-75">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"34%"</span>,</span>
<span id="cb1-76">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-77">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-78">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"58%"</span>,</span>
<span id="cb1-79">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-80">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"88%"</span>,</span>
<span id="cb1-81">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-82">    ],</span>
<span id="cb1-83">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reciprocal_tariffs"</span>: [</span>
<span id="cb1-84">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"34%"</span>,</span>
<span id="cb1-85">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"20%"</span>,</span>
<span id="cb1-86">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"46%"</span>,</span>
<span id="cb1-87">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"32%"</span>,</span>
<span id="cb1-88">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"24%"</span>,</span>
<span id="cb1-89">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"26%"</span>,</span>
<span id="cb1-90">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"25%"</span>,</span>
<span id="cb1-91">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"36%"</span>,</span>
<span id="cb1-92">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"31%"</span>,</span>
<span id="cb1-93">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"32%"</span>,</span>
<span id="cb1-94">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"24%"</span>,</span>
<span id="cb1-95">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"49%"</span>,</span>
<span id="cb1-96">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-97">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"30%"</span>,</span>
<span id="cb1-98">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-99">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"37%"</span>,</span>
<span id="cb1-100">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-101">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"17%"</span>,</span>
<span id="cb1-102">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"17%"</span>,</span>
<span id="cb1-103">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-104">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-105">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"29%"</span>,</span>
<span id="cb1-106">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-107">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"44%"</span>,</span>
<span id="cb1-108">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-109">    ],</span>
<span id="cb1-110">}</span>
<span id="cb1-111"></span>
<span id="cb1-112">country, tariffs_charged, reciprocal_tariffs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data.keys()</span>
<span id="cb1-113"></span>
<span id="cb1-114">dark_navy_blue <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0B162A"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># background</span></span>
<span id="cb1-115">light_blue <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#B5D3E7"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># row</span></span>
<span id="cb1-116">white <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FFFFFF"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># row</span></span>
<span id="cb1-117">yellow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#F6D588"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># "reciprocal_tariffs" column</span></span>
<span id="cb1-118">gold <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FFF8DE"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># logo</span></span>
<span id="cb1-119"></span>
<span id="cb1-120">fontname_georgia <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Georgia"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># title</span></span>
<span id="cb1-121">fontname_roboto <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># body</span></span>
<span id="cb1-122"></span>
<span id="cb1-123"></span>
<span id="cb1-124"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> tweak_df() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="cb1-125">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># column width</span></span>
<span id="cb1-126">    x_col1_start, x_col1_end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.5</span></span>
<span id="cb1-127">    x_col2_start, x_col2_end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span></span>
<span id="cb1-128">    x_col3_start, x_col3_end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">82.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">97.5</span></span>
<span id="cb1-129"></span>
<span id="cb1-130">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># x-position for body text</span></span>
<span id="cb1-131">    x_col1_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb1-132">    x_col2_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x_col2_start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (x_col2_end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_col2_start) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-133">    x_col3_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x_col3_start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (x_col3_end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_col3_start) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-134"></span>
<span id="cb1-135">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb1-136">        pl.DataFrame(data)</span>
<span id="cb1-137">        .with_row_index()</span>
<span id="cb1-138">        .with_columns(</span>
<span id="cb1-139">            pl.col(country).cast(pl.Categorical),</span>
<span id="cb1-140">            pl.when(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index"</span>).mod(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>).eq(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb1-141">            .then(pl.lit(light_blue))</span>
<span id="cb1-142">            .otherwise(pl.lit(white))</span>
<span id="cb1-143">            .alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color_mod"</span>),</span>
<span id="cb1-144">            pl.lit(x_col1_start).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col1_start"</span>),</span>
<span id="cb1-145">            pl.lit(x_col1_end).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col1_end"</span>),</span>
<span id="cb1-146">            pl.lit(x_col2_start).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col2_start"</span>),</span>
<span id="cb1-147">            pl.lit(x_col2_end).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col2_end"</span>),</span>
<span id="cb1-148">            pl.lit(x_col3_start).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col3_start"</span>),</span>
<span id="cb1-149">            pl.lit(x_col3_end).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col3_end"</span>),</span>
<span id="cb1-150">            pl.lit(x_col1_text).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col1_text"</span>),</span>
<span id="cb1-151">            pl.lit(x_col2_text).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col2_text"</span>),</span>
<span id="cb1-152">            pl.lit(x_col3_text).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col3_text"</span>),</span>
<span id="cb1-153">        )</span>
<span id="cb1-154">    )</span>
<span id="cb1-155"></span>
<span id="cb1-156"></span>
<span id="cb1-157"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_textdata_df(x_ref: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, y_ref: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="cb1-158">    title_fontsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span></span>
<span id="cb1-159">    title_fontweight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span></span>
<span id="cb1-160">    heading_fontsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span></span>
<span id="cb1-161">    heading_fontweight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span></span>
<span id="cb1-162">    subheading_fontsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span></span>
<span id="cb1-163">    subheading_fontweight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span></span>
<span id="cb1-164"></span>
<span id="cb1-165">    textdata_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.DataFrame(</span>
<span id="cb1-166">        {</span>
<span id="cb1-167">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>: [</span>
<span id="cb1-168">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Reciprocal Tariffs"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># title</span></span>
<span id="cb1-169">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Country"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># col1</span></span>
<span id="cb1-170">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tariffs Charged"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># col2</span></span>
<span id="cb1-171">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"to the U.S.A."</span>,</span>
<span id="cb1-172">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Including"</span>,</span>
<span id="cb1-173">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Currency Manipulation"</span>,</span>
<span id="cb1-174">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"and Trade Barriers"</span>,</span>
<span id="cb1-175">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"U.S.A. Discounted"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># col3</span></span>
<span id="cb1-176">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Reciprocal Tariffs"</span>,</span>
<span id="cb1-177">            ],</span>
<span id="cb1-178">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>: [</span>
<span id="cb1-179">                x_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">34.0</span>,</span>
<span id="cb1-180">                x_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">29.5</span>,</span>
<span id="cb1-181">                x_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">67.5</span>,</span>
<span id="cb1-182">                x_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">67.5</span>,</span>
<span id="cb1-183">                x_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">67.5</span>,</span>
<span id="cb1-184">                x_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">67.5</span>,</span>
<span id="cb1-185">                x_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">67.5</span>,</span>
<span id="cb1-186">                x_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">89.5</span>,</span>
<span id="cb1-187">                x_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">89.5</span>,</span>
<span id="cb1-188">            ],</span>
<span id="cb1-189">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>: [</span>
<span id="cb1-190">                y_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span>,</span>
<span id="cb1-191">                y_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">25.5</span>,</span>
<span id="cb1-192">                y_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">26.8</span>,</span>
<span id="cb1-193">                y_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">26.4</span>,</span>
<span id="cb1-194">                y_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">26.1</span>,</span>
<span id="cb1-195">                y_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">25.8</span>,</span>
<span id="cb1-196">                y_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">25.5</span>,</span>
<span id="cb1-197">                y_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">26.0</span>,</span>
<span id="cb1-198">                y_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">25.6</span>,</span>
<span id="cb1-199">            ],</span>
<span id="cb1-200">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>: [</span>
<span id="cb1-201">                gold,</span>
<span id="cb1-202">                white,</span>
<span id="cb1-203">                white,</span>
<span id="cb1-204">                white,</span>
<span id="cb1-205">                white,</span>
<span id="cb1-206">                white,</span>
<span id="cb1-207">                white,</span>
<span id="cb1-208">                white,</span>
<span id="cb1-209">                white,</span>
<span id="cb1-210">            ],</span>
<span id="cb1-211">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontsize"</span>: [</span>
<span id="cb1-212">                title_fontsize,</span>
<span id="cb1-213">                heading_fontsize,</span>
<span id="cb1-214">                heading_fontsize,</span>
<span id="cb1-215">                heading_fontsize,</span>
<span id="cb1-216">                subheading_fontsize,</span>
<span id="cb1-217">                subheading_fontsize,</span>
<span id="cb1-218">                subheading_fontsize,</span>
<span id="cb1-219">                heading_fontsize,</span>
<span id="cb1-220">                heading_fontsize,</span>
<span id="cb1-221">            ],</span>
<span id="cb1-222">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontweight"</span>: [</span>
<span id="cb1-223">                title_fontweight,</span>
<span id="cb1-224">                heading_fontweight,</span>
<span id="cb1-225">                heading_fontweight,</span>
<span id="cb1-226">                heading_fontweight,</span>
<span id="cb1-227">                subheading_fontweight,</span>
<span id="cb1-228">                subheading_fontweight,</span>
<span id="cb1-229">                subheading_fontweight,</span>
<span id="cb1-230">                heading_fontweight,</span>
<span id="cb1-231">                heading_fontweight,</span>
<span id="cb1-232">            ],</span>
<span id="cb1-233">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontname"</span>: [</span>
<span id="cb1-234">                fontname_georgia,</span>
<span id="cb1-235">                fontname_georgia,</span>
<span id="cb1-236">                fontname_georgia,</span>
<span id="cb1-237">                fontname_georgia,</span>
<span id="cb1-238">                fontname_georgia,</span>
<span id="cb1-239">                fontname_georgia,</span>
<span id="cb1-240">                fontname_georgia,</span>
<span id="cb1-241">                fontname_georgia,</span>
<span id="cb1-242">                fontname_georgia,</span>
<span id="cb1-243">            ],</span>
<span id="cb1-244">        }</span>
<span id="cb1-245">    )</span>
<span id="cb1-246">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> textdata_df</span>
<span id="cb1-247"></span>
<span id="cb1-248"></span>
<span id="cb1-249"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> plot_g() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> ggplot:</span>
<span id="cb1-250">    geom_segment_props <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"size"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lineend"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"round"</span>}</span>
<span id="cb1-251"></span>
<span id="cb1-252">    geom_text_props <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb1-253">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ha"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>,</span>
<span id="cb1-254">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"va"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>,</span>
<span id="cb1-255">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"position"</span>: position_nudge(y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>),</span>
<span id="cb1-256">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"size"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb1-257">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontweight"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,</span>
<span id="cb1-258">    }</span>
<span id="cb1-259"></span>
<span id="cb1-260">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb1-261">        ggplot(data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df, mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>country, yend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>country))</span>
<span id="cb1-262">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># col1 segment</span></span>
<span id="cb1-263">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_segment(</span>
<span id="cb1-264">            mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col1_start"</span>, xend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col1_end"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color_mod"</span>),</span>
<span id="cb1-265">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>geom_segment_props,</span>
<span id="cb1-266">        )</span>
<span id="cb1-267">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># col2 segment</span></span>
<span id="cb1-268">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_segment(</span>
<span id="cb1-269">            mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col2_start"</span>, xend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col2_end"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color_mod"</span>),</span>
<span id="cb1-270">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>geom_segment_props,</span>
<span id="cb1-271">        )</span>
<span id="cb1-272">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># col3 segment</span></span>
<span id="cb1-273">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_segment(</span>
<span id="cb1-274">            mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col3_start"</span>, xend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col3_end"</span>),</span>
<span id="cb1-275">            color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>yellow,</span>
<span id="cb1-276">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>geom_segment_props,</span>
<span id="cb1-277">        )</span>
<span id="cb1-278">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># col1 text</span></span>
<span id="cb1-279">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_text(aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col1_text"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>country), <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>geom_text_props)</span>
<span id="cb1-280">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># col2 text</span></span>
<span id="cb1-281">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_text(aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col2_text"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tariffs_charged), <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>geom_text_props)</span>
<span id="cb1-282">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># col3 text</span></span>
<span id="cb1-283">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_text(aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col3_text"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>reciprocal_tariffs), <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>geom_text_props)</span>
<span id="cb1-284">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># using "color_mod" column directly</span></span>
<span id="cb1-285">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> scale_color_identity()</span>
<span id="cb1-286">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># expand extra space</span></span>
<span id="cb1-287">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> scale_y_discrete(</span>
<span id="cb1-288">            limits<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df.select(country).reverse().to_series().to_list(),</span>
<span id="cb1-289">            expand<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>),</span>
<span id="cb1-290">        )</span>
<span id="cb1-291">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># title and headers</span></span>
<span id="cb1-292">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_text(</span>
<span id="cb1-293">            data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>textdata_df,</span>
<span id="cb1-294">            mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(</span>
<span id="cb1-295">                x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>,</span>
<span id="cb1-296">                y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>,</span>
<span id="cb1-297">                label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>,</span>
<span id="cb1-298">                color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>,</span>
<span id="cb1-299">                size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontsize"</span>,</span>
<span id="cb1-300">                fontweight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontweight"</span>,</span>
<span id="cb1-301">                fontname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontname"</span>,</span>
<span id="cb1-302">            ),</span>
<span id="cb1-303">            va<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>,</span>
<span id="cb1-304">            ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>,</span>
<span id="cb1-305">        )</span>
<span id="cb1-306">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># using "size" column directly</span></span>
<span id="cb1-307">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> scale_size_identity()</span>
<span id="cb1-308">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># logo</span></span>
<span id="cb1-309">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> watermark(logo_filename, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2235</span>)</span>
<span id="cb1-310">    )</span>
<span id="cb1-311"></span>
<span id="cb1-312"></span>
<span id="cb1-313"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> themify(p: ggplot) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Figure:</span>
<span id="cb1-314">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb1-315">        p</span>
<span id="cb1-316">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> theme_void()</span>
<span id="cb1-317">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> theme(</span>
<span id="cb1-318">            legend_position<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># turns off the legend</span></span>
<span id="cb1-319">            axis_text_x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_blank(),</span>
<span id="cb1-320">            axis_text_y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_blank(),</span>
<span id="cb1-321">            axis_title_x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_blank(),</span>
<span id="cb1-322">            axis_title_y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_blank(),</span>
<span id="cb1-323">            panel_background<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_rect(fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dark_navy_blue),</span>
<span id="cb1-324">            plot_background<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_rect(fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dark_navy_blue),</span>
<span id="cb1-325">            text<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_text(family<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fontname_roboto),</span>
<span id="cb1-326">            dpi<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>,</span>
<span id="cb1-327">            figure_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>),</span>
<span id="cb1-328">        )</span>
<span id="cb1-329">    ).draw(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb1-330"></span>
<span id="cb1-331"></span>
<span id="cb1-332">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tweak_df()</span>
<span id="cb1-333">textdata_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_textdata_df()</span>
<span id="cb1-334">p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plot_g()</span>
<span id="cb1-335">fig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> themify(p)</span>
<span id="cb1-336">fig</span></code></pre></div>
</details>
</div>
<section id="preparing-the-dataframes" class="level2">
<h2 class="anchored" data-anchor-id="preparing-the-dataframes">Preparing the DataFrames</h2>
<section id="main-dataframe" class="level3">
<h3 class="anchored" data-anchor-id="main-dataframe">Main DataFrame</h3>
<p>We start by extracting the data from a previous project. The <code>country</code> column is converted to a categorical type, which simplifies handling in plotnine. To enable alternating row colors in the final visualization, we also create a new column called <code>color_mod</code>. Additional columns are created to define the positions for the segments and text labels.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> tweak_df() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="cb2-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># column width</span></span>
<span id="cb2-3">    x_col1_start, x_col1_end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.5</span></span>
<span id="cb2-4">    x_col2_start, x_col2_end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span></span>
<span id="cb2-5">    x_col3_start, x_col3_end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">82.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">97.5</span></span>
<span id="cb2-6"></span>
<span id="cb2-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># x-position for body text</span></span>
<span id="cb2-8">    x_col1_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb2-9">    x_col2_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x_col2_start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (x_col2_end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_col2_start) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb2-10">    x_col3_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x_col3_start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (x_col3_end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_col3_start) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb2-11"></span>
<span id="cb2-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb2-13">        pl.DataFrame(data)</span>
<span id="cb2-14">        .with_row_index()</span>
<span id="cb2-15">        .with_columns(</span>
<span id="cb2-16">            pl.col(country).cast(pl.Categorical),</span>
<span id="cb2-17">            pl.when(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index"</span>).mod(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>).eq(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb2-18">            .then(pl.lit(light_blue))</span>
<span id="cb2-19">            .otherwise(pl.lit(white))</span>
<span id="cb2-20">            .alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color_mod"</span>),</span>
<span id="cb2-21">            pl.lit(x_col1_start).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col1_start"</span>),</span>
<span id="cb2-22">            pl.lit(x_col1_end).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col1_end"</span>),</span>
<span id="cb2-23">            pl.lit(x_col2_start).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col2_start"</span>),</span>
<span id="cb2-24">            pl.lit(x_col2_end).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col2_end"</span>),</span>
<span id="cb2-25">            pl.lit(x_col3_start).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col3_start"</span>),</span>
<span id="cb2-26">            pl.lit(x_col3_end).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col3_end"</span>),</span>
<span id="cb2-27">            pl.lit(x_col1_text).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col1_text"</span>),</span>
<span id="cb2-28">            pl.lit(x_col2_text).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col2_text"</span>),</span>
<span id="cb2-29">            pl.lit(x_col3_text).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col3_text"</span>),</span>
<span id="cb2-30">        )</span>
<span id="cb2-31">    )</span>
<span id="cb2-32"></span>
<span id="cb2-33">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tweak_df()</span></code></pre></div>
</section>
<section id="textdata-dataframe" class="level3">
<h3 class="anchored" data-anchor-id="textdata-dataframe">Textdata DataFrame</h3>
<p>Next, we create another DataFrame that contains information for all the text elements, such as text color, font size, and font weight, for the title and headers.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_textdata_df(</span>
<span id="cb3-2">    x_ref: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, y_ref: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb3-3">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="cb3-4">    title_fontsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span></span>
<span id="cb3-5">    title_fontweight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span></span>
<span id="cb3-6">    heading_fontsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span></span>
<span id="cb3-7">    heading_fontweight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span></span>
<span id="cb3-8">    subheading_fontsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span></span>
<span id="cb3-9">    subheading_fontweight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span></span>
<span id="cb3-10"></span>
<span id="cb3-11">    textdata_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.DataFrame(</span>
<span id="cb3-12">        {</span>
<span id="cb3-13">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>: [</span>
<span id="cb3-14">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Reciprocal Tariffs"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># title</span></span>
<span id="cb3-15">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Country"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># col1</span></span>
<span id="cb3-16">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tariffs Charged"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># col2</span></span>
<span id="cb3-17">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"to the U.S.A."</span>,</span>
<span id="cb3-18">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Including"</span>,</span>
<span id="cb3-19">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Currency Manipulation"</span>,</span>
<span id="cb3-20">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"and Trade Barriers"</span>,</span>
<span id="cb3-21">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"U.S.A. Discounted"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># col3</span></span>
<span id="cb3-22">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Reciprocal Tariffs"</span>,</span>
<span id="cb3-23">            ],</span>
<span id="cb3-24">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>: [</span>
<span id="cb3-25">                x_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">34.0</span>,</span>
<span id="cb3-26">                x_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">29.5</span>,</span>
<span id="cb3-27">                x_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">67.5</span>,</span>
<span id="cb3-28">                x_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">67.5</span>,</span>
<span id="cb3-29">                x_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">67.5</span>,</span>
<span id="cb3-30">                x_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">67.5</span>,</span>
<span id="cb3-31">                x_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">67.5</span>,</span>
<span id="cb3-32">                x_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">89.5</span>,</span>
<span id="cb3-33">                x_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">89.5</span>,</span>
<span id="cb3-34">            ],</span>
<span id="cb3-35">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>: [</span>
<span id="cb3-36">                y_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span>,</span>
<span id="cb3-37">                y_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">25.5</span>,</span>
<span id="cb3-38">                y_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">26.8</span>,</span>
<span id="cb3-39">                y_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">26.4</span>,</span>
<span id="cb3-40">                y_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">26.1</span>,</span>
<span id="cb3-41">                y_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">25.8</span>,</span>
<span id="cb3-42">                y_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">25.5</span>,</span>
<span id="cb3-43">                y_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">26.0</span>,</span>
<span id="cb3-44">                y_ref <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">25.6</span>,</span>
<span id="cb3-45">            ],</span>
<span id="cb3-46">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>: [</span>
<span id="cb3-47">                gold,</span>
<span id="cb3-48">                white,</span>
<span id="cb3-49">                white,</span>
<span id="cb3-50">                white,</span>
<span id="cb3-51">                white,</span>
<span id="cb3-52">                white,</span>
<span id="cb3-53">                white,</span>
<span id="cb3-54">                white,</span>
<span id="cb3-55">                white,</span>
<span id="cb3-56">            ],</span>
<span id="cb3-57">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontsize"</span>: [</span>
<span id="cb3-58">                title_fontsize,</span>
<span id="cb3-59">                heading_fontsize,</span>
<span id="cb3-60">                heading_fontsize,</span>
<span id="cb3-61">                heading_fontsize,</span>
<span id="cb3-62">                subheading_fontsize,</span>
<span id="cb3-63">                subheading_fontsize,</span>
<span id="cb3-64">                subheading_fontsize,</span>
<span id="cb3-65">                heading_fontsize,</span>
<span id="cb3-66">                heading_fontsize,</span>
<span id="cb3-67">            ],</span>
<span id="cb3-68">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontweight"</span>: [</span>
<span id="cb3-69">                title_fontweight,</span>
<span id="cb3-70">                heading_fontweight,</span>
<span id="cb3-71">                heading_fontweight,</span>
<span id="cb3-72">                heading_fontweight,</span>
<span id="cb3-73">                subheading_fontweight,</span>
<span id="cb3-74">                subheading_fontweight,</span>
<span id="cb3-75">                subheading_fontweight,</span>
<span id="cb3-76">                heading_fontweight,</span>
<span id="cb3-77">                heading_fontweight,</span>
<span id="cb3-78">            ],</span>
<span id="cb3-79">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontname"</span>: [</span>
<span id="cb3-80">                fontname_georgia,</span>
<span id="cb3-81">                fontname_georgia,</span>
<span id="cb3-82">                fontname_georgia,</span>
<span id="cb3-83">                fontname_georgia,</span>
<span id="cb3-84">                fontname_georgia,</span>
<span id="cb3-85">                fontname_georgia,</span>
<span id="cb3-86">                fontname_georgia,</span>
<span id="cb3-87">                fontname_georgia,</span>
<span id="cb3-88">                fontname_georgia,</span>
<span id="cb3-89">            ],</span>
<span id="cb3-90">        }</span>
<span id="cb3-91">    )</span>
<span id="cb3-92">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> textdata_df</span>
<span id="cb3-93"></span>
<span id="cb3-94">textdata_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_textdata_df()</span></code></pre></div>
</section>
</section>
<section id="constructing-the-ggplot-object" class="level2">
<h2 class="anchored" data-anchor-id="constructing-the-ggplot-object">Constructing the ggplot Object</h2>
<p>With the processed DataFrame ready, we can now build the <a href="https://plotnine.org/reference/ggplot.html#plotnine.ggplot">ggplot()</a> object:</p>
<div class="sourceCode" id="annotated-cell-4" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> plot_g() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> ggplot:</span>
<span id="annotated-cell-4-2">    geom_segment_props <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"size"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lineend"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"round"</span>}</span>
<span id="annotated-cell-4-3"></span>
<span id="annotated-cell-4-4">    geom_text_props <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="annotated-cell-4-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ha"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>,</span>
<span id="annotated-cell-4-6">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"va"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>,</span>
<span id="annotated-cell-4-7">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"position"</span>: position_nudge(y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>),</span>
<span id="annotated-cell-4-8">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"size"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="annotated-cell-4-9">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontweight"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,</span>
<span id="annotated-cell-4-10">    }</span>
<span id="annotated-cell-4-11"></span>
<span id="annotated-cell-4-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="annotated-cell-4-13">        ggplot(data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df, mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>country, yend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>country))</span>
<span id="annotated-cell-4-14">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># col1 segment</span></span>
<span id="annotated-cell-4-15">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_segment(</span>
<span id="annotated-cell-4-16">            mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col1_start"</span>, xend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col1_end"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color_mod"</span>),</span>
<span id="annotated-cell-4-17">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>geom_segment_props,</span>
<span id="annotated-cell-4-18">        )</span>
<span id="annotated-cell-4-19">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># col2 segment</span></span>
<span id="annotated-cell-4-20">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_segment(</span>
<span id="annotated-cell-4-21">            mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col2_start"</span>, xend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col2_end"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color_mod"</span>),</span>
<span id="annotated-cell-4-22">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>geom_segment_props,</span>
<span id="annotated-cell-4-23">        )</span>
<span id="annotated-cell-4-24">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># col3 segment</span></span>
<span id="annotated-cell-4-25">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_segment(</span>
<span id="annotated-cell-4-26">            mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col3_start"</span>, xend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col3_end"</span>),</span>
<span id="annotated-cell-4-27">            color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>yellow,</span>
<span id="annotated-cell-4-28">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>geom_segment_props,</span>
<span id="annotated-cell-4-29">        )</span>
<span id="annotated-cell-4-30">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># col1 text</span></span>
<span id="annotated-cell-4-31">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_text(aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col1_text"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>country), <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>geom_text_props)</span>
<span id="annotated-cell-4-32">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># col2 text</span></span>
<span id="annotated-cell-4-33">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_text(aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col2_text"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tariffs_charged), <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>geom_text_props)</span>
<span id="annotated-cell-4-34">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># col3 text</span></span>
<span id="annotated-cell-4-35">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_text(aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_col3_text"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>reciprocal_tariffs), <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>geom_text_props)</span>
<span id="annotated-cell-4-36">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># using "color_mod" column directly</span></span>
<span id="annotated-cell-4-37">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> scale_color_identity()</span>
<span id="annotated-cell-4-38">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># expand extra space</span></span>
<span id="annotated-cell-4-39">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> scale_y_discrete(</span>
<span id="annotated-cell-4-40">            limits<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df.select(country).reverse().to_series().to_list(),</span>
<span id="annotated-cell-4-41">            expand<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>),</span>
<span id="annotated-cell-4-42">        )</span>
<span id="annotated-cell-4-43">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># title and headers</span></span>
<span id="annotated-cell-4-44">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_text(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-4-45" class="code-annotation-target">            data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>textdata_df,</span>
<span id="annotated-cell-4-46">            mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(</span>
<span id="annotated-cell-4-47">                x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>,</span>
<span id="annotated-cell-4-48">                y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>,</span>
<span id="annotated-cell-4-49">                label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>,</span>
<span id="annotated-cell-4-50">                color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>,</span>
<span id="annotated-cell-4-51">                size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontsize"</span>,</span>
<span id="annotated-cell-4-52">                fontweight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontweight"</span>,</span>
<span id="annotated-cell-4-53">                fontname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontname"</span>,</span>
<span id="annotated-cell-4-54">            ),</span>
<span id="annotated-cell-4-55">            va<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>,</span>
<span id="annotated-cell-4-56">            ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>,</span>
<span id="annotated-cell-4-57">        )</span>
<span id="annotated-cell-4-58">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># using "size" column directly</span></span>
<span id="annotated-cell-4-59">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> scale_size_identity()</span>
<span id="annotated-cell-4-60">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># logo</span></span>
<span id="annotated-cell-4-61">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> watermark(logo_filename, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2235</span>)</span>
<span id="annotated-cell-4-62">    )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="45" data-code-annotation="1">The <code>data=</code> argument is set to <code>textdata_df</code>, which contains all the custom label and styling details for the title and column headers.</span>
</dd>
</dl>
<section id="whats-happening-here" class="level3">
<h3 class="anchored" data-anchor-id="whats-happening-here">What’s happening here?</h3>
<ol type="1">
<li><a href="https://plotnine.org/reference/geom_segment.html#plotnine.geom_segment">geom_segment()</a>: Since I couldn’t find a way to apply border radius, I used <code>geom_segment()</code> with <code>lineend="round"</code> as the best available workaround. Thick lines serve as cell backgrounds.</li>
<li><a href="https://plotnine.org/reference/geom_text.html#plotnine.geom_text">geom_text()</a>: Adds text for each column.</li>
<li><a href="https://plotnine.org/reference/scale_color_identity.html#plotnine.scale_color_identity">scale_color_identity()</a>: Uses the color values directly from the <code>color_mod</code> column, without applying a scale.</li>
<li><a href="https://plotnine.org/reference/scale_y_discrete.html#plotnine.scale_y_discrete">scale_y_discrete()</a>: Reorders the <code>country</code> axis and tweaks padding to add space above and below the table.</li>
<li><a href="https://plotnine.org/reference/scale_size_identity.html#plotnine.scale_size_identity">scale_size_identity()</a>: Similar to color scaling, this instructs plotnine to use the font sizes specified in the <code>fontsize</code> column without transformation.</li>
<li><a href="https://plotnine.org/reference/watermark.html#plotnine.watermark">watermark()</a>: Embeds a logo. Since there’s no native figure size parameter in plotnine, I manually scaled the output.</li>
</ol>
</section>
</section>
<section id="custom-theme" class="level2">
<h2 class="anchored" data-anchor-id="custom-theme">Custom Theme</h2>
<p>We apply a tailored theme with <code>themify()</code> to refine the figure’s appearance:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> themify(p: ggplot) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Figure:</span>
<span id="cb4-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb4-3">        p</span>
<span id="cb4-4">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> theme_void()</span>
<span id="cb4-5">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> theme(</span>
<span id="cb4-6">            legend_position<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># turns off the legend</span></span>
<span id="cb4-7">            axis_text_x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_blank(),</span>
<span id="cb4-8">            axis_text_y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_blank(),</span>
<span id="cb4-9">            axis_title_x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_blank(),</span>
<span id="cb4-10">            axis_title_y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_blank(),</span>
<span id="cb4-11">            panel_background<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_rect(fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dark_navy_blue),</span>
<span id="cb4-12">            plot_background<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_rect(fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dark_navy_blue),</span>
<span id="cb4-13">            text<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_text(family<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fontname_roboto),</span>
<span id="cb4-14">            dpi<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>,</span>
<span id="cb4-15">            figure_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>),</span>
<span id="cb4-16">        )</span>
<span id="cb4-17">    ).draw(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span></code></pre></div>
</section>
<section id="final-rendering" class="level2">
<h2 class="anchored" data-anchor-id="final-rendering">Final Rendering</h2>
<p>Now, let’s tie it all together:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plot_g()</span>
<span id="cb5-2">fig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> themify(p)</span>
<span id="cb5-3">fig</span></code></pre></div>
</section>
<section id="closing-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="closing-thoughts">Closing Thoughts</h2>
<p>This post showcases how plotnine can be used to create table-like visualizations. I’m genuinely impressed by its capabilities — it’s surprisingly fun to approach a table as a figure.</p>
<p>Throughout this exploration, I learned a lot from <a href="https://github.com/123-fake-st/2024_plotnine_contest">this repository</a>, which won the Plotnine Contest 2024. It’s a fantastic example of what’s possible with the library.</p>
<p>It would be exciting to explore how plotnine and Great Tables might work together to enable even richer visual storytelling — I’m looking forward to diving into that next.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Disclaimer
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>This table is intended as a self-practice project, and the data in the table may not be 100% accurate. Please refer to the <a href="https://truthsocial.com/@realDonaldTrump/114270398531479278">original source</a> if you require verified data.</li>
<li>This post was drafted by me, with AI assistance to refine the content.</li>
</ol>
</div>
</div>


</section>

 ]]></description>
  <category>python</category>
  <category>polars</category>
  <category>plotnine</category>
  <guid>https://tech.ycwu.space/posts/clone-reciprocal-tariffs-table-p9/20250416.html</guid>
  <pubDate>Wed, 16 Apr 2025 00:00:00 GMT</pubDate>
  <media:content url="https://tech.ycwu.space/posts/clone-reciprocal-tariffs-table-p9/reciprocal_tariffs_p9.png" medium="image" type="image/png" height="191" width="144"/>
</item>
<item>
  <title>Weekend Challenge – Recreating a Data Visualization with Polars and Plotnine</title>
  <dc:creator>Jerry Wu</dc:creator>
  <link>https://tech.ycwu.space/posts/p9-polars-alta-ski-resort/20250412.html</link>
  <description><![CDATA[ 





<p>This post is part of a visualization recreation challenge using Polars and plotnine, inspired by <a href="../../posts/effective-dataviz-polars-alta-ski-resort/20250210.html">my earlier work</a>.</p>
<p>It marks my first serious dive into plotnine—an impressive library with a bit of a learning curve.<br>
I’ll walk through the journey I took to recreate the visualization. Some parts may overlap with the earlier post, but I believe that’s acceptable to keep this one self-contained.</p>
<p>The final figure, shown below, visualizes temperature trends for the ski season in Alta over the past few decades. <img src="https://tech.ycwu.space/posts/p9-polars-alta-ski-resort/alta_ski_resort.png" class="img-fluid quarto-figure quarto-figure-center" alt="Alta ski resort"></p>
<div id="16ad0b78" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Show full code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> polars <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pl</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> polars.selectors <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> cs</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> highlight_text <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ax_text</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> matplotlib.axes <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Axes</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> matplotlib.figure <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Figure</span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> plotnine <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> (</span>
<span id="cb1-8">    aes,</span>
<span id="cb1-9">    element_blank,</span>
<span id="cb1-10">    element_text,</span>
<span id="cb1-11">    geom_line,</span>
<span id="cb1-12">    geom_point,</span>
<span id="cb1-13">    geom_segment,</span>
<span id="cb1-14">    geom_text,</span>
<span id="cb1-15">    ggplot,</span>
<span id="cb1-16">    labs,</span>
<span id="cb1-17">    scale_color_cmap,</span>
<span id="cb1-18">    scale_x_continuous,</span>
<span id="cb1-19">    scale_y_continuous,</span>
<span id="cb1-20">    theme,</span>
<span id="cb1-21">    theme_classic,</span>
<span id="cb1-22">)</span>
<span id="cb1-23"></span>
<span id="cb1-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># https://github.com/mattharrison/datasets/raw/refs/heads/master/data/alta-noaa-1980-2019.csv</span></span>
<span id="cb1-25">data_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"alta-noaa-1980-2019.csv"</span></span>
<span id="cb1-26">columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TOBS"</span>]</span>
<span id="cb1-27">idx_colname <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span></span>
<span id="cb1-28">temp_colname <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"temp"</span></span>
<span id="cb1-29"></span>
<span id="cb1-30">heading_fontsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9.5</span></span>
<span id="cb1-31">heading_fontweight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span></span>
<span id="cb1-32">subheading_fontsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span></span>
<span id="cb1-33">subheading_fontweight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span></span>
<span id="cb1-34">source_fontsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.5</span></span>
<span id="cb1-35">source_fontweight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"light"</span></span>
<span id="cb1-36">axis_fontsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span></span>
<span id="cb1-37">axis_fontweight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span></span>
<span id="cb1-38">sub_props <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontsize"</span>: subheading_fontsize, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontweight"</span>: subheading_fontweight}</span>
<span id="cb1-39"></span>
<span id="cb1-40">grey <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#aaaaaa"</span></span>
<span id="cb1-41">red <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#e3120b"</span></span>
<span id="cb1-42">blue <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0000ff"</span></span>
<span id="cb1-43"></span>
<span id="cb1-44"></span>
<span id="cb1-45"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_season_expr(col: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>, alias: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.expr:</span>
<span id="cb1-46">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb1-47">        (</span>
<span id="cb1-48">            pl.when((pl.col(col).dt.month().is_between(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, closed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"both"</span>)))</span>
<span id="cb1-49">            .then(pl.lit(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Summer "</span>))</span>
<span id="cb1-50">            .otherwise(pl.lit(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ski "</span>))</span>
<span id="cb1-51">        )</span>
<span id="cb1-52">        .add(</span>
<span id="cb1-53">            pl.when(pl.col(col).dt.month() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>)</span>
<span id="cb1-54">            .then(pl.col(col).dt.year().cast(pl.String))</span>
<span id="cb1-55">            .otherwise(pl.col(col).dt.year().add(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>).cast(pl.String))</span>
<span id="cb1-56">        )</span>
<span id="cb1-57">        .alias(alias)</span>
<span id="cb1-58">    )</span>
<span id="cb1-59"></span>
<span id="cb1-60"></span>
<span id="cb1-61"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> add_day_of_season_expr(</span>
<span id="cb1-62">    col: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>, group_col: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>, alias: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span></span>
<span id="cb1-63">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.expr:</span>
<span id="cb1-64">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb1-65">        (pl.col(col) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> pl.col(col).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()).dt.total_days().over(group_col).alias(alias)</span>
<span id="cb1-66">    )</span>
<span id="cb1-67"></span>
<span id="cb1-68"></span>
<span id="cb1-69"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> tweak_df(</span>
<span id="cb1-70">    data_path: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, columns: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>], idx_colname: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span></span>
<span id="cb1-71">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="cb1-72">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb1-73">        pl.scan_csv(data_path)</span>
<span id="cb1-74">        .select(columns)</span>
<span id="cb1-75">        .with_columns(</span>
<span id="cb1-76">            pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.to_datetime(),</span>
<span id="cb1-77">            pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TOBS"</span>).interpolate(),</span>
<span id="cb1-78">        )</span>
<span id="cb1-79">        .sort(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>)</span>
<span id="cb1-80">        .with_columns(</span>
<span id="cb1-81">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Caveat: Cannot be placed in the previous `with_columns()`</span></span>
<span id="cb1-82">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># due to different statuses of `TOBS`.</span></span>
<span id="cb1-83">            pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TOBS"</span>).rolling_mean(window_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, center<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TMEAN"</span>),</span>
<span id="cb1-84">            get_season_expr(col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>, alias<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>),</span>
<span id="cb1-85">        )</span>
<span id="cb1-86">        .with_columns(</span>
<span id="cb1-87">            add_day_of_season_expr(col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>, group_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>, alias<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>idx_colname)</span>
<span id="cb1-88">        )</span>
<span id="cb1-89">        .collect()</span>
<span id="cb1-90">    )</span>
<span id="cb1-91"></span>
<span id="cb1-92"></span>
<span id="cb1-93"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> plot_temps(_df: pl.DataFrame, idx_colname: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> ggplot:</span>
<span id="cb1-94">    season_temps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> _df.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ski"</span>)).pivot(</span>
<span id="cb1-95">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>idx_colname, values<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TMEAN"</span>, aggregate_function<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"first"</span></span>
<span id="cb1-96">    )</span>
<span id="cb1-97"></span>
<span id="cb1-98">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># main</span></span>
<span id="cb1-99">    df_main <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> season_temps.unpivot(</span>
<span id="cb1-100">        (cs.starts_with(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ski"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> cs.by_name(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ski 2019"</span>)),</span>
<span id="cb1-101">        index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>idx_colname,</span>
<span id="cb1-102">        variable_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>,</span>
<span id="cb1-103">        value_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>temp_colname,</span>
<span id="cb1-104">    ).select(</span>
<span id="cb1-105">        idx_colname,</span>
<span id="cb1-106">        temp_colname,</span>
<span id="cb1-107">        pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">slice</span>(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>).cast(pl.Int32),</span>
<span id="cb1-108">    )</span>
<span id="cb1-109"></span>
<span id="cb1-110">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># decades</span></span>
<span id="cb1-111">    decades <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1980</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1990</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010</span>]</span>
<span id="cb1-112">    blues <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0055EE"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0033CC"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0011AA"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#3377FF"</span>]</span>
<span id="cb1-113"></span>
<span id="cb1-114">    df_decade <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.concat(</span>
<span id="cb1-115">        [</span>
<span id="cb1-116">            season_temps.select(</span>
<span id="cb1-117">                idx_colname,</span>
<span id="cb1-118">                pl.mean_horizontal(cs.contains(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(decade)[:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])).alias(temp_colname),</span>
<span id="cb1-119">                pl.lit(b).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>),</span>
<span id="cb1-120">            )</span>
<span id="cb1-121">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> b, decade <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(blues, decades)</span>
<span id="cb1-122">        ],</span>
<span id="cb1-123">        how<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vertical"</span>,</span>
<span id="cb1-124">    )</span>
<span id="cb1-125"></span>
<span id="cb1-126">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># decade points</span></span>
<span id="cb1-127">    df_decade_pts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb1-128">        df_decade.group_by(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>), maintain_order<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb1-129">        .agg(</span>
<span id="cb1-130">            pl.col(idx_colname).first().append(pl.col(idx_colname).last()),</span>
<span id="cb1-131">            pl.col(temp_colname).first().append(pl.col(temp_colname).last()),</span>
<span id="cb1-132">        )</span>
<span id="cb1-133">        .explode(idx_colname, temp_colname)</span>
<span id="cb1-134">    )</span>
<span id="cb1-135"></span>
<span id="cb1-136">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># decade annotations</span></span>
<span id="cb1-137">    decade_annts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb1-138">        df_decade_pts.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(pl.col(idx_colname).eq(pl.col(idx_colname).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()))</span>
<span id="cb1-139">        .select(temp_colname)</span>
<span id="cb1-140">        .to_series()</span>
<span id="cb1-141">        .to_list()</span>
<span id="cb1-142">    )</span>
<span id="cb1-143"></span>
<span id="cb1-144">    df_decade_annt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.DataFrame(</span>
<span id="cb1-145">        {</span>
<span id="cb1-146">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">185</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(decade_annts),</span>
<span id="cb1-147">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># adjust y position for better appearance</span></span>
<span id="cb1-148">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>: [</span>
<span id="cb1-149">                decade_annts[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>],</span>
<span id="cb1-150">                decade_annts[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb1-151">                decade_annts[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb1-152">                decade_annts[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>],</span>
<span id="cb1-153">            ],</span>
<span id="cb1-154">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>: blues,</span>
<span id="cb1-155">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>: decades,</span>
<span id="cb1-156">        }</span>
<span id="cb1-157">    )</span>
<span id="cb1-158"></span>
<span id="cb1-159">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ski_2019</span></span>
<span id="cb1-160">    ski_2019 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb1-161">        season_temps.select(</span>
<span id="cb1-162">            idx_colname, pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ski 2019"</span>).alias(temp_colname)</span>
<span id="cb1-163">        ).drop_nulls()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># "DAY_OF_SEASON"=181, "temp"=null</span></span>
<span id="cb1-164">    )</span>
<span id="cb1-165"></span>
<span id="cb1-166">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ski_2019 points</span></span>
<span id="cb1-167">    ski_2019_pts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.concat([ski_2019.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), ski_2019.tail(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)])</span>
<span id="cb1-168"></span>
<span id="cb1-169">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ggplot</span></span>
<span id="cb1-170">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb1-171">        ggplot(mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>idx_colname, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>temp_colname))</span>
<span id="cb1-172">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># multiple grey lines</span></span>
<span id="cb1-173">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_line(</span>
<span id="cb1-174">            mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"factor(year)"</span>),</span>
<span id="cb1-175">            data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df_main,</span>
<span id="cb1-176">            alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,</span>
<span id="cb1-177">            size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb1-178">        )</span>
<span id="cb1-179">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4 blue lines</span></span>
<span id="cb1-180">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_line(</span>
<span id="cb1-181">            mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"factor(color)"</span>),</span>
<span id="cb1-182">            data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df_decade,</span>
<span id="cb1-183">            color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df_decade[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>],</span>
<span id="cb1-184">            size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb1-185">            lineend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"round"</span>,</span>
<span id="cb1-186">        )</span>
<span id="cb1-187">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2019 red line</span></span>
<span id="cb1-188">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_line(</span>
<span id="cb1-189">            data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ski_2019,</span>
<span id="cb1-190">            color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>red,</span>
<span id="cb1-191">            size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,</span>
<span id="cb1-192">            lineend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"round"</span>,</span>
<span id="cb1-193">        )</span>
<span id="cb1-194">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 black dashed line for temp=32F</span></span>
<span id="cb1-195">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_segment(</span>
<span id="cb1-196">            mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, xend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>, yend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>),</span>
<span id="cb1-197">            size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb1-198">            linetype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>,</span>
<span id="cb1-199">        )</span>
<span id="cb1-200">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># start and end dots for 4 blue lines</span></span>
<span id="cb1-201">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_point(</span>
<span id="cb1-202">            mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>idx_colname, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>temp_colname),</span>
<span id="cb1-203">            data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df_decade_pts,</span>
<span id="cb1-204">            color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df_decade_pts[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>],</span>
<span id="cb1-205">            size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,</span>
<span id="cb1-206">        )</span>
<span id="cb1-207">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># start and end dots for 2019 red line</span></span>
<span id="cb1-208">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_point(</span>
<span id="cb1-209">            mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>idx_colname, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>temp_colname),</span>
<span id="cb1-210">            data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ski_2019_pts,</span>
<span id="cb1-211">            color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>red,</span>
<span id="cb1-212">            size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb1-213">        )</span>
<span id="cb1-214">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># annotations for 4 blue lines</span></span>
<span id="cb1-215">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_text(</span>
<span id="cb1-216">            mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>),</span>
<span id="cb1-217">            data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df_decade_annt,</span>
<span id="cb1-218">            color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df_decade_annt[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>],</span>
<span id="cb1-219">            size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axis_fontsize,</span>
<span id="cb1-220">            fontweight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axis_fontweight,</span>
<span id="cb1-221">            ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>,</span>
<span id="cb1-222">            va<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>,</span>
<span id="cb1-223">        )</span>
<span id="cb1-224">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> labs(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>idx_colname, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb1-225">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> scale_x_continuous(</span>
<span id="cb1-226">            breaks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span>],</span>
<span id="cb1-227">            limits<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>),</span>
<span id="cb1-228">            expand<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>),</span>
<span id="cb1-229">        )</span>
<span id="cb1-230">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> scale_y_continuous(breaks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>], limits<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>), expand<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb1-231">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> scale_color_cmap(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Greys"</span>, guide<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb1-232">    )</span>
<span id="cb1-233"></span>
<span id="cb1-234"></span>
<span id="cb1-235"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> points_to_inches(points):</span>
<span id="cb1-236">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> points <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span></span>
<span id="cb1-237"></span>
<span id="cb1-238"></span>
<span id="cb1-239"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> themify(p: ggplot) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Figure:</span>
<span id="cb1-240">    figsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">160</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">165</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pts</span></span>
<span id="cb1-241">    figsize_inches <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [points_to_inches(dim) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> dim <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> figsize]</span>
<span id="cb1-242"></span>
<span id="cb1-243">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb1-244">        p</span>
<span id="cb1-245">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> theme_classic()</span>
<span id="cb1-246">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> theme(</span>
<span id="cb1-247">            axis_line_y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_blank(),</span>
<span id="cb1-248">            axis_title_x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_text(weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axis_fontweight, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axis_fontsize),</span>
<span id="cb1-249">            axis_title_y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_text(weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axis_fontweight, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axis_fontsize),</span>
<span id="cb1-250">            axis_text_x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_text(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb1-251">            axis_text_y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_text(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb1-252">            dpi<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>,</span>
<span id="cb1-253">            figure_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>figsize_inches,</span>
<span id="cb1-254">            aspect_ratio<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb1-255">            text<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_text(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto"</span>),</span>
<span id="cb1-256">        )</span>
<span id="cb1-257">    ).draw(show<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb1-258"></span>
<span id="cb1-259"></span>
<span id="cb1-260"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> add_ax_text(ax: Axes) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Axes:</span>
<span id="cb1-261">    ax_text(</span>
<span id="cb1-262">        s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;Alta Ski Resort&gt;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;Temperature trends by &gt;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;decade&gt;&lt; and &gt;&lt;2019&gt;"</span>,</span>
<span id="cb1-263">        x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb1-264">        y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">55</span>,</span>
<span id="cb1-265">        fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>heading_fontsize,</span>
<span id="cb1-266">        ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax,</span>
<span id="cb1-267">        va<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>,</span>
<span id="cb1-268">        ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>,</span>
<span id="cb1-269">        zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb1-270">        highlight_textprops<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb1-271">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontsize"</span>: heading_fontsize, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontweight"</span>: heading_fontweight},</span>
<span id="cb1-272">            sub_props,</span>
<span id="cb1-273">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>: blue, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>sub_props},</span>
<span id="cb1-274">            sub_props,</span>
<span id="cb1-275">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>: red, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>sub_props},</span>
<span id="cb1-276">        ],</span>
<span id="cb1-277">    )</span>
<span id="cb1-278"></span>
<span id="cb1-279">    ax.text(</span>
<span id="cb1-280">        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-281">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb1-282">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Source: NOAA"</span>,</span>
<span id="cb1-283">        fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>source_fontsize,</span>
<span id="cb1-284">        fontweight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>source_fontweight,</span>
<span id="cb1-285">        color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>grey,</span>
<span id="cb1-286">    )</span>
<span id="cb1-287">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> ax</span>
<span id="cb1-288"></span>
<span id="cb1-289"></span>
<span id="cb1-290">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tweak_df(data_path, columns, idx_colname)</span>
<span id="cb1-291">p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plot_temps(df, idx_colname)</span>
<span id="cb1-292">fig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> themify(p)</span>
<span id="cb1-293">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fig.axes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb1-294">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> add_ax_text(ax)</span>
<span id="cb1-295">fig</span></code></pre></div>
</details>
</div>
<section id="data-processing-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="data-processing-pipeline">Data Processing Pipeline</h2>
<p>Below is the data pipeline used to generate the DataFrame for the upcoming visualization stage:</p>
<div class="sourceCode" id="annotated-cell-2" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-2-1">data_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"alta-noaa-1980-2019.csv"</span></span>
<span id="annotated-cell-2-2">columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TOBS"</span>]</span>
<span id="annotated-cell-2-3">idx_colname <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span></span>
<span id="annotated-cell-2-4">temp_colname <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"temp"</span></span>
<span id="annotated-cell-2-5"></span>
<span id="annotated-cell-2-6"></span>
<span id="annotated-cell-2-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> tweak_df(data_path: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, columns: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>], idx_colname: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span>):</span>
<span id="annotated-cell-2-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="annotated-cell-2-9">        pl.scan_csv(data_path)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-2-10" class="code-annotation-target">        .select(columns)</span>
<span id="annotated-cell-2-11">        .with_columns(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-2-12" class="code-annotation-target">            pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.to_datetime(),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-2-13" class="code-annotation-target">            pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TOBS"</span>).interpolate(),</span>
<span id="annotated-cell-2-14">        )</span>
<span id="annotated-cell-2-15">        .sort(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>)</span>
<span id="annotated-cell-2-16">        .with_columns(</span>
<span id="annotated-cell-2-17">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Caveat: Cannot be placed in the previous `with_columns()`</span></span>
<span id="annotated-cell-2-18">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># due to different statuses of `TOBS`.</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-2-19" class="code-annotation-target">            pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TOBS"</span>).rolling_mean(window_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, center<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TMEAN"</span>),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-2-20" class="code-annotation-target">            get_season_expr(col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>, alias<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>),</span>
<span id="annotated-cell-2-21">        )</span>
<span id="annotated-cell-2-22">        .with_columns(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-2-23" class="code-annotation-target">            add_day_of_season_expr(col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>, group_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>, alias<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>idx_colname)</span>
<span id="annotated-cell-2-24">        )</span>
<span id="annotated-cell-2-25">        .collect()</span>
<span id="annotated-cell-2-26">    )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="10" data-code-annotation="1">Select the <code>DATE</code> column (dates) and <code>TOBS</code> column (recorded temperatures in Fahrenheit).</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="12" data-code-annotation="2">Convert the <code>DATE</code> column to a datetime format.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="13" data-code-annotation="3">Perform interpolation on the <code>TOBS</code> column.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="19" data-code-annotation="4">Compute a 28-day rolling average for <code>TOBS</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="20" data-code-annotation="5">Use <code>get_season_expr()</code> to categorize each date into a <code>SEASON</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="23" data-code-annotation="6">Apply <code>add_day_of_season_expr()</code> to calculate <code>DAY_OF_SEASON</code>, representing days elapsed since the start of the season.</span>
</dd>
</dl>
<p>The first three steps involve straightforward Polars expressions. In the following two sub-sections, we’ll dive deeper into steps 5 and 6.</p>
<section id="categorizing-dates-into-summer-and-ski-seasons" class="level3">
<h3 class="anchored" data-anchor-id="categorizing-dates-into-summer-and-ski-seasons">Categorizing Dates into <code>Summer</code> and <code>Ski</code> Seasons</h3>
<p>To analyze seasonal trends, we classify dates into two categories:</p>
<ul>
<li><strong><code>Summer</code></strong>: Covers May through October.<br>
</li>
<li><strong><code>Ski</code></strong>: Covers November through April.</li>
</ul>
<p>If a date falls in November or December, it is assigned to the following year’s season. For example, <code>2015-10-31</code> is categorized as <code>Summer 2015</code>, while <code>2015-11-01</code> belongs to <code>Ski 2016</code>.</p>
<p>To implement this logic, we define <code>get_season_expr()</code>, which leverages Polars’ <a href="https://docs.pola.rs/api/python/dev/reference/expressions/api/polars.when.html">when-then-otherwise</a> expressions to determine the season and year.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_season_expr(col: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>, alias: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.expr:</span>
<span id="cb2-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb2-3">        (</span>
<span id="cb2-4">            pl.when((pl.col(col).dt.month().is_between(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, closed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"both"</span>)))</span>
<span id="cb2-5">            .then(pl.lit(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Summer "</span>))</span>
<span id="cb2-6">            .otherwise(pl.lit(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ski "</span>))</span>
<span id="cb2-7">        )</span>
<span id="cb2-8">        .add(</span>
<span id="cb2-9">            pl.when(pl.col(col).dt.month() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>)</span>
<span id="cb2-10">            .then(pl.col(col).dt.year().cast(pl.String))</span>
<span id="cb2-11">            .otherwise(pl.col(col).dt.year().add(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>).cast(pl.String))</span>
<span id="cb2-12">        )</span>
<span id="cb2-13">        .alias(alias)</span>
<span id="cb2-14">    )</span></code></pre></div>
<p>In this function:</p>
<ul>
<li>If the month is between May and October, the function assigns <code>"Summer "</code>. Otherwise, it assigns <code>"Ski "</code> (with a trailing space for concatenation).<br>
</li>
<li>The year is determined based on the month: dates from January to October retain their current year, while those in November and December are shifted to the next year.</li>
</ul>
<p>By applying this function, we can add a <code>SEASON</code> column to a DataFrame, ensuring each date is categorized correctly.</p>
</section>
<section id="calculating-the-total-days-for-each-season" class="level3">
<h3 class="anchored" data-anchor-id="calculating-the-total-days-for-each-season">Calculating the Total Days for Each Season</h3>
<p>Once we have the seasonal categories, we calculate <code>DAY_OF_SEASON</code>, which tracks the number of days elapsed within each season. This is achieved using the <a href="https://docs.pola.rs/api/python/dev/reference/expressions/api/polars.Expr.over.html">pl.expr.over()</a> expression, which operates similarly to Pandas’ <code>groupby().transform()</code>, applying transformations within groups.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> add_day_of_season_expr(</span>
<span id="cb3-2">    col: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>, group_col: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>, alias: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span></span>
<span id="cb3-3">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.expr:</span>
<span id="cb3-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb3-5">        (pl.col(col) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> pl.col(col).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()).dt.total_days().over(group_col).alias(alias)</span>
<span id="cb3-6">    )</span></code></pre></div>
</section>
</section>
<section id="visualizing-temperature-trends-with-plotnine" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-temperature-trends-with-plotnine">Visualizing Temperature Trends with Plotnine</h2>
<p>With the data prepared, we now turn our focus to visualization. The <code>plot_temps()</code> function is relatively long, so we’ll walk through it step by step. Ultimately, we’ll construct several intermediate DataFrames and use them to build a <code>ggplot</code> object for rendering.</p>
<section id="reshaping-the-main-dataframe" class="level3">
<h3 class="anchored" data-anchor-id="reshaping-the-main-dataframe">Reshaping the Main DataFrame</h3>
<p>We begin by filtering the dataset to include only rows corresponding to <code>Ski</code> seasons. Then, using <a href="https://docs.pola.rs/api/python/stable/reference/dataframe/api/polars.DataFrame.pivot.html"><code>pl.DataFrame.pivot()</code></a> and <a href="https://docs.pola.rs/api/python/stable/reference/dataframe/api/polars.DataFrame.unpivot.html"><code>pl.DataFrame.unpivot()</code></a>, we reshape the main DataFrame.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> plot_temps(</span>
<span id="cb4-2">    _df: pl.DataFrame, idx_colname: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span></span>
<span id="cb4-3">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> ggplot:</span>
<span id="cb4-4">    season_temps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> _df.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ski"</span>)).pivot(</span>
<span id="cb4-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>idx_colname, values<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TMEAN"</span>, aggregate_function<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"first"</span></span>
<span id="cb4-6">    )</span>
<span id="cb4-7"></span>
<span id="cb4-8">    df_main <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> season_temps.unpivot(</span>
<span id="cb4-9">        (cs.starts_with(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ski"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> cs.by_name(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ski 2019"</span>)),</span>
<span id="cb4-10">        index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>idx_colname,</span>
<span id="cb4-11">        variable_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>,</span>
<span id="cb4-12">        value_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>temp_colname,</span>
<span id="cb4-13">    ).select(</span>
<span id="cb4-14">        idx_colname,</span>
<span id="cb4-15">        temp_colname,</span>
<span id="cb4-16">        pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">slice</span>(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>).cast(pl.Int32),</span>
<span id="cb4-17">    )</span>
<span id="cb4-18">    ...</span></code></pre></div>
<p>Note: We intentionally exclude <code>Ski 2019</code> here, as it will be handled separately later.</p>
<p>Preview of <code>df_main</code>:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">shape: (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7_098</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb5-2">┌───────────────┬───────────┬──────┐</span>
<span id="cb5-3">│ DAY_OF_SEASON ┆ temp      ┆ year │</span>
<span id="cb5-4">│ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span>           ┆ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span>       ┆ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span>  │</span>
<span id="cb5-5">│ i64           ┆ f64       ┆ i32  │</span>
<span id="cb5-6">╞═══════════════╪═══════════╪══════╡</span>
<span id="cb5-7">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>             ┆ null      ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1980</span> │</span>
<span id="cb5-8">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>             ┆ null      ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1980</span> │</span>
<span id="cb5-9">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>             ┆ null      ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1980</span> │</span>
<span id="cb5-10">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>             ┆ null      ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1980</span> │</span>
<span id="cb5-11">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>             ┆ null      ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1980</span> │</span>
<span id="cb5-12">│ …             ┆ …         ┆ …    │</span>
<span id="cb5-13">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">177</span>           ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">44.0</span>      ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span> │</span>
<span id="cb5-14">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">178</span>           ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">44.464286</span> ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span> │</span>
<span id="cb5-15">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">179</span>           ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">44.607143</span> ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span> │</span>
<span id="cb5-16">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">180</span>           ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">44.142857</span> ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span> │</span>
<span id="cb5-17">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">181</span>           ┆ null      ┆ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span> │</span>
<span id="cb5-18">└───────────────┴───────────┴──────┘</span></code></pre></div>
</section>
<section id="building-a-dataframe-for-decade-averages" class="level3">
<h3 class="anchored" data-anchor-id="building-a-dataframe-for-decade-averages">Building a DataFrame for Decade Averages</h3>
<p>To reveal long-term patterns, we compute average temperature trends by decade. Each decade will be represented by a separate line with a distinct color.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> plot_temps(df_: pl.DataFrame, idx_colname: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> ggplot:</span>
<span id="cb6-2">    ...</span>
<span id="cb6-3">    decades <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1980</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1990</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010</span>]</span>
<span id="cb6-4">    blues <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0055EE"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0033CC"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0011AA"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#3377FF"</span>]</span>
<span id="cb6-5"></span>
<span id="cb6-6">    df_decade <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.concat(</span>
<span id="cb6-7">        [</span>
<span id="cb6-8">            season_temps.select(</span>
<span id="cb6-9">                idx_colname,</span>
<span id="cb6-10">                pl.mean_horizontal(cs.contains(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(decade)[:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])).alias(temp_colname),</span>
<span id="cb6-11">                pl.lit(b).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>),</span>
<span id="cb6-12">            )</span>
<span id="cb6-13">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> b, decade <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(blues, decades)</span>
<span id="cb6-14">        ],</span>
<span id="cb6-15">        how<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vertical"</span>,</span>
<span id="cb6-16">    )</span></code></pre></div>
<p>Preview of <code>df_decade</code>:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">shape: (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">728</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb7-2">┌───────────────┬───────────┬─────────┐</span>
<span id="cb7-3">│ DAY_OF_SEASON ┆ temp      ┆ color   │</span>
<span id="cb7-4">│ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span>           ┆ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span>       ┆ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span>     │</span>
<span id="cb7-5">│ i64           ┆ f64       ┆ <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>     │</span>
<span id="cb7-6">╞═══════════════╪═══════════╪═════════╡</span>
<span id="cb7-7">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>             ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">32.704365</span> ┆ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0055EE │</span></span>
<span id="cb7-8">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>             ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">32.156746</span> ┆ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0055EE │</span></span>
<span id="cb7-9">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>             ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">31.875</span>    ┆ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0055EE │</span></span>
<span id="cb7-10">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>             ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">31.561508</span> ┆ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0055EE │</span></span>
<span id="cb7-11">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>             ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">31.041667</span> ┆ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0055EE │</span></span>
<span id="cb7-12">│ …             ┆ …         ┆ …       │</span>
<span id="cb7-13">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">177</span>           ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">39.275</span>    ┆ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#3377FF │</span></span>
<span id="cb7-14">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">178</span>           ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">39.639286</span> ┆ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#3377FF │</span></span>
<span id="cb7-15">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">179</span>           ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">40.092857</span> ┆ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#3377FF │</span></span>
<span id="cb7-16">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">180</span>           ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">40.653571</span> ┆ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#3377FF │</span></span>
<span id="cb7-17">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">181</span>           ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">41.428571</span> ┆ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#3377FF │</span></span>
<span id="cb7-18">└───────────────┴───────────┴─────────┘</span></code></pre></div>
</section>
<section id="annotating-decade-lines" class="level3">
<h3 class="anchored" data-anchor-id="annotating-decade-lines">Annotating Decade Lines</h3>
<p>To enhance readability, we annotate each decade line in two ways: by marking the start and end points and by adding labels to the line endings. For this purpose, we create two separate DataFrames.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> plot_temps(df_: pl.DataFrame, idx_colname: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> ggplot:</span>
<span id="cb8-2">    ...</span>
<span id="cb8-3">    df_decade_pts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb8-4">        df_decade.group_by(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>), maintain_order<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb8-5">        .agg(</span>
<span id="cb8-6">            pl.col(idx_colname).first().append(pl.col(idx_colname).last()),</span>
<span id="cb8-7">            pl.col(temp_colname).first().append(pl.col(temp_colname).last()),</span>
<span id="cb8-8">        )</span>
<span id="cb8-9">        .explode(idx_colname, temp_colname)</span>
<span id="cb8-10">    )</span>
<span id="cb8-11"></span>
<span id="cb8-12">    decade_annts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb8-13">        df_decade_pts.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(pl.col(idx_colname).eq(pl.col(idx_colname).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()))</span>
<span id="cb8-14">        .select(temp_colname)</span>
<span id="cb8-15">        .to_series()</span>
<span id="cb8-16">        .to_list()</span>
<span id="cb8-17">    )</span>
<span id="cb8-18"></span>
<span id="cb8-19">    df_decade_annt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.DataFrame(</span>
<span id="cb8-20">        {</span>
<span id="cb8-21">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">185</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(decade_annts),</span>
<span id="cb8-22">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># adjust y position for better appearance</span></span>
<span id="cb8-23">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>: [</span>
<span id="cb8-24">                decade_annts[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>],</span>
<span id="cb8-25">                decade_annts[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb8-26">                decade_annts[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb8-27">                decade_annts[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>],</span>
<span id="cb8-28">            ],</span>
<span id="cb8-29">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>: blues,</span>
<span id="cb8-30">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>: decades,</span>
<span id="cb8-31">        }</span>
<span id="cb8-32">    )</span></code></pre></div>
<p>Preview of <code>df_decade_pts</code> (start and end points):</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">shape: (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb9-2">┌─────────┬───────────────┬───────────┐</span>
<span id="cb9-3">│ color   ┆ DAY_OF_SEASON ┆ temp      │</span>
<span id="cb9-4">│ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span>     ┆ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span>           ┆ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span>       │</span>
<span id="cb9-5">│ <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>     ┆ i64           ┆ f64       │</span>
<span id="cb9-6">╞═════════╪═══════════════╪═══════════╡</span>
<span id="cb9-7">│ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0055EE ┆ 0             ┆ 32.704365 │</span></span>
<span id="cb9-8">│ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0055EE ┆ 181           ┆ 34.357143 │</span></span>
<span id="cb9-9">│ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0033CC ┆ 0             ┆ 34.851786 │</span></span>
<span id="cb9-10">│ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0033CC ┆ 181           ┆ 44.535714 │</span></span>
<span id="cb9-11">│ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0011AA ┆ 0             ┆ 35.719643 │</span></span>
<span id="cb9-12">│ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0011AA ┆ 181           ┆ 40.77381  │</span></span>
<span id="cb9-13">│ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#3377FF ┆ 0             ┆ 35.380357 │</span></span>
<span id="cb9-14">│ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#3377FF ┆ 181           ┆ 41.428571 │</span></span>
<span id="cb9-15">└─────────┴───────────────┴───────────┘</span></code></pre></div>
<p>Preview of <code>df_decade_annt</code> (annotation labels):</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">shape: (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb10-2">┌─────┬───────────┬─────────┬───────┐</span>
<span id="cb10-3">│ x   ┆ y         ┆ color   ┆ label │</span>
<span id="cb10-4">│ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span> ┆ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span>       ┆ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span>     ┆ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span>   │</span>
<span id="cb10-5">│ i64 ┆ f64       ┆ <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>     ┆ i64   │</span>
<span id="cb10-6">╞═════╪═══════════╪═════════╪═══════╡</span>
<span id="cb10-7">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">185</span> ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">34.357143</span> ┆ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0055EE ┆ 1980  │</span></span>
<span id="cb10-8">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">185</span> ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">45.035714</span> ┆ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0033CC ┆ 1990  │</span></span>
<span id="cb10-9">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">185</span> ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">37.77381</span>  ┆ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0011AA ┆ 2000  │</span></span>
<span id="cb10-10">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">185</span> ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">41.428571</span> ┆ <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#3377FF ┆ 2010  │</span></span>
<span id="cb10-11">└─────┴───────────┴─────────┴───────┘</span></code></pre></div>
</section>
<section id="isolating-the-2019-ski-season" class="level3">
<h3 class="anchored" data-anchor-id="isolating-the-2019-ski-season">Isolating the 2019 Ski Season</h3>
<p>We separate out the 2019 <code>Ski</code> season so that we can highlight it independently in the final visualization.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> plot_temps(df_: pl.DataFrame, idx_colname: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> ggplot:</span>
<span id="cb11-2">    ...</span>
<span id="cb11-3">    ski_2019 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb11-4">        season_temps.select(</span>
<span id="cb11-5">            idx_colname, pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ski 2019"</span>).alias(temp_colname)</span>
<span id="cb11-6">        ).drop_nulls()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># "DAY_OF_SEASON"=181, "temp"=null</span></span>
<span id="cb11-7">    )</span></code></pre></div>
<p>Preview of <code>ski_2019</code>:</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">shape: (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">181</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb12-2">┌───────────────┬───────────┐</span>
<span id="cb12-3">│ DAY_OF_SEASON ┆ temp      │</span>
<span id="cb12-4">│ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span>           ┆ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span>       │</span>
<span id="cb12-5">│ i64           ┆ f64       │</span>
<span id="cb12-6">╞═══════════════╪═══════════╡</span>
<span id="cb12-7">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>             ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">33.214286</span> │</span>
<span id="cb12-8">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>             ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">32.892857</span> │</span>
<span id="cb12-9">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>             ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">32.25</span>     │</span>
<span id="cb12-10">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>             ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">31.142857</span> │</span>
<span id="cb12-11">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>             ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">30.357143</span> │</span>
<span id="cb12-12">│ …             ┆ …         │</span>
<span id="cb12-13">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">176</span>           ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">38.607143</span> │</span>
<span id="cb12-14">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">177</span>           ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">39.285714</span> │</span>
<span id="cb12-15">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">178</span>           ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">39.964286</span> │</span>
<span id="cb12-16">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">179</span>           ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">40.464286</span> │</span>
<span id="cb12-17">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">180</span>           ┆ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">41.25</span>     │</span>
<span id="cb12-18">└───────────────┴───────────┘</span></code></pre></div>
<p>We also prepare a small DataFrame to annotate the start and end points of the 2019 line:</p>
<p>Preview of <code>ski_2019_pts</code>:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> plot_temps(df_: pl.DataFrame, idx_colname: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> ggplot:</span>
<span id="cb13-2">    ...</span>
<span id="cb13-3">    ski_2019_pts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.concat([ski_2019.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), ski_2019.tail(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)])</span></code></pre></div>
</section>
<section id="creating-the-ggplot-object" class="level3">
<h3 class="anchored" data-anchor-id="creating-the-ggplot-object">Creating the ggplot Object</h3>
<p>We now bring everything together into a single <code>ggplot</code> object:</p>
<div class="sourceCode" id="annotated-cell-15" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-15-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> plot_temps(df_: pl.DataFrame, idx_colname: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> ggplot:</span>
<span id="annotated-cell-15-2">    ...</span>
<span id="annotated-cell-15-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-15-4" class="code-annotation-target">        ggplot(mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>idx_colname, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>temp_colname))</span>
<span id="annotated-cell-15-5">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># multiple grey lines</span></span>
<span id="annotated-cell-15-6">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_line(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-15-7" class="code-annotation-target">            mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"factor(year)"</span>),</span>
<span id="annotated-cell-15-8">            data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df_main,</span>
<span id="annotated-cell-15-9">            alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,</span>
<span id="annotated-cell-15-10">            size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="annotated-cell-15-11">        )</span>
<span id="annotated-cell-15-12">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4 blue lines</span></span>
<span id="annotated-cell-15-13">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_line(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-15-14" class="code-annotation-target">            mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"factor(color)"</span>),</span>
<span id="annotated-cell-15-15">            data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df_decade,</span>
<span id="annotated-cell-15-16">            color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df_decade[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>],</span>
<span id="annotated-cell-15-17">            size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-15-18" class="code-annotation-target">            lineend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"round"</span>,</span>
<span id="annotated-cell-15-19">        )</span>
<span id="annotated-cell-15-20">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2019 red line</span></span>
<span id="annotated-cell-15-21">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_line(</span>
<span id="annotated-cell-15-22">            data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ski_2019,</span>
<span id="annotated-cell-15-23">            color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>red,</span>
<span id="annotated-cell-15-24">            size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,</span>
<span id="annotated-cell-15-25">            lineend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"round"</span>,</span>
<span id="annotated-cell-15-26">        )</span>
<span id="annotated-cell-15-27">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 black dashed line for temp=32F</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-15-28" class="code-annotation-target">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_segment(</span>
<span id="annotated-cell-15-29">            mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, xend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>, yend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>),</span>
<span id="annotated-cell-15-30">            size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="annotated-cell-15-31">            linetype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>,</span>
<span id="annotated-cell-15-32">        )</span>
<span id="annotated-cell-15-33">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># start and end dots for 4 blue lines</span></span>
<span id="annotated-cell-15-34">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_point(</span>
<span id="annotated-cell-15-35">            mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>idx_colname, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>temp_colname),</span>
<span id="annotated-cell-15-36">            data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df_decade_pts,</span>
<span id="annotated-cell-15-37">            color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df_decade_pts[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>],</span>
<span id="annotated-cell-15-38">            size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,</span>
<span id="annotated-cell-15-39">        )</span>
<span id="annotated-cell-15-40">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># start and end dots for 2019 red line</span></span>
<span id="annotated-cell-15-41">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_point(</span>
<span id="annotated-cell-15-42">            mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>idx_colname, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>temp_colname),</span>
<span id="annotated-cell-15-43">            data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ski_2019_pts,</span>
<span id="annotated-cell-15-44">            color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>red,</span>
<span id="annotated-cell-15-45">            size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="annotated-cell-15-46">        )</span>
<span id="annotated-cell-15-47">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># annotations for 4 blue lines</span></span>
<span id="annotated-cell-15-48">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_text(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-15-49" class="code-annotation-target">            mapping<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>),</span>
<span id="annotated-cell-15-50">            data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df_decade_annt,</span>
<span id="annotated-cell-15-51">            color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df_decade_annt[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>],</span>
<span id="annotated-cell-15-52">            size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axis_fontsize,</span>
<span id="annotated-cell-15-53">            fontweight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axis_fontweight,</span>
<span id="annotated-cell-15-54">            ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>,</span>
<span id="annotated-cell-15-55">            va<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>,</span>
<span id="annotated-cell-15-56">        )</span>
<span id="annotated-cell-15-57">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> labs(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>idx_colname, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="annotated-cell-15-58">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> scale_x_continuous(</span>
<span id="annotated-cell-15-59">            breaks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span>],</span>
<span id="annotated-cell-15-60">            limits<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>),</span>
<span id="annotated-cell-15-61">            expand<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>),</span>
<span id="annotated-cell-15-62">        )</span>
<span id="annotated-cell-15-63">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> scale_y_continuous(breaks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>], limits<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>), expand<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="annotated-cell-15-64">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> scale_color_cmap(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Greys"</span>, guide<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="annotated-cell-15-65">    )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-15" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="4" data-code-annotation="1">We define the default aesthetic mapping in <a href="https://plotnine.org/reference/ggplot.html#plotnine.ggplot">ggplot()</a> to avoid repetition in later layers.</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="7" data-code-annotation="2"><code>factor(year)</code> is mapped to <code>color=</code>, and the <code>Greys</code> colormap is applied using <a href="https://plotnine.org/reference/scale_color_cmap.html#plotnine.scale_color_cmap">scale_color_cmap()</a>—a very convenient way to show progression.</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="14" data-code-annotation="3">For the decade lines, <code>factor(color)</code> is mapped to the <code>fill=</code> aesthetic. Colors are controlled via a <code>color</code> column in the dataframe—an effective trick.</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="18" data-code-annotation="4">The <code>lineend=</code> parameter is useful if you don’t plan to mark endpoints with dots.</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="28" data-code-annotation="5">Using <a href="https://plotnine.org/reference/geom_hline.html#plotnine.geom_hline">geom_hline()</a> would extend the line infinitely in both directions. In this case, we used <a href="https://plotnine.org/reference/geom_segment.html#plotnine.geom_segment">geom_segment()</a> to constrain the line.</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="49" data-code-annotation="6">The <code>label=</code> aesthetic in <a href="https://plotnine.org/reference/geom_text.html#plotnine.geom_text">geom_text()</a> is mapped from the <code>label</code> column in <code>df_decade_annt</code>.</span>
</dd>
</dl>
</section>
</section>
<section id="touchups" class="level2">
<h2 class="anchored" data-anchor-id="touchups">Touchups</h2>
<section id="adding-a-theme" class="level3">
<h3 class="anchored" data-anchor-id="adding-a-theme">Adding a Theme</h3>
<p>We apply a custom theme using the <code>themify()</code> function, adjusting various <strong>themeable</strong> elements to refine the plot’s appearance:</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> points_to_inches(points):</span>
<span id="cb14-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> points <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span></span>
<span id="cb14-3"></span>
<span id="cb14-4"></span>
<span id="cb14-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> themify(p: ggplot) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Figure:</span>
<span id="cb14-6">    figsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">160</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">165</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pts</span></span>
<span id="cb14-7">    figsize_inches <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [points_to_inches(dim) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> dim <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> figsize]</span>
<span id="cb14-8"></span>
<span id="cb14-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb14-10">        p</span>
<span id="cb14-11">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> theme_classic()</span>
<span id="cb14-12">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> theme(</span>
<span id="cb14-13">            axis_line_y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_blank(),</span>
<span id="cb14-14">            axis_title_x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_text(weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axis_fontweight, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axis_fontsize),</span>
<span id="cb14-15">            axis_title_y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_text(weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axis_fontweight, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axis_fontsize),</span>
<span id="cb14-16">            axis_text_x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_text(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb14-17">            axis_text_y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_text(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb14-18">            dpi<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>,</span>
<span id="cb14-19">            figure_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>figsize_inches,</span>
<span id="cb14-20">            aspect_ratio<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb14-21">            text<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>element_text(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto"</span>),</span>
<span id="cb14-22">        )</span>
<span id="cb14-23">    ).draw(show<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span></code></pre></div>
</section>
<section id="adding-a-title-and-source-note" class="level3">
<h3 class="anchored" data-anchor-id="adding-a-title-and-source-note">Adding a Title and Source Note</h3>
<p>For the title, we use <code>ax_text()</code> from the <a href="https://github.com/znstrider/highlight_text">HighlightText</a> library. It allows inline text highlighting using <code>&lt; &gt;</code>, letting us emphasize specific parts of the title like <code>&lt;Alta Ski Resort&gt;</code>, <code>&lt;Temperature trends by &gt;</code>, <code>&lt;decade&gt;</code>, <code>&lt; and &gt;</code>, and <code>&lt;2019&gt;</code> with customized styles.</p>
<p>To add a source note, we simply use Matplotlib’s <code>ax.text()</code>:</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> add_ax_text(ax: Axes) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Axes:</span>
<span id="cb15-2">    ax_text(</span>
<span id="cb15-3">        s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;Alta Ski Resort&gt;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;Temperature trends by &gt;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;decade&gt;&lt; and &gt;&lt;2019&gt;"</span>,</span>
<span id="cb15-4">        x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb15-5">        y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">55</span>,</span>
<span id="cb15-6">        fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>heading_fontsize,</span>
<span id="cb15-7">        ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax,</span>
<span id="cb15-8">        va<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>,</span>
<span id="cb15-9">        ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>,</span>
<span id="cb15-10">        zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb15-11">        highlight_textprops<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb15-12">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontsize"</span>: heading_fontsize, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontweight"</span>: heading_fontweight},</span>
<span id="cb15-13">            sub_props,</span>
<span id="cb15-14">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>: blue, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>sub_props},</span>
<span id="cb15-15">            sub_props,</span>
<span id="cb15-16">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>: red, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>sub_props},</span>
<span id="cb15-17">        ],</span>
<span id="cb15-18">    )</span>
<span id="cb15-19"></span>
<span id="cb15-20">    ax.text(</span>
<span id="cb15-21">        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb15-22">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb15-23">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Source: NOAA"</span>,</span>
<span id="cb15-24">        fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>source_fontsize,</span>
<span id="cb15-25">        fontweight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>source_fontweight,</span>
<span id="cb15-26">        color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>grey,</span>
<span id="cb15-27">    )</span>
<span id="cb15-28">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> ax</span></code></pre></div>
</section>
</section>
<section id="rendering-the-plot" class="level2">
<h2 class="anchored" data-anchor-id="rendering-the-plot">Rendering the Plot</h2>
<p>Now we put everything together and render the final plot. A key trick here is retrieving the <code>ax</code> object using <code>fig.axes[0]</code>, which allows us to apply both HighlightText and regular Matplotlib functions.</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tweak_df(data_path, columns, idx_colname)</span>
<span id="cb16-2">p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plot_temps(df, idx_colname)</span>
<span id="cb16-3">fig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> themify(p)</span>
<span id="cb16-4">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fig.axes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb16-5">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> add_ax_text(ax)</span>
<span id="cb16-6">fig</span></code></pre></div>
</section>
<section id="takeaways" class="level2">
<h2 class="anchored" data-anchor-id="takeaways">Takeaways</h2>
<p>Wrapping up this post, I’ve come to appreciate how powerful the plotnine library truly is. While its aesthetic system requires a bit of mental shift, it offers a clean, expressive way to build layered visualizations.</p>
<p>One key takeaway for me is that each layer can operate on its own dataset, which adds a lot of flexibility. What I enjoyed most, though, is the theme system—it makes it easy to define a consistent visual style that can be reused across different plots.</p>
<p>One limitation I ran into was the lack of a plotnine-native alternative to <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplot_mosaic.html">pli.subplot_mosaic()</a>. This feature allows for more granular layout control—for example, dividing the figure into separate axes with custom height ratios for the title, main plot, and source note using <code>gridspec_kw={"height_ratios": [6, 12, 1]}</code>.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Disclaimer
</div>
</div>
<div class="callout-body-container callout-body">
<p>This post was drafted by me, with AI assistance to refine the content.</p>
</div>
</div>


</section>

 ]]></description>
  <category>python</category>
  <category>polars</category>
  <category>matplotlib</category>
  <category>plotnine</category>
  <guid>https://tech.ycwu.space/posts/p9-polars-alta-ski-resort/20250412.html</guid>
  <pubDate>Sat, 12 Apr 2025 00:00:00 GMT</pubDate>
  <media:content url="https://tech.ycwu.space/posts/p9-polars-alta-ski-resort/alta_ski_resort.png" medium="image" type="image/png" height="131" width="144"/>
</item>
<item>
  <title>How to Access the Axes in Plotnine</title>
  <dc:creator>Jerry Wu</dc:creator>
  <link>https://tech.ycwu.space/posts/access-axes-in-plotnine/20250411.html</link>
  <description><![CDATA[ 





<p>This is a short post documenting my experience trying to retrieve the <code>Axes</code> from <a href="https://plotnine.org/">plotnine</a>.</p>
<p>The idea was inspired by <a href="https://github.com/nrennie/2024-plotnine-contest">this code</a> and <a href="https://www.youtube.com/watch?v=NBGJuaBF2rc">this video</a> I came across, but the original solution didn’t quite work for me. Fortunately, I found that we can access the list of <code>Axes</code> directly using either <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.figure.Figure.axes.html"><code>fig.axes</code></a> or <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.figure.Figure.get_axes.html#matplotlib.figure.Figure.get_axes"><code>fig.get_axes()</code></a>.</p>
<p>In the example below, I adapt a snippet from the <a href="https://plotnine.org/reference/geom_smooth.html#examples">plotnine documentation</a> to demonstrate how to highlight text in color using <a href="https://github.com/znstrider/highlight_text">HighlightText</a>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tech.ycwu.space/posts/access-axes-in-plotnine/p9_ht_ax_text.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="plotnine used in combination with HighlightText"></p>
</figure>
</div>
<div id="27231493" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> highlight_text <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> ht</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> plotnine <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> aes, geom_point, ggplot, labs, theme_matplotlib, theme_set</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> plotnine.data <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> mpg</span>
<span id="cb1-4"></span>
<span id="cb1-5">theme_set(theme_matplotlib())</span>
<span id="cb1-6"></span>
<span id="cb1-7">p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb1-8">    ggplot(mpg, aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"displ"</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hwy"</span>))</span>
<span id="cb1-9">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_point()</span>
<span id="cb1-10">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> labs(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"displacement"</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"horsepower"</span>)</span>
<span id="cb1-11">)</span>
<span id="cb1-12"></span>
<span id="cb1-13">fig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> p.draw()</span>
<span id="cb1-14">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fig.axes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># or via fig.get_axes()[0]</span></span>
<span id="cb1-15">ht_ax_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Color highlighted by &lt;HighlightText::{"color": "#E58606"}&gt;'</span></span>
<span id="cb1-16">ht.ax_text(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, ht_ax_text, vsep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, va<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>, ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax)</span>
<span id="cb1-17">fig</span></code></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Disclaimer
</div>
</div>
<div class="callout-body-container callout-body">
<p>This post was drafted by me, with AI assistance to refine the content.</p>
</div>
</div>



 ]]></description>
  <category>python</category>
  <category>matplotlib</category>
  <category>plotnine</category>
  <guid>https://tech.ycwu.space/posts/access-axes-in-plotnine/20250411.html</guid>
  <pubDate>Fri, 11 Apr 2025 00:00:00 GMT</pubDate>
  <media:content url="https://tech.ycwu.space/posts/access-axes-in-plotnine/p9_ht_ax_text.png" medium="image" type="image/png" height="108" width="144"/>
</item>
<item>
  <title>Clone the Reciprocal Tariffs Table Using Great Tables</title>
  <dc:creator>Jerry Wu</dc:creator>
  <link>https://tech.ycwu.space/posts/clone-reciprocal-tariffs-table/20250403.html</link>
  <description><![CDATA[ 





<p>This post demonstrates how to clone the Reciprocal Tariffs table that President Donald Trump announced on April 2 on <a href="https://truthsocial.com/@realDonaldTrump/114270398531479278">Truth Social</a>.</p>
<p>Since the code is largely self-explanatory, I will highlight some tricks and caveats I encountered while building the table:</p>
<ol type="1">
<li>The <code>data</code> dictionary was extracted with the help of AI.</li>
<li>The border radius was one of the trickiest aspects of the table—it took some time to figure out how to fill the gap between the rounded corners and the rectangle. Fortunately, I drew inspiration from the Great Tables example, <a href="https://posit-dev.github.io/great-tables/examples/">Highest Paid Athletes in 2023</a>. The solution was to use two <code>&lt;div&gt;</code> tags, which allowed me to assign distinct colors to the inside and outside of the border.</li>
<li>I created four empty columns—<code>["0", "1", "2", "3"]</code>—to serve as borders. This allowed for easier adjustment of border properties such as color and width. An interesting feature of <a href="https://posit-dev.github.io/great-tables/reference/GT.cols_width.html#great_tables.GT.cols_width">GT.cols_width()</a> is that you can set column widths using percentages, and the total doesn’t need to add up to exactly 100%—it just works. This is especially handy when experimenting with different table designs, as it lets you estimate widths without worrying about precise calculations.</li>
<li>I added a “mod” column to help distinguish whether a row’s index is odd or even. This made it possible to combine <a href="https://docs.pola.rs/api/python/stable/reference/expressions/api/polars.when.html">pl.when().then().otherwise()</a> with <a href="https://docs.pola.rs/api/python/stable/reference/expressions/api/polars.Expr.map_elements.html">pl.Expr.map_elements()</a>. Although <code>pl.Expr.map_elements()</code> is generally considered an anti-pattern in Polars, I believe it fits my use case well.</li>
<li>The <code>column_labels_border_bottom_style=</code> parameter in <a href="https://posit-dev.github.io/great-tables/reference/GT.tab_options.html#great_tables.GT.tab_options">GT.tab_options()</a> is key to hiding the line between the column labels and the table body.</li>
<li>Logo embedding might seem a bit tricky if you’re new to Great Tables; I suggest reading the <a href="https://posit-dev.github.io/great-tables/blog/rendering-images/">blog post</a> that details how to render images anywhere in Great Tables.</li>
<li>To enhance the overall visual effect, I added a row at the end of the table and filled it with the same background color.</li>
<li>The original table featured two rings, but I was only able to implement the inner one using <a href="https://posit-dev.github.io/great-tables/reference/GT.opt_table_outline.html#great_tables.GT.opt_table_outline">GT.opt_table_outline()</a>. I decided to leave it out for a cleaner appearance.</li>
<li>While the color codes and font properties could be further enhanced, Great Tables successfully replicates the table’s structure and style with only minor differences.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tech.ycwu.space/posts/clone-reciprocal-tariffs-table/reciprocal_tariffs_gt.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Cloned Reciprocal Tariffs Table"></p>
</figure>
</div>
<div id="7d11de4b" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Show full code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> polars <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pl</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> great_tables <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> GT, google_font, html, loc, style, vals</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># source1: https://truthsocial.com/@realDonaldTrump/114270398531479278</span></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># source2:</span></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># "https://upload.wikimedia.org/wikipedia/commons/</span></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># thumb/3/36/Seal_of_the_President_of_the_United_States.svg/</span></span>
<span id="cb1-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 800px-Seal_of_the_President_of_the_United_States.svg.png"</span></span>
<span id="cb1-9">logo <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> vals.fmt_image(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"logo.png"</span>, height<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb1-10"></span>
<span id="cb1-11">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb1-12">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"country"</span>: [</span>
<span id="cb1-13">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"China"</span>,</span>
<span id="cb1-14">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"European Union"</span>,</span>
<span id="cb1-15">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vietnam"</span>,</span>
<span id="cb1-16">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Taiwan"</span>,</span>
<span id="cb1-17">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Japan"</span>,</span>
<span id="cb1-18">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"India"</span>,</span>
<span id="cb1-19">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"South Korea"</span>,</span>
<span id="cb1-20">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Thailand"</span>,</span>
<span id="cb1-21">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Switzerland"</span>,</span>
<span id="cb1-22">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Indonesia"</span>,</span>
<span id="cb1-23">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Malaysia"</span>,</span>
<span id="cb1-24">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cambodia"</span>,</span>
<span id="cb1-25">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"United Kingdom"</span>,</span>
<span id="cb1-26">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"South Africa"</span>,</span>
<span id="cb1-27">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Brazil"</span>,</span>
<span id="cb1-28">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bangladesh"</span>,</span>
<span id="cb1-29">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Singapore"</span>,</span>
<span id="cb1-30">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Israel"</span>,</span>
<span id="cb1-31">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Philippines"</span>,</span>
<span id="cb1-32">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chile"</span>,</span>
<span id="cb1-33">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Australia"</span>,</span>
<span id="cb1-34">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pakistan"</span>,</span>
<span id="cb1-35">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Turkey"</span>,</span>
<span id="cb1-36">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sri Lanka"</span>,</span>
<span id="cb1-37">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Colombia"</span>,</span>
<span id="cb1-38">    ],</span>
<span id="cb1-39">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tariffs_charged"</span>: [</span>
<span id="cb1-40">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"67%"</span>,</span>
<span id="cb1-41">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"39%"</span>,</span>
<span id="cb1-42">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"90%"</span>,</span>
<span id="cb1-43">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"64%"</span>,</span>
<span id="cb1-44">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"46%"</span>,</span>
<span id="cb1-45">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"52%"</span>,</span>
<span id="cb1-46">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"50%"</span>,</span>
<span id="cb1-47">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"72%"</span>,</span>
<span id="cb1-48">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"61%"</span>,</span>
<span id="cb1-49">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"64%"</span>,</span>
<span id="cb1-50">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"47%"</span>,</span>
<span id="cb1-51">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"97%"</span>,</span>
<span id="cb1-52">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-53">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"60%"</span>,</span>
<span id="cb1-54">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-55">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"74%"</span>,</span>
<span id="cb1-56">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-57">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"33%"</span>,</span>
<span id="cb1-58">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"34%"</span>,</span>
<span id="cb1-59">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-60">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-61">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"58%"</span>,</span>
<span id="cb1-62">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-63">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"88%"</span>,</span>
<span id="cb1-64">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-65">    ],</span>
<span id="cb1-66">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reciprocal_tariffs"</span>: [</span>
<span id="cb1-67">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"34%"</span>,</span>
<span id="cb1-68">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"20%"</span>,</span>
<span id="cb1-69">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"46%"</span>,</span>
<span id="cb1-70">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"32%"</span>,</span>
<span id="cb1-71">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"24%"</span>,</span>
<span id="cb1-72">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"26%"</span>,</span>
<span id="cb1-73">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"25%"</span>,</span>
<span id="cb1-74">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"36%"</span>,</span>
<span id="cb1-75">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"31%"</span>,</span>
<span id="cb1-76">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"32%"</span>,</span>
<span id="cb1-77">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"24%"</span>,</span>
<span id="cb1-78">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"49%"</span>,</span>
<span id="cb1-79">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-80">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"30%"</span>,</span>
<span id="cb1-81">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-82">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"37%"</span>,</span>
<span id="cb1-83">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-84">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"17%"</span>,</span>
<span id="cb1-85">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"17%"</span>,</span>
<span id="cb1-86">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-87">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-88">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"29%"</span>,</span>
<span id="cb1-89">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-90">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"44%"</span>,</span>
<span id="cb1-91">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10%"</span>,</span>
<span id="cb1-92">    ],</span>
<span id="cb1-93">}</span>
<span id="cb1-94"></span>
<span id="cb1-95">dark_navy_blue <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0B162A"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># background</span></span>
<span id="cb1-96">light_blue <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#B5D3E7"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># row</span></span>
<span id="cb1-97">white <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FFFFFF"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># row</span></span>
<span id="cb1-98">yellow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#F6D588"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># "reciprocal_tariffs" column</span></span>
<span id="cb1-99">gold <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FFF8DE"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># logo</span></span>
<span id="cb1-100"></span>
<span id="cb1-101"></span>
<span id="cb1-102"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> change_border_radius(</span>
<span id="cb1-103">    x: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, border_radius: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, background_color1: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, background_color2: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb1-104">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb1-105">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-106"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    &lt;div style="background-color: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>background_color1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">;border: None"&gt;</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-107"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        &lt;div style="border-radius: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>border_radius<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">;</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-108"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">                    background-color:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>background_color2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">;"&gt;</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-109"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">            &amp;nbsp;</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-110"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        &lt;/div&gt;</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-111"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    &lt;/div&gt;</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-112"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb1-113"></span>
<span id="cb1-114"></span>
<span id="cb1-115"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> change_border_radius_expr(</span>
<span id="cb1-116">    cols: pl.Expr,</span>
<span id="cb1-117">    return_dtype: pl.DataType,</span>
<span id="cb1-118">    border_radius: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb1-119">    background_color1: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb1-120">    background_color2: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb1-121">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.Expr:</span>
<span id="cb1-122">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> cols.map_elements(</span>
<span id="cb1-123">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: change_border_radius(</span>
<span id="cb1-124">            x, border_radius, background_color1, background_color2</span>
<span id="cb1-125">        ),</span>
<span id="cb1-126">        return_dtype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>return_dtype,</span>
<span id="cb1-127">    )</span>
<span id="cb1-128"></span>
<span id="cb1-129"></span>
<span id="cb1-130">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb1-131">    pl.DataFrame(data)</span>
<span id="cb1-132">    .with_row_index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mod"</span>)</span>
<span id="cb1-133">    .with_columns(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mod"</span>).mod(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>[pl.lit(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>).alias(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(i)) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)])</span>
<span id="cb1-134">    .with_columns(</span>
<span id="cb1-135">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># "country" and "tariffs_charged" columns</span></span>
<span id="cb1-136">        pl.when(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mod"</span>).eq(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb1-137">        .then(</span>
<span id="cb1-138">            change_border_radius_expr(</span>
<span id="cb1-139">                pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"country"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tariffs_charged"</span>),</span>
<span id="cb1-140">                pl.String,</span>
<span id="cb1-141">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5px"</span>,</span>
<span id="cb1-142">                dark_navy_blue,</span>
<span id="cb1-143">                light_blue,</span>
<span id="cb1-144">            )</span>
<span id="cb1-145">        )</span>
<span id="cb1-146">        .otherwise(</span>
<span id="cb1-147">            change_border_radius_expr(</span>
<span id="cb1-148">                pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"country"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tariffs_charged"</span>),</span>
<span id="cb1-149">                pl.String,</span>
<span id="cb1-150">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5px"</span>,</span>
<span id="cb1-151">                dark_navy_blue,</span>
<span id="cb1-152">                white,</span>
<span id="cb1-153">            )</span>
<span id="cb1-154">        ),</span>
<span id="cb1-155">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># "reciprocal_tariffs" column</span></span>
<span id="cb1-156">        change_border_radius_expr(</span>
<span id="cb1-157">            pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reciprocal_tariffs"</span>), pl.String, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5px"</span>, dark_navy_blue, yellow</span>
<span id="cb1-158">        ),</span>
<span id="cb1-159">    )</span>
<span id="cb1-160">    .select([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"country"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tariffs_charged"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reciprocal_tariffs"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3"</span>])</span>
<span id="cb1-161">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a row at the end of the table</span></span>
<span id="cb1-162">    .pipe(</span>
<span id="cb1-163">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> df_: pl.concat(</span>
<span id="cb1-164">            [df_, pl.DataFrame({col: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> col <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> df_.columns})], how<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vertical"</span></span>
<span id="cb1-165">        )</span>
<span id="cb1-166">    )</span>
<span id="cb1-167">)</span>
<span id="cb1-168"></span>
<span id="cb1-169"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># inner_ring_style, inner_ring_width, inner_ring_color = "dashed", "3px", "orange"</span></span>
<span id="cb1-170"></span>
<span id="cb1-171">(</span>
<span id="cb1-172">    GT(df)</span>
<span id="cb1-173">    .cols_align(</span>
<span id="cb1-174">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tariffs_charged"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reciprocal_tariffs"</span>]</span>
<span id="cb1-175">    )</span>
<span id="cb1-176">    .cols_label(</span>
<span id="cb1-177">        {</span>
<span id="cb1-178">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"country"</span>: html(</span>
<span id="cb1-179">                <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-180"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">                &lt;br&gt;</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-181"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">                &lt;div&gt;</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-182"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">                    </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>logo<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">&amp;nbsp;</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-183"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">                    &lt;span style="color: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>gold<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">; font-size: 40px;"&gt;</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-184"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">                        &amp;nbsp&amp;nbsp;Reciprocal Tariffs</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-185"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">                    &lt;/span&gt;</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-186"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">                &lt;/div&gt;</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-187"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">                &lt;br&gt;</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-188"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">                &lt;b&gt;Country&lt;/b&gt;</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-189"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">                """</span></span>
<span id="cb1-190">            ),</span>
<span id="cb1-191">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tariffs_charged"</span>: html(</span>
<span id="cb1-192">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-193"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                &lt;b&gt;Tariffs Charged&lt;br&gt;to the U.S.A.&lt;/b&gt;</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-194"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                &lt;br&gt;</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-195"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                &lt;span style="font-size: 12px;"&gt;</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-196"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                    Including&lt;br&gt;Currency Manipulation&lt;br&gt;and Trade Barriers</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-197"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                &lt;/span&gt;</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-198"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                """</span></span>
<span id="cb1-199">            ),</span>
<span id="cb1-200">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reciprocal_tariffs"</span>: html(</span>
<span id="cb1-201">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;b&gt;U.S.A. Discounted&lt;br&gt;Reciprocal Tariffs&lt;/b&gt;"</span></span>
<span id="cb1-202">            ),</span>
<span id="cb1-203">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb1-204">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb1-205">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb1-206">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb1-207">        }</span>
<span id="cb1-208">    )</span>
<span id="cb1-209">    .cols_width(</span>
<span id="cb1-210">        {</span>
<span id="cb1-211">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"country"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"50%"</span>,</span>
<span id="cb1-212">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3%"</span>,</span>
<span id="cb1-213">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"7%"</span>,</span>
<span id="cb1-214">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"7%"</span>,</span>
<span id="cb1-215">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3%"</span>,</span>
<span id="cb1-216">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tariffs_charged"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"18%"</span>,</span>
<span id="cb1-217">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reciprocal_tariffs"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"18%"</span>,</span>
<span id="cb1-218">        }</span>
<span id="cb1-219">    )</span>
<span id="cb1-220">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For labels and body:</span></span>
<span id="cb1-221">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set the background color of the labels and body to `dark_navy_blue`</span></span>
<span id="cb1-222">    .tab_style(</span>
<span id="cb1-223">        style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.fill(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dark_navy_blue),</span>
<span id="cb1-224">        locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[loc.column_labels(), loc.body()],</span>
<span id="cb1-225">    )</span>
<span id="cb1-226">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For body:</span></span>
<span id="cb1-227">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set the border color of the body to `dark_navy_blue`</span></span>
<span id="cb1-228">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set the font, weight and size</span></span>
<span id="cb1-229">    .tab_style(</span>
<span id="cb1-230">        style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb1-231">            style.borders(sides<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dark_navy_blue),</span>
<span id="cb1-232">            style.text(</span>
<span id="cb1-233">                font<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>google_font(name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Trajan Pro"</span>),</span>
<span id="cb1-234">                weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,</span>
<span id="cb1-235">                size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xx-large"</span>,</span>
<span id="cb1-236">            ),</span>
<span id="cb1-237">        ],</span>
<span id="cb1-238">        locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body(),</span>
<span id="cb1-239">    )</span>
<span id="cb1-240">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For labels:</span></span>
<span id="cb1-241">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set the font, weight, size and color</span></span>
<span id="cb1-242">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># center-align the labels</span></span>
<span id="cb1-243">    .tab_style(</span>
<span id="cb1-244">        style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb1-245">            style.text(</span>
<span id="cb1-246">                font<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>google_font(name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Georgia"</span>),</span>
<span id="cb1-247">                weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,</span>
<span id="cb1-248">                size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"large"</span>,</span>
<span id="cb1-249">                color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>white,</span>
<span id="cb1-250">            ),</span>
<span id="cb1-251">            style.css(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-align: center;"</span>),</span>
<span id="cb1-252">        ],</span>
<span id="cb1-253">        locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.column_labels(),</span>
<span id="cb1-254">    )</span>
<span id="cb1-255">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># hide the bottom line of the label section</span></span>
<span id="cb1-256">    .tab_options(column_labels_border_bottom_style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hidden"</span>)</span>
<span id="cb1-257">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set the body background color to `dark_navy_blue` for the last row</span></span>
<span id="cb1-258">    .tab_style(</span>
<span id="cb1-259">        style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.fill(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dark_navy_blue),</span>
<span id="cb1-260">        locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body(rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb1-261">    )</span>
<span id="cb1-262">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># .opt_table_outline(</span></span>
<span id="cb1-263">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     style=inner_ring_style,</span></span>
<span id="cb1-264">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     width=inner_ring_width,</span></span>
<span id="cb1-265">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     color=inner_ring_color,</span></span>
<span id="cb1-266">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># )</span></span>
<span id="cb1-267">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># need to adjust `window_size` to obtain a higher-quality figure</span></span>
<span id="cb1-268">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># .save("reciprocal_tariffs_gt.png", web_driver="firefox", window_size=(1200, 1000))</span></span>
<span id="cb1-269">)</span></code></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Disclaimer
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>This table is intended as a self-practice project, and the data in the table may not be 100% accurate. Please refer to the <a href="https://truthsocial.com/@realDonaldTrump/114270398531479278">original source</a> if you require verified data.</li>
<li>This post was drafted by me, with AI assistance to refine the content.</li>
</ol>
</div>
</div>



 ]]></description>
  <category>python</category>
  <category>polars</category>
  <category>gt</category>
  <guid>https://tech.ycwu.space/posts/clone-reciprocal-tariffs-table/20250403.html</guid>
  <pubDate>Thu, 03 Apr 2025 00:00:00 GMT</pubDate>
  <media:content url="https://tech.ycwu.space/posts/clone-reciprocal-tariffs-table/reciprocal_tariffs_gt.png" medium="image" type="image/png" height="193" width="144"/>
</item>
<item>
  <title>Applying Custom Color Palettes to the Table Body in Great Tables</title>
  <dc:creator>Jerry Wu</dc:creator>
  <link>https://tech.ycwu.space/posts/table-body-custom-palette/20250225.html</link>
  <description><![CDATA[ 





<p>This post provides a concise guide on styling the table body with custom colors using Pandas and Polars.</p>
<p>There are two primary methods for applying a color palette: one leverages a pre-existing column containing color values, while the other determines colors dynamically based on conditions. I’ll walk you through both approaches.</p>
<p>Since all the generated tables will have the same appearance, I’ll display the final result just once:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tech.ycwu.space/posts/table-body-custom-palette/table_body_custom_palette.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Table Body with a Custom Palette"></p>
</figure>
</div>
<section id="preparations" class="level2">
<h2 class="anchored" data-anchor-id="preparations">Preparations</h2>
<p>We’ll start by creating a <code>data</code> dictionary, which will be used with Pandas or Polars later. Additionally, we’ll define a <code>color_mapping</code> dictionary to store the palette information for styling.</p>
<div id="1afd9b28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> polars <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pl</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> great_tables <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> GT, from_column, loc, style</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> polars <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> selectors <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> cs</span>
<span id="cb1-5"></span>
<span id="cb1-6">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb1-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col1"</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>],</span>
<span id="cb1-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col2"</span>: [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"z"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"z"</span>],</span>
<span id="cb1-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>: [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightgrey"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightblue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightblue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"papayawhip"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"papayawhip"</span>],</span>
<span id="cb1-10">}</span>
<span id="cb1-11"></span>
<span id="cb1-12">color_mapping <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightgrey"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightblue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"z"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"papayawhip"</span>}</span></code></pre></div>
</div>
</section>
<section id="pandas" class="level2">
<h2 class="anchored" data-anchor-id="pandas">Pandas</h2>
<p>First, we create a Pandas DataFrame called <code>df_pd</code> using <code>data</code> as the input:</p>
<div id="c379c6b5" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">df_pd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(data)</span>
<span id="cb2-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(df_pd)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   col1 col2       color
0     2    x   lightgrey
1     5    y   lightblue
2     7    y   lightblue
3    10    z  papayawhip
4    15    z  papayawhip</code></pre>
</div>
</div>
<section id="using-an-existing-column" class="level3">
<h3 class="anchored" data-anchor-id="using-an-existing-column">Using an Existing Column</h3>
<p>In this straightforward scenario, the DataFrame already contains a predefined column with color names for each row. You can use the <a href="https://posit-dev.github.io/great-tables/reference/from_column.html#great_tables.from_column">from_column()</a> function provided by Great Tables to apply colors to the table body:</p>
<div id="0d75dbd7" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">(</span>
<span id="cb4-2">    GT(df_pd)</span>
<span id="cb4-3">    .tab_style(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.fill(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>from_column(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>)), locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body())</span>
<span id="cb4-4">    .cols_align(align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>)</span>
<span id="cb4-5">    .opt_stylize(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pink"</span>)</span>
<span id="cb4-6">)</span></code></pre></div>
</div>
</section>
<section id="using-functions" class="level3">
<h3 class="anchored" data-anchor-id="using-functions">Using Functions</h3>
<p>In cases where colors need to be determined dynamically based on conditions, the <a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.case_when.html#pandas.Series.case_when">pd.Series.case_when()</a> function can be very useful. The following example categorizes the values of the <code>col1</code> column into three different colors:</p>
<div id="c4dc89e1" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> color_selector(df_):</span>
<span id="cb5-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df_[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col1"</span>].case_when(</span>
<span id="cb5-3">        [</span>
<span id="cb5-4">            (df_[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col1"</span>].lt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightgrey"</span>),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># &lt;3</span></span>
<span id="cb5-5">            (df_[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col1"</span>].lt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightblue"</span>),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># &lt;10</span></span>
<span id="cb5-6">            (df_[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col1"</span>].ge(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"papayawhip"</span>),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># &gt;=10</span></span>
<span id="cb5-7">        ]</span>
<span id="cb5-8">    )</span>
<span id="cb5-9"></span>
<span id="cb5-10"></span>
<span id="cb5-11">(</span>
<span id="cb5-12">    GT(df_pd)</span>
<span id="cb5-13">    .tab_style(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.fill(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>color_selector), locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body())</span>
<span id="cb5-14">    .cols_align(align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>)</span>
<span id="cb5-15">    .opt_stylize(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pink"</span>)</span>
<span id="cb5-16">)</span></code></pre></div>
</div>
<p>For categorical-like columns (e.g., <code>col2</code>), a simple value-to-color mapping may be sufficient. In such cases, a predefined dictionary can be used with <a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.map.html#pandas.Series.map">pd.Series.map()</a> or <a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.replace.html#pandas.Series.replace">pd.Series.replace()</a>:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true">pd.Series.map()</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false">pd.Series.replace()</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<div id="00ab369b" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">(</span>
<span id="cb6-2">    GT(df_pd)</span>
<span id="cb6-3">    .tab_style(</span>
<span id="cb6-4">        style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.fill(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> df_: df_[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col2"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">map</span>(color_mapping)),</span>
<span id="cb6-5">        locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body(),</span>
<span id="cb6-6">    )</span>
<span id="cb6-7">    .cols_align(align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>)</span>
<span id="cb6-8">    .opt_stylize(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pink"</span>)</span>
<span id="cb6-9">)</span></code></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<div id="73e5b173" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">(</span>
<span id="cb7-2">    GT(df_pd)</span>
<span id="cb7-3">    .tab_style(</span>
<span id="cb7-4">        style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.fill(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> df_: df_[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col2"</span>].replace(color_mapping)),</span>
<span id="cb7-5">        locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body(),</span>
<span id="cb7-6">    )</span>
<span id="cb7-7">    .cols_align(align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>)</span>
<span id="cb7-8">    .opt_stylize(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pink"</span>)</span>
<span id="cb7-9">)</span></code></pre></div>
</div>
</div>
</div>
</div>
<p>Alternatively, if you prefer sticking with the same approach, <code>pd.Series.case_when()</code> still works:</p>
<div id="451c4c19" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> color_selector(df_):</span>
<span id="cb8-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df_[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col2"</span>].case_when(</span>
<span id="cb8-3">        [</span>
<span id="cb8-4">            (df_[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col2"</span>].eq(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightgrey"</span>),</span>
<span id="cb8-5">            (df_[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col2"</span>].eq(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightblue"</span>),</span>
<span id="cb8-6">            (df_[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col2"</span>].eq(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"z"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"papayawhip"</span>),</span>
<span id="cb8-7">        ]</span>
<span id="cb8-8">    )</span>
<span id="cb8-9"></span>
<span id="cb8-10"></span>
<span id="cb8-11">(</span>
<span id="cb8-12">    GT(df_pd)</span>
<span id="cb8-13">    .tab_style(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.fill(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>color_selector), locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body())</span>
<span id="cb8-14">    .cols_align(align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>)</span>
<span id="cb8-15">    .opt_stylize(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pink"</span>)</span>
<span id="cb8-16">)</span></code></pre></div>
</div>
</section>
</section>
<section id="polars" class="level2">
<h2 class="anchored" data-anchor-id="polars">Polars</h2>
<p>Just like before, let’s start by creating a Polars DataFrame named <code>df_pl</code> using <code>data</code> as input:</p>
<div id="31016f54" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">df_pl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl.DataFrame(data)</span>
<span id="cb9-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(df_pl)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (5, 3)
┌──────┬──────┬────────────┐
│ col1 ┆ col2 ┆ color      │
│ ---  ┆ ---  ┆ ---        │
│ i64  ┆ str  ┆ str        │
╞══════╪══════╪════════════╡
│ 2    ┆ x    ┆ lightgrey  │
│ 5    ┆ y    ┆ lightblue  │
│ 7    ┆ y    ┆ lightblue  │
│ 10   ┆ z    ┆ papayawhip │
│ 15   ┆ z    ┆ papayawhip │
└──────┴──────┴────────────┘</code></pre>
</div>
</div>
<section id="using-an-existing-column-1" class="level3">
<h3 class="anchored" data-anchor-id="using-an-existing-column-1">Using an Existing Column</h3>
<p>If the DataFrame already contains a column specifying colors, we can apply them directly with <code>from_column()</code>:</p>
<div id="ea897a5c" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">(</span>
<span id="cb11-2">    GT(df_pl)</span>
<span id="cb11-3">    .tab_style(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.fill(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>from_column(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>)), locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body())</span>
<span id="cb11-4">    .cols_align(align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>)</span>
<span id="cb11-5">    .opt_stylize(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pink"</span>)</span>
<span id="cb11-6">)</span></code></pre></div>
</div>
<p>As another option, we can reference the <code>color</code> column using a Polars expression:</p>
<div id="2dbe9a5d" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">(</span>
<span id="cb12-2">    GT(df_pl)</span>
<span id="cb12-3">    .tab_style(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.fill(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>)), locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body())</span>
<span id="cb12-4">    .cols_align(align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>)</span>
<span id="cb12-5">    .opt_stylize(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pink"</span>)</span>
<span id="cb12-6">)</span></code></pre></div>
</div>
</section>
<section id="using-conditional-logic-with-polars-expressions" class="level3">
<h3 class="anchored" data-anchor-id="using-conditional-logic-with-polars-expressions">Using Conditional Logic with Polars Expressions</h3>
<p>For cases where colors need to be assigned dynamically, <a href="https://docs.pola.rs/api/python/stable/reference/expressions/api/polars.when.html#polars.when">pl.when()</a> provides a structured way to define conditions. The example below assigns colors based on the values in <code>col1</code>:</p>
<div id="fc0b8d34" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">color_selector_expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb13-2">    pl.when(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col1"</span>).lt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># &lt;3</span></span>
<span id="cb13-3">    .then(pl.lit(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightgrey"</span>))</span>
<span id="cb13-4">    .when(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col1"</span>).lt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># &lt;10</span></span>
<span id="cb13-5">    .then(pl.lit(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightblue"</span>))</span>
<span id="cb13-6">    .when(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col1"</span>).ge(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># &gt;=10</span></span>
<span id="cb13-7">    .then(pl.lit(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"papayawhip"</span>))</span>
<span id="cb13-8">)</span>
<span id="cb13-9"></span>
<span id="cb13-10">(</span>
<span id="cb13-11">    GT(df_pl)</span>
<span id="cb13-12">    .tab_style(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.fill(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>color_selector_expr), locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body())</span>
<span id="cb13-13">    .cols_align(align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>)</span>
<span id="cb13-14">    .opt_stylize(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pink"</span>)</span>
<span id="cb13-15">)</span></code></pre></div>
</div>
<p>For categorical-like columns (e.g., <code>col2</code>), predefined mappings can be applied efficiently using <a href="https://docs.pola.rs/api/python/stable/reference/expressions/api/polars.Expr.replace.html#polars.Expr.replace">pl.Expr.replace()</a>:</p>
<div id="ccbb5e1a" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">(</span>
<span id="cb14-2">    GT(df_pl)</span>
<span id="cb14-3">    .tab_style(</span>
<span id="cb14-4">        style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.fill(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col2"</span>).replace(color_mapping)),</span>
<span id="cb14-5">        locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body(),</span>
<span id="cb14-6">    )</span>
<span id="cb14-7">    .cols_align(align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>)</span>
<span id="cb14-8">    .opt_stylize(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pink"</span>)</span>
<span id="cb14-9">)</span></code></pre></div>
</div>
<p>Alternatively, if you prefer the conditional approach, <code>pl.when()</code> can still be used:</p>
<div id="4a3a9b2e" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">color_selector_expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb15-2">    pl.when(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col2"</span>).eq(pl.lit(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>)))</span>
<span id="cb15-3">    .then(pl.lit(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightgrey"</span>))</span>
<span id="cb15-4">    .when(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col2"</span>).eq(pl.lit(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>)))</span>
<span id="cb15-5">    .then(pl.lit(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightblue"</span>))</span>
<span id="cb15-6">    .when(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col2"</span>).eq(pl.lit(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"z"</span>)))</span>
<span id="cb15-7">    .then(pl.lit(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"papayawhip"</span>))</span>
<span id="cb15-8">)</span>
<span id="cb15-9"></span>
<span id="cb15-10"></span>
<span id="cb15-11">(</span>
<span id="cb15-12">    GT(df_pl)</span>
<span id="cb15-13">    .tab_style(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.fill(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>color_selector_expr), locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body())</span>
<span id="cb15-14">    .cols_align(align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>)</span>
<span id="cb15-15">    .opt_stylize(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pink"</span>)</span>
<span id="cb15-16">)</span></code></pre></div>
</div>
</section>
</section>
<section id="final-notes" class="level2">
<h2 class="anchored" data-anchor-id="final-notes">Final Notes</h2>
<p>In this post, we explored how to use a custom color palette to style table backgrounds with <a href="https://posit-dev.github.io/great-tables/reference/style.fill.html#great_tables.style.fill">style.fill()</a>. The same approach can be applied to customize text color using <a href="https://posit-dev.github.io/great-tables/reference/style.text.html#great_tables.style.text">style.text()</a> or adjust border color with <a href="https://posit-dev.github.io/great-tables/reference/style.borders.html#great_tables.style.borders">style.borders()</a>.</p>
<p>Lastly, remember that <a href="https://posit-dev.github.io/great-tables/reference/loc.body.html#great_tables.loc.body">loc.body()</a> allows you to target specific columns and rows, giving you precise control over table styling.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Disclaimer
</div>
</div>
<div class="callout-body-container callout-body">
<p>This post was drafted by me, with AI assistance to refine the content.</p>
</div>
</div>


</section>

 ]]></description>
  <category>python</category>
  <category>pandas</category>
  <category>polars</category>
  <category>gt</category>
  <guid>https://tech.ycwu.space/posts/table-body-custom-palette/20250225.html</guid>
  <pubDate>Tue, 25 Feb 2025 00:00:00 GMT</pubDate>
  <media:content url="https://tech.ycwu.space/posts/table-body-custom-palette/table_body_custom_palette.png" medium="image" type="image/png" height="190" width="144"/>
</item>
<item>
  <title>Weekend Challenge - Effective Data Visualization with Polars and Matplotlib</title>
  <dc:creator>Jerry Wu</dc:creator>
  <link>https://tech.ycwu.space/posts/effective-dataviz-polars-alta-ski-resort/20250210.html</link>
  <description><![CDATA[ 





<p>It was an honor to be one of the reviewers for Matt Harrison’s new book, <a href="https://store.metasnake.com/effective-viz"><em>Effective Visualization</em></a>. If you’re looking to deepen your understanding of how to use Pandas and Matplotlib to craft compelling data stories, this book is a must-read.</p>
<p>Last weekend, I decided to convert some of the Pandas code from the book into Polars just for fun, and I’d like to share an example in this post. You can find the original Pandas code in the <a href="link">repo</a> (empty link for now).</p>
<p>The final figure, shown below, visualizes temperature trends for the ski season in Alta over the past few decades.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tech.ycwu.space/posts/effective-dataviz-polars-alta-ski-resort/alta_ski_resort.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Alta ski resort"></p>
</figure>
</div>
<div id="cf6c3496" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Show full code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> polars <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pl</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> polars.selectors <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> cs</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> highlight_text <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ax_text</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> matplotlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> colormaps</span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># https://github.com/mattharrison/datasets/raw/refs/heads/master/data/alta-noaa-1980-2019.csv</span></span>
<span id="cb1-8">data_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"alta-noaa-1980-2019.csv"</span></span>
<span id="cb1-9">columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TOBS"</span>]</span>
<span id="cb1-10">idx_colname <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span></span>
<span id="cb1-11"></span>
<span id="cb1-12"></span>
<span id="cb1-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> tweak_df(data_path: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, columns: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>], idx_colname: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span>):</span>
<span id="cb1-14">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb1-15">        pl.scan_csv(data_path)</span>
<span id="cb1-16">        .select(columns)</span>
<span id="cb1-17">        .with_columns(</span>
<span id="cb1-18">            pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.to_datetime(),</span>
<span id="cb1-19">            pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TOBS"</span>).interpolate(),</span>
<span id="cb1-20">        )</span>
<span id="cb1-21">        .sort(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>)</span>
<span id="cb1-22">        .with_columns(</span>
<span id="cb1-23">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Caveat: Cannot be placed in the previous `with_columns()`</span></span>
<span id="cb1-24">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># due to different statuses of `TOBS`.</span></span>
<span id="cb1-25">            pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TOBS"</span>).rolling_mean(window_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, center<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TMEAN"</span>),</span>
<span id="cb1-26">            get_season_expr(col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>, alias<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>),</span>
<span id="cb1-27">        )</span>
<span id="cb1-28">        .with_columns(</span>
<span id="cb1-29">            add_day_of_season_expr(col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>, group_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>, alias<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>idx_colname)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#</span></span>
<span id="cb1-30">        )</span>
<span id="cb1-31">        .collect()</span>
<span id="cb1-32">    )</span>
<span id="cb1-33"></span>
<span id="cb1-34"></span>
<span id="cb1-35"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_season_expr(col: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>, alias: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.expr:</span>
<span id="cb1-36">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb1-37">        (</span>
<span id="cb1-38">            pl.when((pl.col(col).dt.month().is_between(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, closed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"both"</span>)))</span>
<span id="cb1-39">            .then(pl.lit(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Summer "</span>))</span>
<span id="cb1-40">            .otherwise(pl.lit(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ski "</span>))</span>
<span id="cb1-41">        )</span>
<span id="cb1-42">        .add(</span>
<span id="cb1-43">            pl.when(pl.col(col).dt.month() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>)</span>
<span id="cb1-44">            .then(pl.col(col).dt.year().cast(pl.String))</span>
<span id="cb1-45">            .otherwise(pl.col(col).dt.year().add(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>).cast(pl.String))</span>
<span id="cb1-46">        )</span>
<span id="cb1-47">        .alias(alias)</span>
<span id="cb1-48">    )</span>
<span id="cb1-49"></span>
<span id="cb1-50"></span>
<span id="cb1-51"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> add_day_of_season_expr(</span>
<span id="cb1-52">    col: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>, group_col: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>, alias: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span></span>
<span id="cb1-53">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.expr:</span>
<span id="cb1-54">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb1-55">        (pl.col(col) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> pl.col(col).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()).dt.total_days().over(group_col).alias(alias)</span>
<span id="cb1-56">    )</span>
<span id="cb1-57"></span>
<span id="cb1-58"></span>
<span id="cb1-59"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> plot_temps(_df: pl.DataFrame, idx_colname: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="cb1-60">    plt.rcParams[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"font.family"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto"</span></span>
<span id="cb1-61">    figsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">160</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">165</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pts</span></span>
<span id="cb1-62"></span>
<span id="cb1-63">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> points_to_inches(points):</span>
<span id="cb1-64">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> points <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span></span>
<span id="cb1-65"></span>
<span id="cb1-66">    figsize_inches <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [points_to_inches(dim) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> dim <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> figsize]</span>
<span id="cb1-67"></span>
<span id="cb1-68">    heading_fontsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9.5</span></span>
<span id="cb1-69">    heading_fontweight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span></span>
<span id="cb1-70">    subheading_fontsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span></span>
<span id="cb1-71">    subheading_fontweight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span></span>
<span id="cb1-72">    source_fontsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.5</span></span>
<span id="cb1-73">    source_fontweight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"light"</span></span>
<span id="cb1-74">    axis_fontsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span></span>
<span id="cb1-75">    axis_fontweight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span></span>
<span id="cb1-76"></span>
<span id="cb1-77">    grey <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#aaaaaa"</span></span>
<span id="cb1-78">    red <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#e3120b"</span></span>
<span id="cb1-79">    blue <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0000ff"</span></span>
<span id="cb1-80">    cmap <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> colormaps.get_cmap(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Grays"</span>)</span>
<span id="cb1-81"></span>
<span id="cb1-82">    layout <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span>], [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"plot"</span>], [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"notes"</span>]]</span>
<span id="cb1-83">    fig, axs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplot_mosaic(</span>
<span id="cb1-84">        layout,</span>
<span id="cb1-85">        gridspec_kw<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"height_ratios"</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]},</span>
<span id="cb1-86">        figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>figsize_inches,</span>
<span id="cb1-87">        dpi<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>,</span>
<span id="cb1-88">        constrained_layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb1-89">    )</span>
<span id="cb1-90"></span>
<span id="cb1-91">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ----- Title -----</span></span>
<span id="cb1-92">    ax_title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> axs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span>]</span>
<span id="cb1-93">    ax_title.axis(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>)</span>
<span id="cb1-94">    sub_props <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontsize"</span>: subheading_fontsize, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontweight"</span>: subheading_fontweight}</span>
<span id="cb1-95">    ax_text(</span>
<span id="cb1-96">        s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;Alta Ski Resort&gt;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;Temperature trends by &gt;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;decade&gt;&lt; and &gt;&lt;2019&gt;"</span>,</span>
<span id="cb1-97">        x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-98">        y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-99">        fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>heading_fontsize,</span>
<span id="cb1-100">        ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax_title,</span>
<span id="cb1-101">        va<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>,</span>
<span id="cb1-102">        ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>,</span>
<span id="cb1-103">        zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb1-104">        highlight_textprops<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb1-105">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontsize"</span>: heading_fontsize, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontweight"</span>: heading_fontweight},</span>
<span id="cb1-106">            sub_props,</span>
<span id="cb1-107">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>: blue, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>sub_props},</span>
<span id="cb1-108">            sub_props,</span>
<span id="cb1-109">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>: red, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>sub_props},</span>
<span id="cb1-110">        ],</span>
<span id="cb1-111">    )</span>
<span id="cb1-112"></span>
<span id="cb1-113">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ----- Plot -----</span></span>
<span id="cb1-114">    ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> axs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"plot"</span>]</span>
<span id="cb1-115">    season_temps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> _df.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ski"</span>)).pivot(</span>
<span id="cb1-116">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>idx_colname, values<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TMEAN"</span>, aggregate_function<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"first"</span></span>
<span id="cb1-117">    )</span>
<span id="cb1-118">    season_temps_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> season_temps[idx_colname]</span>
<span id="cb1-119"></span>
<span id="cb1-120">    columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> season_temps.columns</span>
<span id="cb1-121">    columns.remove(idx_colname)</span>
<span id="cb1-122">    columns.remove(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ski 2019"</span>)</span>
<span id="cb1-123">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i, column <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(columns):</span>
<span id="cb1-124">        color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cmap(i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(columns))</span>
<span id="cb1-125">        ax.plot(</span>
<span id="cb1-126">            season_temps_index,</span>
<span id="cb1-127">            season_temps[column],</span>
<span id="cb1-128">            color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>color,</span>
<span id="cb1-129">            linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb1-130">            alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,</span>
<span id="cb1-131">            zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb1-132">        )</span>
<span id="cb1-133"></span>
<span id="cb1-134">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # ---- Decade Averages ----</span></span>
<span id="cb1-135">    decades <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1980</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1990</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010</span>]</span>
<span id="cb1-136">    blues <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0055EE"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0033CC"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0011AA"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#3377FF"</span>]</span>
<span id="cb1-137">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> decade, color <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(decades, blues):</span>
<span id="cb1-138">        match <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(decade)[:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1980 -&gt; "198", 2010 -&gt; "201"</span></span>
<span id="cb1-139">        decade_temps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> season_temps.select(cs.contains(match)).mean_horizontal()</span>
<span id="cb1-140">        ax.plot(season_temps_index, decade_temps, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>color, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-141"></span>
<span id="cb1-142">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add label to right of line</span></span>
<span id="cb1-143">        last_y_label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> decade_temps.last()</span>
<span id="cb1-144"></span>
<span id="cb1-145">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> decade <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>:</span>
<span id="cb1-146">            last_y_label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb1-147">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> decade <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010</span>:</span>
<span id="cb1-148">            last_y_label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span></span>
<span id="cb1-149"></span>
<span id="cb1-150">        ax.text(</span>
<span id="cb1-151">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">185</span>,</span>
<span id="cb1-152">            last_y_label,</span>
<span id="cb1-153">            <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>decade<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb1-154">            va<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>,</span>
<span id="cb1-155">            ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>,</span>
<span id="cb1-156">            fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axis_fontsize,</span>
<span id="cb1-157">            fontweight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axis_fontweight,</span>
<span id="cb1-158">            color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>color,</span>
<span id="cb1-159">        )</span>
<span id="cb1-160">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # add dot to start and end of each line</span></span>
<span id="cb1-161">        ax.plot(</span>
<span id="cb1-162">            season_temps_index.first(),</span>
<span id="cb1-163">            decade_temps.first(),</span>
<span id="cb1-164">            marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>,</span>
<span id="cb1-165">            color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>color,</span>
<span id="cb1-166">            markersize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb1-167">            zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb1-168">        )</span>
<span id="cb1-169">        ax.plot(</span>
<span id="cb1-170">            season_temps_index.last(),</span>
<span id="cb1-171">            decade_temps.last(),</span>
<span id="cb1-172">            marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>,</span>
<span id="cb1-173">            color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>color,</span>
<span id="cb1-174">            markersize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb1-175">            zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb1-176">        )</span>
<span id="cb1-177"></span>
<span id="cb1-178">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # ------ Ski 2019 ------</span></span>
<span id="cb1-179">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # plot `Ski 2019` in red</span></span>
<span id="cb1-180">    ski_2019 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> season_temps.select(idx_colname, cs.by_name(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ski 2019"</span>)).drop_nulls()</span>
<span id="cb1-181">    ski_2019_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ski_2019[idx_colname]</span>
<span id="cb1-182">    ski_2019 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ski_2019.drop([idx_colname]).to_series()</span>
<span id="cb1-183">    ax.plot(ski_2019_index, ski_2019, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-184"></span>
<span id="cb1-185">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add dot to start and end of each line</span></span>
<span id="cb1-186">    ax.plot(</span>
<span id="cb1-187">        ski_2019_index.first(),</span>
<span id="cb1-188">        ski_2019.first(),</span>
<span id="cb1-189">        marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>,</span>
<span id="cb1-190">        color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>,</span>
<span id="cb1-191">        markersize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb1-192">        zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb1-193">    )</span>
<span id="cb1-194">    ax.plot(</span>
<span id="cb1-195">        ski_2019_index.last(),</span>
<span id="cb1-196">        ski_2019.last(),</span>
<span id="cb1-197">        marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>,</span>
<span id="cb1-198">        color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>,</span>
<span id="cb1-199">        markersize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb1-200">        zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb1-201">    )</span>
<span id="cb1-202"></span>
<span id="cb1-203">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # ------ Ticks &amp; Lines ------</span></span>
<span id="cb1-204">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # remove spines</span></span>
<span id="cb1-205">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> side <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>]:</span>
<span id="cb1-206">        ax.spines[side].set_visible(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb1-207"></span>
<span id="cb1-208">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # add horizontal line at 32F</span></span>
<span id="cb1-209">    ax.axhline(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-210"></span>
<span id="cb1-211">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # set y ticks</span></span>
<span id="cb1-212">    ax.set_yticks(ticks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>])</span>
<span id="cb1-213"></span>
<span id="cb1-214">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # set y limit</span></span>
<span id="cb1-215">    ax.set_ylim([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">55</span>])</span>
<span id="cb1-216"></span>
<span id="cb1-217">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # set x label</span></span>
<span id="cb1-218">    ax.set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Day of season"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axis_fontsize, fontweight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axis_fontweight)</span>
<span id="cb1-219"></span>
<span id="cb1-220">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # ------ Source ------</span></span>
<span id="cb1-221">    ax_notes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> axs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"notes"</span>]</span>
<span id="cb1-222">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add source</span></span>
<span id="cb1-223">    ax_notes.axis(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>)</span>
<span id="cb1-224">    ax_notes.text(</span>
<span id="cb1-225">        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-226">        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-227">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Source: NOAA"</span>,</span>
<span id="cb1-228">        fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>source_fontsize,</span>
<span id="cb1-229">        fontweight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>source_fontweight,</span>
<span id="cb1-230">        color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>grey,</span>
<span id="cb1-231">    )</span>
<span id="cb1-232">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> _df</span>
<span id="cb1-233"></span>
<span id="cb1-234"></span>
<span id="cb1-235">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tweak_df(data_path, columns, idx_colname)</span>
<span id="cb1-236">df.pipe(plot_temps, idx_colname)</span></code></pre></div>
</details>
</div>
<section id="data-processing-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="data-processing-pipeline">Data Processing Pipeline</h2>
<p>Below is the data pipeline used to generate the DataFrame for the upcoming visualization stage:</p>
<div class="sourceCode" id="annotated-cell-2" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-2-1">data_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"alta-noaa-1980-2019.csv"</span></span>
<span id="annotated-cell-2-2">columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TOBS"</span>]</span>
<span id="annotated-cell-2-3">idx_colname <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span></span>
<span id="annotated-cell-2-4"></span>
<span id="annotated-cell-2-5"></span>
<span id="annotated-cell-2-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> tweak_df(data_path: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, columns: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>], idx_colname: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span>):</span>
<span id="annotated-cell-2-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="annotated-cell-2-8">        pl.scan_csv(data_path)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-2-9" class="code-annotation-target">        .select(columns)</span>
<span id="annotated-cell-2-10">        .with_columns(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-2-11" class="code-annotation-target">            pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.to_datetime(),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-2-12" class="code-annotation-target">            pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TOBS"</span>).interpolate(),</span>
<span id="annotated-cell-2-13">        )</span>
<span id="annotated-cell-2-14">        .sort(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>)</span>
<span id="annotated-cell-2-15">        .with_columns(</span>
<span id="annotated-cell-2-16">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Caveat: Cannot be placed in the previous `with_columns()`</span></span>
<span id="annotated-cell-2-17">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># due to different statuses of `TOBS`.</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-2-18" class="code-annotation-target">            pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TOBS"</span>).rolling_mean(window_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, center<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>).alias(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TMEAN"</span>),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-2-19" class="code-annotation-target">            get_season_expr(col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>, alias<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>),</span>
<span id="annotated-cell-2-20">        )</span>
<span id="annotated-cell-2-21">        .with_columns(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-2-22" class="code-annotation-target">            add_day_of_season_expr(col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>, group_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>, alias<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>idx_colname)</span>
<span id="annotated-cell-2-23">        )</span>
<span id="annotated-cell-2-24">        .collect()</span>
<span id="annotated-cell-2-25">    )</span>
<span id="annotated-cell-2-26"></span>
<span id="annotated-cell-2-27">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tweak_df(data_path, columns, idx_colname)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="9" data-code-annotation="1">Select the <code>DATE</code> column (dates) and <code>TOBS</code> column (recorded temperatures in Fahrenheit).</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="11" data-code-annotation="2">Convert the <code>DATE</code> column to a datetime format.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="12" data-code-annotation="3">Perform interpolation on the <code>TOBS</code> column.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="18" data-code-annotation="4">Compute a 28-day rolling average for <code>TOBS</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="19" data-code-annotation="5">Use <code>get_season_expr()</code> to categorize each date into a <code>SEASON</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="22" data-code-annotation="6">Apply <code>add_day_of_season_expr()</code> to calculate <code>DAY_OF_SEASON</code>, representing days elapsed since the start of the season.</span>
</dd>
</dl>
<p>The first three steps involve straightforward Polars expressions. In the following sections, we’ll dive deeper into steps 5 to 6.</p>
<section id="categorizing-dates-into-summer-and-ski-seasons" class="level3">
<h3 class="anchored" data-anchor-id="categorizing-dates-into-summer-and-ski-seasons">Categorizing Dates into <code>Summer</code> and <code>Ski</code> Seasons</h3>
<p>To analyze seasonal trends, we classify dates into two categories:</p>
<ul>
<li><strong><code>Summer</code></strong>: Covers May through October.<br>
</li>
<li><strong><code>Ski</code></strong>: Covers November through April.</li>
</ul>
<p>If a date falls in November or December, it is assigned to the following year’s season. For example, <code>2015-10-31</code> is categorized as <code>Summer 2015</code>, while <code>2015-11-01</code> belongs to <code>Ski 2016</code>.</p>
<p>To implement this logic, we define <code>get_season_expr()</code>, which leverages Polars’ <a href="https://docs.pola.rs/api/python/dev/reference/expressions/api/polars.when.html">when-then-otherwise</a> expressions to determine the season and year.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_season_expr(col: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>, alias: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.expr:</span>
<span id="cb2-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb2-3">        (</span>
<span id="cb2-4">            pl.when((pl.col(col).dt.month().is_between(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, closed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"both"</span>)))</span>
<span id="cb2-5">            .then(pl.lit(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Summer "</span>))</span>
<span id="cb2-6">            .otherwise(pl.lit(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ski "</span>))</span>
<span id="cb2-7">        )</span>
<span id="cb2-8">        .add(</span>
<span id="cb2-9">            pl.when(pl.col(col).dt.month() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>)</span>
<span id="cb2-10">            .then(pl.col(col).dt.year().cast(pl.String))</span>
<span id="cb2-11">            .otherwise(pl.col(col).dt.year().add(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>).cast(pl.String))</span>
<span id="cb2-12">        )</span>
<span id="cb2-13">        .alias(alias)</span>
<span id="cb2-14">    )</span></code></pre></div>
<p>In this function:</p>
<ul>
<li>If the month is between May and October, the function assigns <code>"Summer "</code>. Otherwise, it assigns <code>"Ski "</code> (with a trailing space for concatenation).<br>
</li>
<li>The year is determined based on the month: dates from January to October retain their current year, while those in November and December are shifted to the next year.</li>
</ul>
<p>By applying this function, we can add a <code>SEASON</code> column to a Polars DataFrame, ensuring each date is categorized correctly.</p>
</section>
<section id="calculating-the-total-days-for-each-season" class="level3">
<h3 class="anchored" data-anchor-id="calculating-the-total-days-for-each-season">Calculating the Total Days for Each Season</h3>
<p>Once we have the seasonal categories, we calculate <code>DAY_OF_SEASON</code>, which tracks the number of days elapsed within each season. This is achieved using the <a href="https://docs.pola.rs/api/python/dev/reference/expressions/api/polars.Expr.over.html">pl.expr.over()</a> expression, which operates similarly to Pandas’ <code>groupby().transform()</code>, applying transformations within groups.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> add_day_of_season_expr(</span>
<span id="cb3-2">    col: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DATE"</span>, group_col: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>, alias: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span></span>
<span id="cb3-3">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.expr:</span>
<span id="cb3-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (</span>
<span id="cb3-5">        (pl.col(col) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> pl.col(col).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()).dt.total_days().over(group_col).alias(alias)</span>
<span id="cb3-6">    )</span></code></pre></div>
</section>
</section>
<section id="visualizing-temperature-trends-with-matplotlib" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-temperature-trends-with-matplotlib">Visualizing Temperature Trends with Matplotlib</h2>
<p>With the data prepared, we move on to plotting. Since <code>plot_temps()</code> is quite long, we’ll break it down into several parts for easier explanation.</p>
<section id="setting-up-the-figure" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-the-figure">Setting Up the Figure</h3>
<p>We start by defining some parameters and using <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplot_mosaic.html">plt.subplot_mosaic()</a> to create the figure layout. This provides structured axes for different elements of the visualization.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> plot_temps(_df: pl.DataFrame, idx_colname: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="cb4-2">    plt.rcParams[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"font.family"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto"</span></span>
<span id="cb4-3">    figsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">160</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">165</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pts</span></span>
<span id="cb4-4"></span>
<span id="cb4-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> points_to_inches(points):</span>
<span id="cb4-6">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> points <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span></span>
<span id="cb4-7"></span>
<span id="cb4-8">    figsize_inches <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [points_to_inches(dim) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> dim <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> figsize]</span>
<span id="cb4-9"></span>
<span id="cb4-10">    heading_fontsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9.5</span></span>
<span id="cb4-11">    heading_fontweight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span></span>
<span id="cb4-12">    subheading_fontsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span></span>
<span id="cb4-13">    subheading_fontweight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span></span>
<span id="cb4-14">    source_fontsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.5</span></span>
<span id="cb4-15">    source_fontweight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"light"</span></span>
<span id="cb4-16">    axis_fontsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span></span>
<span id="cb4-17">    axis_fontweight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span></span>
<span id="cb4-18"></span>
<span id="cb4-19">    grey <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#aaaaaa"</span></span>
<span id="cb4-20">    red <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#e3120b"</span></span>
<span id="cb4-21">    blue <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0000ff"</span></span>
<span id="cb4-22">    cmap <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> colormaps.get_cmap(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Grays"</span>)</span>
<span id="cb4-23"></span>
<span id="cb4-24">    layout <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span>], [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"plot"</span>], [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"notes"</span>]]</span>
<span id="cb4-25">    fig, axs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplot_mosaic(</span>
<span id="cb4-26">        layout,</span>
<span id="cb4-27">        gridspec_kw<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"height_ratios"</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]},</span>
<span id="cb4-28">        figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>figsize_inches,</span>
<span id="cb4-29">        dpi<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>,</span>
<span id="cb4-30">        constrained_layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb4-31">    )</span>
<span id="cb4-32">    ...</span>
<span id="cb4-33">    </span></code></pre></div>
</section>
<section id="adding-the-title" class="level3">
<h3 class="anchored" data-anchor-id="adding-the-title">Adding the Title</h3>
<p>For the title, we use <code>ax_text()</code> from the <a href="https://github.com/znstrider/highlight_text">HighlightText</a> library, which allows selective styling of text enclosed in <code>&lt; &gt;</code>. This lets us highlight key parts of the title, such as <code>&lt;Alta Ski Resort&gt;</code>, <code>&lt;Temperature trends by &gt;</code>, <code>&lt;decade&gt;</code>, <code>&lt; and &gt;</code>, and <code>&lt;2019&gt;</code>, with custom formatting.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> plot_temps(</span>
<span id="cb5-2">    _df: pl.DataFrame, idx_colname: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span></span>
<span id="cb5-3">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="cb5-4">    ...</span>
<span id="cb5-5"></span>
<span id="cb5-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ----- Title -----</span></span>
<span id="cb5-7">    ax_title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> axs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span>]</span>
<span id="cb5-8">    ax_title.axis(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>)</span>
<span id="cb5-9">    sub_props <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontsize"</span>: subheading_fontsize, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontweight"</span>: subheading_fontweight}</span>
<span id="cb5-10">    ax_text(</span>
<span id="cb5-11">        s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;Alta Ski Resort&gt;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;Temperature trends by &gt;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;decade&gt;&lt; and &gt;&lt;2019&gt;"</span>,</span>
<span id="cb5-12">        x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb5-13">        y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb5-14">        fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>heading_fontsize,</span>
<span id="cb5-15">        ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax_title,</span>
<span id="cb5-16">        va<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>,</span>
<span id="cb5-17">        ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>,</span>
<span id="cb5-18">        zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb5-19">        highlight_textprops<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb5-20">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontsize"</span>: heading_fontsize, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fontweight"</span>: heading_fontweight},</span>
<span id="cb5-21">            sub_props,</span>
<span id="cb5-22">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>: blue, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>sub_props},</span>
<span id="cb5-23">            sub_props,</span>
<span id="cb5-24">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>: red, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>sub_props},</span>
<span id="cb5-25">        ],</span>
<span id="cb5-26">    )</span></code></pre></div>
</section>
<section id="plotting-seasonal-trends" class="level3">
<h3 class="anchored" data-anchor-id="plotting-seasonal-trends">Plotting Seasonal Trends</h3>
<p>Next, we generate the main plot by:</p>
<ol type="1">
<li>Filtering the dataset for <code>Ski</code> seasons.<br>
</li>
<li>Pivoting the table to organize <code>TMEAN</code> values by <code>DAY_OF_SEASON</code> and <code>SEASON</code>.<br>
</li>
<li>Using <code>ax.plot()</code> to draw a separate line for each <code>Ski</code> season.</li>
</ol>
<div class="sourceCode" id="annotated-cell-7" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy"><code class="sourceCode python"><span id="annotated-cell-7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> plot_temps(</span>
<span id="annotated-cell-7-2">    _df: pl.DataFrame, idx_colname: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span></span>
<span id="annotated-cell-7-3">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="annotated-cell-7-4">    ...</span>
<span id="annotated-cell-7-5"></span>
<span id="annotated-cell-7-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ----- Plot -----</span></span>
<span id="annotated-cell-7-7">    ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> axs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"plot"</span>]</span>
<span id="annotated-cell-7-8">    season_temps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> _df.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ski"</span>)).pivot(</span>
<span id="annotated-cell-7-9">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SEASON"</span>, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>idx_colname, values<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TMEAN"</span>, aggregate_function<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"first"</span></span>
<span id="annotated-cell-7-10">    )</span>
<span id="annotated-cell-7-11">    season_temps_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> season_temps[idx_colname]</span>
<span id="annotated-cell-7-12"></span>
<span id="annotated-cell-7-13">    columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> season_temps.columns</span>
<span id="annotated-cell-7-14">    columns.remove(idx_colname)</span>
<span id="annotated-cell-7-15">    columns.remove(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ski 2019"</span>)</span>
<span id="annotated-cell-7-16">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i, column <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(columns):</span>
<span id="annotated-cell-7-17">        color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cmap(i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(columns))</span>
<span id="annotated-cell-7-18">        ax.plot(</span>
<span id="annotated-cell-7-19">            season_temps_index,</span>
<span id="annotated-cell-7-20">            season_temps[column],</span>
<span id="annotated-cell-7-21">            color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>color,</span>
<span id="annotated-cell-7-22">            linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="annotated-cell-7-23">            alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,</span>
<span id="annotated-cell-7-24">            zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="annotated-cell-7-25">        )</span></code></pre></div>
<p>To illustrate long-term trends, we overlay four lines representing the average temperature trends for different decades, marking their start and end points with dots for emphasis.</p>
<div class="sourceCode" id="annotated-cell-8" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> plot_temps(</span>
<span id="annotated-cell-8-2">    _df: pl.DataFrame, idx_colname: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span></span>
<span id="annotated-cell-8-3">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="annotated-cell-8-4">    ...</span>
<span id="annotated-cell-8-5"></span>
<span id="annotated-cell-8-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # ---- Decade Averages ----</span></span>
<span id="annotated-cell-8-7">    decades <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1980</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1990</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010</span>]</span>
<span id="annotated-cell-8-8">    blues <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0055EE"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0033CC"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0011AA"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#3377FF"</span>]</span>
<span id="annotated-cell-8-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> decade, color <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(decades, blues):</span>
<span id="annotated-cell-8-10">        match <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(decade)[:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1980 -&gt; "198", 2010 -&gt; "201"</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-8-11" class="code-annotation-target">        decade_temps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> season_temps.select(cs.contains(match)).mean_horizontal()</span>
<span id="annotated-cell-8-12">        ax.plot(season_temps_index, decade_temps, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>color, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="annotated-cell-8-13"></span>
<span id="annotated-cell-8-14">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add label to right of line</span></span>
<span id="annotated-cell-8-15">        last_y_label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> decade_temps.last()</span>
<span id="annotated-cell-8-16"></span>
<span id="annotated-cell-8-17">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> decade <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>:</span>
<span id="annotated-cell-8-18">            last_y_label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="annotated-cell-8-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> decade <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010</span>:</span>
<span id="annotated-cell-8-20">            last_y_label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span></span>
<span id="annotated-cell-8-21"></span>
<span id="annotated-cell-8-22">        ax.text(</span>
<span id="annotated-cell-8-23">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">185</span>,</span>
<span id="annotated-cell-8-24">            last_y_label,</span>
<span id="annotated-cell-8-25">            <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>decade<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="annotated-cell-8-26">            va<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>,</span>
<span id="annotated-cell-8-27">            ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>,</span>
<span id="annotated-cell-8-28">            fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axis_fontsize,</span>
<span id="annotated-cell-8-29">            fontweight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axis_fontweight,</span>
<span id="annotated-cell-8-30">            color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>color,</span>
<span id="annotated-cell-8-31">        )</span>
<span id="annotated-cell-8-32">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # add dot to start and end of each line</span></span>
<span id="annotated-cell-8-33">        ax.plot(</span>
<span id="annotated-cell-8-34">            season_temps_index.first(),</span>
<span id="annotated-cell-8-35">            decade_temps.first(),</span>
<span id="annotated-cell-8-36">            marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>,</span>
<span id="annotated-cell-8-37">            color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>color,</span>
<span id="annotated-cell-8-38">            markersize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="annotated-cell-8-39">            zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="annotated-cell-8-40">        )</span>
<span id="annotated-cell-8-41">        ax.plot(</span>
<span id="annotated-cell-8-42">            season_temps_index.last(),</span>
<span id="annotated-cell-8-43">            decade_temps.last(),</span>
<span id="annotated-cell-8-44">            marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>,</span>
<span id="annotated-cell-8-45">            color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>color,</span>
<span id="annotated-cell-8-46">            markersize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="annotated-cell-8-47">            zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="annotated-cell-8-48">        )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-8" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="11" data-code-annotation="1">We leverage two powerful features of Polars: <a href="https://docs.pola.rs/api/python/dev/reference/selectors.html">Polars selectors</a>, which enable efficient column selection based on name patterns to extract data for each decade (<code>cs.contains(match)</code>), and <a href="https://docs.pola.rs/api/python/dev/reference/dataframe/api/polars.DataFrame.mean_horizontal.html">df.mean_horizontal()</a>, which performs vectorized operations across columns to compute the average temperature for each decade.</span>
</dd>
</dl>
</section>
<section id="highlighting-the-2019-ski-season" class="level3">
<h3 class="anchored" data-anchor-id="highlighting-the-2019-ski-season">Highlighting the 2019 Ski Season</h3>
<p>To make <code>Ski 2019</code> stand out, we plot its trend in red and highlight its start and end points with dots, similar to the decade lines.</p>
<div class="sourceCode" id="annotated-cell-9" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> plot_temps(</span>
<span id="annotated-cell-9-2">    _df: pl.DataFrame, idx_colname: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span></span>
<span id="annotated-cell-9-3">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="annotated-cell-9-4">    ...</span>
<span id="annotated-cell-9-5"></span>
<span id="annotated-cell-9-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # ------ Ski 2019 ------</span></span>
<span id="annotated-cell-9-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # plot `Ski 2019` in red</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-9-8" class="code-annotation-target">    ski_2019 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> season_temps.select(idx_colname, cs.by_name(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ski 2019"</span>)).drop_nulls()</span>
<span id="annotated-cell-9-9">    ski_2019_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ski_2019[idx_colname]</span>
<span id="annotated-cell-9-10">    ski_2019 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ski_2019.drop([idx_colname]).to_series()</span>
<span id="annotated-cell-9-11">    ax.plot(ski_2019_index, ski_2019, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="annotated-cell-9-12"></span>
<span id="annotated-cell-9-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add dot to start and end of each line</span></span>
<span id="annotated-cell-9-14">    ax.plot(</span>
<span id="annotated-cell-9-15">        ski_2019_index.first(),</span>
<span id="annotated-cell-9-16">        ski_2019.first(),</span>
<span id="annotated-cell-9-17">        marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>,</span>
<span id="annotated-cell-9-18">        color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>,</span>
<span id="annotated-cell-9-19">        markersize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="annotated-cell-9-20">        zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="annotated-cell-9-21">    )</span>
<span id="annotated-cell-9-22">    ax.plot(</span>
<span id="annotated-cell-9-23">        ski_2019_index.last(),</span>
<span id="annotated-cell-9-24">        ski_2019.last(),</span>
<span id="annotated-cell-9-25">        marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>,</span>
<span id="annotated-cell-9-26">        color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>,</span>
<span id="annotated-cell-9-27">        markersize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="annotated-cell-9-28">        zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="annotated-cell-9-29">    )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-9" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="8" data-code-annotation="1">We use the Polars selector (<code>cs.by_name()</code>) to isolate the <code>Ski 2019</code> data.</span>
</dd>
</dl>
</section>
<section id="refinements-for-clarity" class="level3">
<h3 class="anchored" data-anchor-id="refinements-for-clarity">Refinements for Clarity</h3>
<p>To enhance readability, we refine the visualization by adjusting:</p>
<ul>
<li><strong>Spines</strong>: Removing unnecessary borders.<br>
</li>
<li><strong>Reference Line</strong>: Adding a horizontal dashed line at 32°F for context.<br>
</li>
<li><strong>Ticks &amp; Limits</strong>: Setting appropriate y-axis ticks and limits.<br>
</li>
<li><strong>Labels</strong>: Customizing the x-axis label for clarity.</li>
</ul>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> plot_temps(</span>
<span id="cb6-2">    _df: pl.DataFrame, idx_colname: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span></span>
<span id="cb6-3">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="cb6-4">    ...</span>
<span id="cb6-5"></span>
<span id="cb6-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # ------ Ticks &amp; Lines ------</span></span>
<span id="cb6-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # remove spines</span></span>
<span id="cb6-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> side <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>]:</span>
<span id="cb6-9">        ax.spines[side].set_visible(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb6-10"></span>
<span id="cb6-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # add horizontal line at 32F</span></span>
<span id="cb6-12">    ax.axhline(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-13"></span>
<span id="cb6-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # set y ticks</span></span>
<span id="cb6-15">    ax.set_yticks(ticks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>])</span>
<span id="cb6-16"></span>
<span id="cb6-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # set y limit</span></span>
<span id="cb6-18">    ax.set_ylim([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">55</span>])</span>
<span id="cb6-19"></span>
<span id="cb6-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # set x label</span></span>
<span id="cb6-21">    ax.set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Day of season"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axis_fontsize, fontweight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axis_fontweight)</span></code></pre></div>
</section>
<section id="adding-notes" class="level3">
<h3 class="anchored" data-anchor-id="adding-notes">Adding Notes</h3>
<p>Finally, we use Matplotlib’s <code>ax.text()</code> to annotate the source of the data.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> plot_temps(</span>
<span id="cb7-2">    _df: pl.DataFrame, idx_colname: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DAY_OF_SEASON"</span></span>
<span id="cb7-3">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pl.DataFrame:</span>
<span id="cb7-4">    ...</span>
<span id="cb7-5"></span>
<span id="cb7-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # ------ Source ------</span></span>
<span id="cb7-7">    ax_notes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> axs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"notes"</span>]</span>
<span id="cb7-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add source</span></span>
<span id="cb7-9">    ax_notes.axis(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>)</span>
<span id="cb7-10">    ax_notes.text(</span>
<span id="cb7-11">        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb7-12">        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb7-13">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Source: NOAA"</span>,</span>
<span id="cb7-14">        fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>source_fontsize,</span>
<span id="cb7-15">        fontweight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>source_fontweight,</span>
<span id="cb7-16">        color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>grey,</span>
<span id="cb7-17">    )</span>
<span id="cb7-18">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> _df</span></code></pre></div>
</section>
</section>
<section id="rendering-the-plot" class="level2">
<h2 class="anchored" data-anchor-id="rendering-the-plot">Rendering the Plot</h2>
<p>Finally, we render the plot using <a href="https://docs.pola.rs/api/python/stable/reference/dataframe/api/polars.DataFrame.pipe.html#polars.DataFrame.pipe">pl.DataFrame.pipe()</a>:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">df.pipe(plot_temps, idx_colname)</span></code></pre></div>
</section>
<section id="wrapping-up" class="level2">
<h2 class="anchored" data-anchor-id="wrapping-up">Wrapping Up</h2>
<p>Recreating this figure with Polars turned out to be more involved than I initially expected. However, the process was incredibly rewarding, as it deepened my understanding of Pandas, Polars, and Matplotlib. Switching between Pandas and Polars required a shift in mindset, but it also reinforced key concepts in both libraries. I look forward to exploring more of these challenges in the future.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Disclaimer
</div>
</div>
<div class="callout-body-container callout-body">
<p>This post was drafted by me, with AI assistance to refine the content.</p>
</div>
</div>


</section>

 ]]></description>
  <category>python</category>
  <category>pandas</category>
  <category>polars</category>
  <category>matplotlib</category>
  <guid>https://tech.ycwu.space/posts/effective-dataviz-polars-alta-ski-resort/20250210.html</guid>
  <pubDate>Mon, 10 Feb 2025 00:00:00 GMT</pubDate>
  <media:content url="https://tech.ycwu.space/posts/effective-dataviz-polars-alta-ski-resort/alta_ski_resort.png" medium="image" type="image/png" height="149" width="144"/>
</item>
<item>
  <title>Three Approaches to Styling the Table Body in Great Tables</title>
  <dc:creator>Jerry Wu</dc:creator>
  <link>https://tech.ycwu.space/posts/style-table-body/20250124.html</link>
  <description><![CDATA[ 





<p>This post demonstrates three approaches to styling the table body:</p>
<ul>
<li><strong>Using a for-loop:</strong> Repeatedly call <code>GT.tab_style()</code> for each column.</li>
<li><strong>Utilizing the <code>locations=</code> parameter in <code>GT.tab_style()</code>:</strong> Pass a list of <code>loc.body()</code> objects.</li>
<li><strong>Leveraging the <code>mask=</code> parameter in <code>loc.body()</code>:</strong> Use Polars expressions for streamlined styling.</li>
</ul>
<p>Let’s dive in.</p>
<section id="preparations" class="level2">
<h2 class="anchored" data-anchor-id="preparations">Preparations</h2>
<p>We’ll use the built-in dataset <code>gtcars</code> to create a Polars DataFrame. First, we’ll select the columns <code>mfr</code>, <code>drivetrain</code>, <code>year</code>, and <code>hp</code> to create a small pivoted table named <code>df_mini</code>. Then, we’ll pass <code>df_mini</code> to the <code>GT</code> object and use <code>GT.tab_stub()</code>, setting <code>drivetrain</code> as <code>rowname_col=</code> and <code>mfr</code> as <code>groupname_col=</code> to create the table <code>gt</code>, as shown below:</p>
<div id="758111f3" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> polars <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pl</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> great_tables <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> GT, loc, style</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> great_tables.data <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> gtcars</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> polars <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> selectors <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> cs</span>
<span id="cb1-5"></span>
<span id="cb1-6">year_cols <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2014"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2015"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2016"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017"</span>]</span>
<span id="cb1-7">df_mini <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb1-8">    pl.from_pandas(gtcars)</span>
<span id="cb1-9">    .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mfr"</span>).is_in([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ferrari"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lamborghini"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BMW"</span>]))</span>
<span id="cb1-10">    .sort(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drivetrain"</span>)</span>
<span id="cb1-11">    .pivot(on<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mfr"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drivetrain"</span>], values<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hp"</span>, aggregate_function<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>)</span>
<span id="cb1-12">    .select([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mfr"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drivetrain"</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>year_cols])</span>
<span id="cb1-13">)</span>
<span id="cb1-14"></span>
<span id="cb1-15">gt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> GT(df_mini).tab_stub(rowname_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drivetrain"</span>, groupname_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mfr"</span>).opt_stylize()</span>
<span id="cb1-16">gt</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="1">
<div id="dyxoaaqeno" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#dyxoaaqeno table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#dyxoaaqeno thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#dyxoaaqeno p { margin: 0; padding: 0; }
 #dyxoaaqeno .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #004D80; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #004D80; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #dyxoaaqeno .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #dyxoaaqeno .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #dyxoaaqeno .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #dyxoaaqeno .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #dyxoaaqeno .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; }
 #dyxoaaqeno .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #dyxoaaqeno .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #dyxoaaqeno .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #dyxoaaqeno .gt_column_spanner_outer:first-child { padding-left: 0; }
 #dyxoaaqeno .gt_column_spanner_outer:last-child { padding-right: 0; }
 #dyxoaaqeno .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #dyxoaaqeno .gt_spanner_row { border-bottom-style: hidden; }
 #dyxoaaqeno .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #dyxoaaqeno .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; vertical-align: middle; }
 #dyxoaaqeno .gt_from_md> :first-child { margin-top: 0; }
 #dyxoaaqeno .gt_from_md> :last-child { margin-bottom: 0; }
 #dyxoaaqeno .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: none; border-top-width: 1px; border-top-color: #89D3FE; border-left-style: none; border-left-width: 1px; border-left-color: #89D3FE; border-right-style: none; border-right-width: 1px; border-right-color: #89D3FE; vertical-align: middle; overflow-x: hidden; }
 #dyxoaaqeno .gt_stub { color: #FFFFFF; background-color: #0076BA; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #0076BA; padding-left: 5px; padding-right: 5px; }
 #dyxoaaqeno .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #dyxoaaqeno .gt_row_group_first td { border-top-width: 2px; }
 #dyxoaaqeno .gt_row_group_first th { border-top-width: 2px; }
 #dyxoaaqeno .gt_striped { background-color: #F4F4F4; }
 #dyxoaaqeno .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; }
 #dyxoaaqeno .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #dyxoaaqeno .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #dyxoaaqeno .gt_left { text-align: left; }
 #dyxoaaqeno .gt_center { text-align: center; }
 #dyxoaaqeno .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #dyxoaaqeno .gt_font_normal { font-weight: normal; }
 #dyxoaaqeno .gt_font_bold { font-weight: bold; }
 #dyxoaaqeno .gt_font_italic { font-style: italic; }
 #dyxoaaqeno .gt_super { font-size: 65%; }
 #dyxoaaqeno .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #dyxoaaqeno .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>

<tr class="gt_col_headings">
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=""></th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="2014">2014</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="2015">2015</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="2016">2016</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="2017">2017</th>
</tr>
</thead>
<tbody class="gt_table_body">
  <tr class="gt_group_heading_row">
    <th class="gt_group_heading" colspan="5">Ferrari</th>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">awd</th>
    <td class="gt_row gt_right">None</td>
    <td class="gt_row gt_right">652.0</td>
    <td class="gt_row gt_right">None</td>
    <td class="gt_row gt_right">680.0</td>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">rwd</th>
    <td class="gt_row gt_right gt_striped">562.0</td>
    <td class="gt_row gt_right gt_striped">678.4</td>
    <td class="gt_row gt_right gt_striped">661.0</td>
    <td class="gt_row gt_right gt_striped">None</td>
  </tr>
  <tr class="gt_group_heading_row">
    <th class="gt_group_heading" colspan="5">Lamborghini</th>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">awd</th>
    <td class="gt_row gt_right gt_striped">None</td>
    <td class="gt_row gt_right gt_striped">700.0</td>
    <td class="gt_row gt_right gt_striped">None</td>
    <td class="gt_row gt_right gt_striped">None</td>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">rwd</th>
    <td class="gt_row gt_right">550.0</td>
    <td class="gt_row gt_right">610.0</td>
    <td class="gt_row gt_right">None</td>
    <td class="gt_row gt_right">None</td>
  </tr>
  <tr class="gt_group_heading_row">
    <th class="gt_group_heading" colspan="5">BMW</th>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">awd</th>
    <td class="gt_row gt_right">None</td>
    <td class="gt_row gt_right">None</td>
    <td class="gt_row gt_right">357.0</td>
    <td class="gt_row gt_right">None</td>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">rwd</th>
    <td class="gt_row gt_right gt_striped">None</td>
    <td class="gt_row gt_right gt_striped">None</td>
    <td class="gt_row gt_right gt_striped">465.0</td>
    <td class="gt_row gt_right gt_striped">None</td>
  </tr>
</tbody>


</table>

</div>
        
</div>
</div>
<p>The numbers in the cells represent the average horsepower for each combination of <code>mfr</code> and <code>drivetrain</code> for a specific year.</p>
<p>In the following section, we’ll demonstrate three different ways to highlight the cell text in red if the average horsepower exceeds 650.</p>
</section>
<section id="using-a-for-loop-repeatedly-call-gt.tab_style-for-each-column" class="level2">
<h2 class="anchored" data-anchor-id="using-a-for-loop-repeatedly-call-gt.tab_style-for-each-column">Using a For-Loop: Repeatedly Call <code>GT.tab_style()</code> for Each Column</h2>
<p>The most intuitive way is to call <code>GT.tab_style()</code> for each column. Here’s how:</p>
<div id="a788f1e6" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="annotated-cell-2" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-2-1" class="code-annotation-target">gt1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gt</span>
<span id="annotated-cell-2-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> col <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> year_cols:</span>
<span id="annotated-cell-2-3">    gt1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gt1.tab_style(</span>
<span id="annotated-cell-2-4">        style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.text(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>),</span>
<span id="annotated-cell-2-5">        locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body(columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>col, rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pl.col(col).gt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">650</span>))</span>
<span id="annotated-cell-2-6">    )</span>
<span id="annotated-cell-2-7">gt1</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="1" data-code-annotation="1">Since we want to keep <code>gt</code> intact for later use, we will modify <code>gt1</code> in this approach instead.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div id="uotbeucpdr" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#uotbeucpdr table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#uotbeucpdr thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#uotbeucpdr p { margin: 0; padding: 0; }
 #uotbeucpdr .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #004D80; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #004D80; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #uotbeucpdr .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #uotbeucpdr .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #uotbeucpdr .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #uotbeucpdr .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #uotbeucpdr .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; }
 #uotbeucpdr .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #uotbeucpdr .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #uotbeucpdr .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #uotbeucpdr .gt_column_spanner_outer:first-child { padding-left: 0; }
 #uotbeucpdr .gt_column_spanner_outer:last-child { padding-right: 0; }
 #uotbeucpdr .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #uotbeucpdr .gt_spanner_row { border-bottom-style: hidden; }
 #uotbeucpdr .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #uotbeucpdr .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; vertical-align: middle; }
 #uotbeucpdr .gt_from_md> :first-child { margin-top: 0; }
 #uotbeucpdr .gt_from_md> :last-child { margin-bottom: 0; }
 #uotbeucpdr .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: none; border-top-width: 1px; border-top-color: #89D3FE; border-left-style: none; border-left-width: 1px; border-left-color: #89D3FE; border-right-style: none; border-right-width: 1px; border-right-color: #89D3FE; vertical-align: middle; overflow-x: hidden; }
 #uotbeucpdr .gt_stub { color: #FFFFFF; background-color: #0076BA; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #0076BA; padding-left: 5px; padding-right: 5px; }
 #uotbeucpdr .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #uotbeucpdr .gt_row_group_first td { border-top-width: 2px; }
 #uotbeucpdr .gt_row_group_first th { border-top-width: 2px; }
 #uotbeucpdr .gt_striped { background-color: #F4F4F4; }
 #uotbeucpdr .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; }
 #uotbeucpdr .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #uotbeucpdr .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #uotbeucpdr .gt_left { text-align: left; }
 #uotbeucpdr .gt_center { text-align: center; }
 #uotbeucpdr .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #uotbeucpdr .gt_font_normal { font-weight: normal; }
 #uotbeucpdr .gt_font_bold { font-weight: bold; }
 #uotbeucpdr .gt_font_italic { font-style: italic; }
 #uotbeucpdr .gt_super { font-size: 65%; }
 #uotbeucpdr .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #uotbeucpdr .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>

<tr class="gt_col_headings">
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=""></th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="2014">2014</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="2015">2015</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="2016">2016</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="2017">2017</th>
</tr>
</thead>
<tbody class="gt_table_body">
  <tr class="gt_group_heading_row">
    <th class="gt_group_heading" colspan="5">Ferrari</th>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">awd</th>
    <td class="gt_row gt_right">None</td>
    <td style="color: red;" class="gt_row gt_right">652.0</td>
    <td class="gt_row gt_right">None</td>
    <td style="color: red;" class="gt_row gt_right">680.0</td>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">rwd</th>
    <td class="gt_row gt_right gt_striped">562.0</td>
    <td style="color: red;" class="gt_row gt_right gt_striped">678.4</td>
    <td style="color: red;" class="gt_row gt_right gt_striped">661.0</td>
    <td class="gt_row gt_right gt_striped">None</td>
  </tr>
  <tr class="gt_group_heading_row">
    <th class="gt_group_heading" colspan="5">Lamborghini</th>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">awd</th>
    <td class="gt_row gt_right gt_striped">None</td>
    <td style="color: red;" class="gt_row gt_right gt_striped">700.0</td>
    <td class="gt_row gt_right gt_striped">None</td>
    <td class="gt_row gt_right gt_striped">None</td>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">rwd</th>
    <td class="gt_row gt_right">550.0</td>
    <td class="gt_row gt_right">610.0</td>
    <td class="gt_row gt_right">None</td>
    <td class="gt_row gt_right">None</td>
  </tr>
  <tr class="gt_group_heading_row">
    <th class="gt_group_heading" colspan="5">BMW</th>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">awd</th>
    <td class="gt_row gt_right">None</td>
    <td class="gt_row gt_right">None</td>
    <td class="gt_row gt_right">357.0</td>
    <td class="gt_row gt_right">None</td>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">rwd</th>
    <td class="gt_row gt_right gt_striped">None</td>
    <td class="gt_row gt_right gt_striped">None</td>
    <td class="gt_row gt_right gt_striped">465.0</td>
    <td class="gt_row gt_right gt_striped">None</td>
  </tr>
</tbody>


</table>

</div>
        
</div>
</div>
</section>
<section id="utilizing-the-locations-parameter-in-gt.tab_style-pass-a-list-of-loc.body-objects" class="level2">
<h2 class="anchored" data-anchor-id="utilizing-the-locations-parameter-in-gt.tab_style-pass-a-list-of-loc.body-objects">Utilizing the <code>locations=</code> Parameter in <code>GT.tab_style()</code>: Pass a List of <code>loc.body()</code> Objects</h2>
<p>A more concise method is to pass a list of <code>loc.body()</code> objects to the <code>locations=</code> parameter in <code>GT.tab_style()</code>, as shown below:</p>
<div id="96f866ed" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">(</span>
<span id="cb2-2">    gt.tab_style(</span>
<span id="cb2-3">        style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.text(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>),</span>
<span id="cb2-4">        locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb2-5">            loc.body(columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>col, rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pl.col(col).gt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">650</span>))</span>
<span id="cb2-6">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> col <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> year_cols</span>
<span id="cb2-7">        ],</span>
<span id="cb2-8">    )</span>
<span id="cb2-9">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div id="qkdnbefkpt" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#qkdnbefkpt table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#qkdnbefkpt thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#qkdnbefkpt p { margin: 0; padding: 0; }
 #qkdnbefkpt .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #004D80; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #004D80; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #qkdnbefkpt .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #qkdnbefkpt .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #qkdnbefkpt .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #qkdnbefkpt .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #qkdnbefkpt .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; }
 #qkdnbefkpt .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #qkdnbefkpt .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #qkdnbefkpt .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #qkdnbefkpt .gt_column_spanner_outer:first-child { padding-left: 0; }
 #qkdnbefkpt .gt_column_spanner_outer:last-child { padding-right: 0; }
 #qkdnbefkpt .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #qkdnbefkpt .gt_spanner_row { border-bottom-style: hidden; }
 #qkdnbefkpt .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #qkdnbefkpt .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; vertical-align: middle; }
 #qkdnbefkpt .gt_from_md> :first-child { margin-top: 0; }
 #qkdnbefkpt .gt_from_md> :last-child { margin-bottom: 0; }
 #qkdnbefkpt .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: none; border-top-width: 1px; border-top-color: #89D3FE; border-left-style: none; border-left-width: 1px; border-left-color: #89D3FE; border-right-style: none; border-right-width: 1px; border-right-color: #89D3FE; vertical-align: middle; overflow-x: hidden; }
 #qkdnbefkpt .gt_stub { color: #FFFFFF; background-color: #0076BA; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #0076BA; padding-left: 5px; padding-right: 5px; }
 #qkdnbefkpt .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #qkdnbefkpt .gt_row_group_first td { border-top-width: 2px; }
 #qkdnbefkpt .gt_row_group_first th { border-top-width: 2px; }
 #qkdnbefkpt .gt_striped { background-color: #F4F4F4; }
 #qkdnbefkpt .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; }
 #qkdnbefkpt .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #qkdnbefkpt .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #qkdnbefkpt .gt_left { text-align: left; }
 #qkdnbefkpt .gt_center { text-align: center; }
 #qkdnbefkpt .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #qkdnbefkpt .gt_font_normal { font-weight: normal; }
 #qkdnbefkpt .gt_font_bold { font-weight: bold; }
 #qkdnbefkpt .gt_font_italic { font-style: italic; }
 #qkdnbefkpt .gt_super { font-size: 65%; }
 #qkdnbefkpt .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #qkdnbefkpt .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>

<tr class="gt_col_headings">
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=""></th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="2014">2014</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="2015">2015</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="2016">2016</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="2017">2017</th>
</tr>
</thead>
<tbody class="gt_table_body">
  <tr class="gt_group_heading_row">
    <th class="gt_group_heading" colspan="5">Ferrari</th>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">awd</th>
    <td class="gt_row gt_right">None</td>
    <td style="color: red;" class="gt_row gt_right">652.0</td>
    <td class="gt_row gt_right">None</td>
    <td style="color: red;" class="gt_row gt_right">680.0</td>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">rwd</th>
    <td class="gt_row gt_right gt_striped">562.0</td>
    <td style="color: red;" class="gt_row gt_right gt_striped">678.4</td>
    <td style="color: red;" class="gt_row gt_right gt_striped">661.0</td>
    <td class="gt_row gt_right gt_striped">None</td>
  </tr>
  <tr class="gt_group_heading_row">
    <th class="gt_group_heading" colspan="5">Lamborghini</th>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">awd</th>
    <td class="gt_row gt_right gt_striped">None</td>
    <td style="color: red;" class="gt_row gt_right gt_striped">700.0</td>
    <td class="gt_row gt_right gt_striped">None</td>
    <td class="gt_row gt_right gt_striped">None</td>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">rwd</th>
    <td class="gt_row gt_right">550.0</td>
    <td class="gt_row gt_right">610.0</td>
    <td class="gt_row gt_right">None</td>
    <td class="gt_row gt_right">None</td>
  </tr>
  <tr class="gt_group_heading_row">
    <th class="gt_group_heading" colspan="5">BMW</th>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">awd</th>
    <td class="gt_row gt_right">None</td>
    <td class="gt_row gt_right">None</td>
    <td class="gt_row gt_right">357.0</td>
    <td class="gt_row gt_right">None</td>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">rwd</th>
    <td class="gt_row gt_right gt_striped">None</td>
    <td class="gt_row gt_right gt_striped">None</td>
    <td class="gt_row gt_right gt_striped">465.0</td>
    <td class="gt_row gt_right gt_striped">None</td>
  </tr>
</tbody>


</table>

</div>
        
</div>
</div>
</section>
<section id="leveraging-the-mask-parameter-in-loc.body-use-polars-expressions-for-streamlined-styling" class="level2">
<h2 class="anchored" data-anchor-id="leveraging-the-mask-parameter-in-loc.body-use-polars-expressions-for-streamlined-styling">Leveraging the <code>mask=</code> Parameter in <code>loc.body()</code>: Use Polars Expressions for Streamlined Styling</h2>
<p>The most modern approach (<code>0.16.0</code>) is to pass a Polars expression to the <code>mask=</code> parameter in <code>loc.body()</code>, as illustrated here:</p>
<div id="ad73d5ce" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">(</span>
<span id="cb3-2">    gt.tab_style(</span>
<span id="cb3-3">        style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>style.text(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>),</span>
<span id="cb3-4">        locations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc.body(mask<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>cs.numeric().gt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">650</span>))</span>
<span id="cb3-5">    )</span>
<span id="cb3-6">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div id="zhqhxocxtn" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#zhqhxocxtn table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#zhqhxocxtn thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#zhqhxocxtn p { margin: 0; padding: 0; }
 #zhqhxocxtn .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #004D80; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #004D80; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #zhqhxocxtn .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #zhqhxocxtn .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #zhqhxocxtn .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #zhqhxocxtn .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #zhqhxocxtn .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; }
 #zhqhxocxtn .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #zhqhxocxtn .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #zhqhxocxtn .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #zhqhxocxtn .gt_column_spanner_outer:first-child { padding-left: 0; }
 #zhqhxocxtn .gt_column_spanner_outer:last-child { padding-right: 0; }
 #zhqhxocxtn .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #zhqhxocxtn .gt_spanner_row { border-bottom-style: hidden; }
 #zhqhxocxtn .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #zhqhxocxtn .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; vertical-align: middle; }
 #zhqhxocxtn .gt_from_md> :first-child { margin-top: 0; }
 #zhqhxocxtn .gt_from_md> :last-child { margin-bottom: 0; }
 #zhqhxocxtn .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: none; border-top-width: 1px; border-top-color: #89D3FE; border-left-style: none; border-left-width: 1px; border-left-color: #89D3FE; border-right-style: none; border-right-width: 1px; border-right-color: #89D3FE; vertical-align: middle; overflow-x: hidden; }
 #zhqhxocxtn .gt_stub { color: #FFFFFF; background-color: #0076BA; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #0076BA; padding-left: 5px; padding-right: 5px; }
 #zhqhxocxtn .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #zhqhxocxtn .gt_row_group_first td { border-top-width: 2px; }
 #zhqhxocxtn .gt_row_group_first th { border-top-width: 2px; }
 #zhqhxocxtn .gt_striped { background-color: #F4F4F4; }
 #zhqhxocxtn .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #0076BA; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #0076BA; }
 #zhqhxocxtn .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #zhqhxocxtn .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #zhqhxocxtn .gt_left { text-align: left; }
 #zhqhxocxtn .gt_center { text-align: center; }
 #zhqhxocxtn .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #zhqhxocxtn .gt_font_normal { font-weight: normal; }
 #zhqhxocxtn .gt_font_bold { font-weight: bold; }
 #zhqhxocxtn .gt_font_italic { font-style: italic; }
 #zhqhxocxtn .gt_super { font-size: 65%; }
 #zhqhxocxtn .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #zhqhxocxtn .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>

<tr class="gt_col_headings">
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=""></th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="2014">2014</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="2015">2015</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="2016">2016</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="2017">2017</th>
</tr>
</thead>
<tbody class="gt_table_body">
  <tr class="gt_group_heading_row">
    <th class="gt_group_heading" colspan="5">Ferrari</th>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">awd</th>
    <td class="gt_row gt_right">None</td>
    <td style="color: red;" class="gt_row gt_right">652.0</td>
    <td class="gt_row gt_right">None</td>
    <td style="color: red;" class="gt_row gt_right">680.0</td>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">rwd</th>
    <td class="gt_row gt_right gt_striped">562.0</td>
    <td style="color: red;" class="gt_row gt_right gt_striped">678.4</td>
    <td style="color: red;" class="gt_row gt_right gt_striped">661.0</td>
    <td class="gt_row gt_right gt_striped">None</td>
  </tr>
  <tr class="gt_group_heading_row">
    <th class="gt_group_heading" colspan="5">Lamborghini</th>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">awd</th>
    <td class="gt_row gt_right gt_striped">None</td>
    <td style="color: red;" class="gt_row gt_right gt_striped">700.0</td>
    <td class="gt_row gt_right gt_striped">None</td>
    <td class="gt_row gt_right gt_striped">None</td>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">rwd</th>
    <td class="gt_row gt_right">550.0</td>
    <td class="gt_row gt_right">610.0</td>
    <td class="gt_row gt_right">None</td>
    <td class="gt_row gt_right">None</td>
  </tr>
  <tr class="gt_group_heading_row">
    <th class="gt_group_heading" colspan="5">BMW</th>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">awd</th>
    <td class="gt_row gt_right">None</td>
    <td class="gt_row gt_right">None</td>
    <td class="gt_row gt_right">357.0</td>
    <td class="gt_row gt_right">None</td>
  </tr>
  <tr>
    <th class="gt_row gt_left gt_stub">rwd</th>
    <td class="gt_row gt_right gt_striped">None</td>
    <td class="gt_row gt_right gt_striped">None</td>
    <td class="gt_row gt_right gt_striped">465.0</td>
    <td class="gt_row gt_right gt_striped">None</td>
  </tr>
</tbody>


</table>

</div>
        
</div>
</div>
<p>In this example, <code>loc.body()</code> is smart enough to automatically target the rows where the cell value exceeds 650 for each numerical column. In general, you can think of <code>mask=</code> as a syntactic sugar that Great Tables provides to save you from having to manually loop through the columns.</p>
</section>
<section id="final-words" class="level2">
<h2 class="anchored" data-anchor-id="final-words">Final Words</h2>
<p>This post summarizes three approaches to styling the table body. Among them, the <code>mask=</code> parameter in <code>loc.body()</code> is definitely my favorite, inspired by <a href="https://github.com/posit-dev/great-tables/issues/389">#389</a> and implemented by me.</p>
<p>Special thanks to <a href="https://github.com/rich-iannone"><span class="citation" data-cites="rich-iannone">@rich-iannone</span></a> and <a href="https://github.com/machow"><span class="citation" data-cites="machow">@machow</span></a> for their invaluable suggestions during development. Any remaining bugs are entirely on me.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Disclaimer
</div>
</div>
<div class="callout-body-container callout-body">
<p>This post was drafted by me, with AI assistance to refine the content.</p>
</div>
</div>


</section>

 ]]></description>
  <category>python</category>
  <category>polars</category>
  <category>gt</category>
  <guid>https://tech.ycwu.space/posts/style-table-body/20250124.html</guid>
  <pubDate>Fri, 24 Jan 2025 00:00:00 GMT</pubDate>
  <media:content url="https://tech.ycwu.space/posts/style-table-body/table_body.png" medium="image" type="image/png" height="210" width="144"/>
</item>
<item>
  <title>Exploring Resend SMTP Service with Django</title>
  <dc:creator>Jerry Wu</dc:creator>
  <link>https://tech.ycwu.space/posts/django-allauth-resend/20241223.html</link>
  <description><![CDATA[ 





<p>This post demonstrates how to integrate <a href="https://resend.com/">Resend</a> with <a href="https://docs.allauth.org/en/latest/">django-allauth</a> seamlessly in a <code>Django</code> project. If you’re looking to use <code>Resend</code> for sending emails via <code>Django</code>, refer to the <a href="https://github.com/resend/resend-django-smtp-example">repo</a> provided by <code>Resend</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The code featured in this post is available in this <a href="https://github.com/jrycw/django-allauth-resend-demo/">repo</a>.</p>
</div>
</div>
<section id="preparations-for-django" class="level2">
<h2 class="anchored" data-anchor-id="preparations-for-django">Preparations for Django</h2>
<section id="create-a-virtual-environment" class="level3">
<h3 class="anchored" data-anchor-id="create-a-virtual-environment">Create a Virtual Environment</h3>
<p>Start by creating a virtual environment using <a href="https://github.com/astral-sh/uv">uv</a> and activating it:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uv</span> venv venv</span>
<span id="cb1-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">source</span> venv/bin/activate</span></code></pre></div>
</section>
<section id="install-required-packages" class="level3">
<h3 class="anchored" data-anchor-id="install-required-packages">Install Required Packages</h3>
<p>Create a <code>requirements.txt</code> file and add the necessary dependencies:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">django</span>
<span id="cb2-2">environs[django]</span>
<span id="cb2-3">django<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>allauth</span></code></pre></div>
<p>Install the packages via <code>uv</code>:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uv</span> pip install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> requirements.txt</span></code></pre></div>
</section>
<section id="set-up-a-django-project" class="level3">
<h3 class="anchored" data-anchor-id="set-up-a-django-project">Set Up a Django Project</h3>
<p>Use the <code>django-admin</code> command to create a project named <code>core</code>:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">django-admin</span> startproject core .</span></code></pre></div>
</section>
<section id="configure-environment-variables" class="level3">
<h3 class="anchored" data-anchor-id="configure-environment-variables">Configure Environment Variables</h3>
<p>Create a <code>.env</code> file with the following content:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">DEFAULT_FROM_EMAIL<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span></span>
<span id="cb5-2">RESEND_SMTP_HOST<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>smtp.resend.com</span>
<span id="cb5-3">RESEND_SMTP_USERNAME<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>resend</span>
<span id="cb5-4">RESEND_API_KEY<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span></span>
<span id="cb5-5">RESEND_SMTP_PORT<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">587</span></span>
<span id="cb5-6">RESEND_USE_TLS<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span></code></pre></div>
<p>The next sections explain how to obtain <code>DEFAULT_FROM_EMAIL</code> and <code>RESEND_API_KEY</code>.</p>
<hr>
</section>
</section>
<section id="preparations-for-resend" class="level2">
<h2 class="anchored" data-anchor-id="preparations-for-resend">Preparations for Resend</h2>
<section id="verify-your-domain" class="level3">
<h3 class="anchored" data-anchor-id="verify-your-domain">Verify Your Domain</h3>
<p>Follow the <a href="https://resend.com/docs/dashboard/domains/introduction">Resend documentation</a> to verify your domain. Once verified, you can send emails using an address like <code>user@send.yourdomain.com</code>.</p>
<ul>
<li>You control the prefix before <code>@</code>, as ownership of the domain has been confirmed.<br>
</li>
<li>Add your chosen email to <code>DEFAULT_FROM_EMAIL</code> in the <code>.env</code> file.</li>
</ul>
</section>
<section id="obtain-an-api-key" class="level3">
<h3 class="anchored" data-anchor-id="obtain-an-api-key">Obtain an API Key</h3>
<p>Generate an API key via the <a href="https://resend.com/api-keys">Resend API Keys page</a> and add it to the <code>RESEND_API_KEY</code> field in your <code>.env</code> file.</p>
</section>
</section>
<section id="django-scaffold" class="level2">
<h2 class="anchored" data-anchor-id="django-scaffold">Django Scaffold</h2>
<p>Follow the <a href="https://docs.allauth.org/en/latest/installation/quickstart.html">quick start guide</a> from <code>django-allauth</code> to configure the project with minimal setup.</p>
<section id="modify-coreurls.py" class="level3">
<h3 class="anchored" data-anchor-id="modify-coreurls.py">Modify <code>core/urls.py</code></h3>
<p>Include <code>django-allauth</code> routes and define a homepage route:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/urls.py</span></span>
<span id="cb6-2"></span>
<span id="cb6-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> django.contrib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> admin</span>
<span id="cb6-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> django.urls <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> path, include</span>
<span id="cb6-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> . <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> views</span>
<span id="cb6-6"></span>
<span id="cb6-7">urlpatterns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb6-8">    path(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"admin/"</span>, admin.site.urls),</span>
<span id="cb6-9">    path(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accounts/"</span>, include(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"allauth.urls"</span>)),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># added</span></span>
<span id="cb6-10">    path(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, views.index, name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"home"</span>),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># added</span></span>
<span id="cb6-11">]</span></code></pre></div>
</section>
<section id="add-coreviews.py" class="level3">
<h3 class="anchored" data-anchor-id="add-coreviews.py">Add <code>core/views.py</code></h3>
<p>Define the homepage with a link to the signup URL provided by <code>django-allauth</code>:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> django.http <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> HttpResponse</span>
<span id="cb7-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> django.urls <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> reverse</span>
<span id="cb7-3"></span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> index(request):</span>
<span id="cb7-6">    signup_url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> reverse(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"account_signup"</span>)</span>
<span id="cb7-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> HttpResponse(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'&lt;a href="</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>signup_url<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;Hello, please Sign Up here!&lt;/a&gt;'</span>)</span></code></pre></div>
</section>
<section id="modify-coresettings.py" class="level3">
<h3 class="anchored" data-anchor-id="modify-coresettings.py">Modify <code>core/settings.py</code></h3>
<section id="read-environment-variables" class="level4">
<h4 class="anchored" data-anchor-id="read-environment-variables">Read Environment Variables</h4>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/settings.py</span></span>
<span id="cb8-2"></span>
<span id="cb8-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> environs <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Env</span>
<span id="cb8-4"></span>
<span id="cb8-5">env <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Env()</span>
<span id="cb8-6">env.read_env()</span></code></pre></div>
</section>
<section id="update-installed_apps" class="level4">
<h4 class="anchored" data-anchor-id="update-installed_apps">Update INSTALLED_APPS</h4>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/settings.py</span></span>
<span id="cb9-2"></span>
<span id="cb9-3">INSTALLED_APPS <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb9-4">    ...</span>
<span id="cb9-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"allauth"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># added</span></span>
<span id="cb9-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"allauth.account"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># added</span></span>
<span id="cb9-7">]</span></code></pre></div>
</section>
<section id="update-middleware" class="level4">
<h4 class="anchored" data-anchor-id="update-middleware">Update MIDDLEWARE</h4>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/settings.py</span></span>
<span id="cb10-2"></span>
<span id="cb10-3">MIDDLEWARE <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb10-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"django.middleware.security.SecurityMiddleware"</span>,</span>
<span id="cb10-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"django.contrib.sessions.middleware.SessionMiddleware"</span>,</span>
<span id="cb10-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"django.middleware.common.CommonMiddleware"</span>,</span>
<span id="cb10-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"django.middleware.csrf.CsrfViewMiddleware"</span>,</span>
<span id="cb10-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"django.contrib.auth.middleware.AuthenticationMiddleware"</span>,</span>
<span id="cb10-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"django.contrib.messages.middleware.MessageMiddleware"</span>,</span>
<span id="cb10-10">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"allauth.account.middleware.AccountMiddleware"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># added</span></span>
<span id="cb10-11">    ...</span>
<span id="cb10-12">]</span></code></pre></div>
</section>
<section id="configure-email-backend-and-authentication-backends" class="level4">
<h4 class="anchored" data-anchor-id="configure-email-backend-and-authentication-backends">Configure Email Backend and Authentication Backends</h4>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/settings.py</span></span>
<span id="cb11-2"></span>
<span id="cb11-3">EMAIL_BACKEND <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"django.core.mail.backends.smtp.EmailBackend"</span></span>
<span id="cb11-4"></span>
<span id="cb11-5">AUTHENTICATION_BACKENDS <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb11-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"django.contrib.auth.backends.ModelBackend"</span>,</span>
<span id="cb11-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"allauth.account.auth_backends.AuthenticationBackend"</span>,</span>
<span id="cb11-8">]</span></code></pre></div>
</section>
<section id="define-login-and-logout-redirect-urls" class="level4">
<h4 class="anchored" data-anchor-id="define-login-and-logout-redirect-urls">Define Login and Logout Redirect URLs</h4>
<p>Here, we define only <code>ACCOUNT_LOGOUT_REDIRECT_URL</code> because <code>django-allauth</code> overwrites <code>LOGOUT_REDIRECT_URL</code>.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">LOGIN_REDIRECT_URL <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"home"</span></span>
<span id="cb12-2">ACCOUNT_LOGOUT_REDIRECT_URL <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"home"</span></span></code></pre></div>
</section>
<section id="optional-preference-settings" class="level4">
<h4 class="anchored" data-anchor-id="optional-preference-settings">Optional Preference Settings</h4>
<p>Opinionated configurations for a simplified signup and email-based login:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">ACCOUNT_SIGNUP_PASSWORD_ENTER_TWICE <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span></span>
<span id="cb13-2">ACCOUNT_USERNAME_REQUIRED <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span></span>
<span id="cb13-3">ACCOUNT_AUTHENTICATION_METHOD <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"email"</span></span>
<span id="cb13-4">ACCOUNT_EMAIL_REQUIRED <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb13-5">ACCOUNT_UNIQUE_EMAIL <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span></code></pre></div>
</section>
<section id="define-resend-variables" class="level4">
<h4 class="anchored" data-anchor-id="define-resend-variables">Define Resend Variables</h4>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">DEFAULT_FROM_EMAIL <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> env(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DEFAULT_FROM_EMAIL"</span>)</span>
<span id="cb14-2">RESEND_SMTP_HOST <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> env(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RESEND_SMTP_HOST"</span>)</span>
<span id="cb14-3">RESEND_SMTP_USERNAME <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> env(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RESEND_SMTP_USERNAME"</span>)</span>
<span id="cb14-4">RESEND_API_KEY <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> env(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RESEND_API_KEY"</span>)</span>
<span id="cb14-5">RESEND_SMTP_PORT <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> env.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RESEND_SMTP_PORT"</span>)</span>
<span id="cb14-6">RESEND_USE_TLS <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> env.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RESEND_USE_TLS"</span>)</span></code></pre></div>
</section>
<section id="map-resend-variables-to-django-email-variables" class="level4">
<h4 class="anchored" data-anchor-id="map-resend-variables-to-django-email-variables">Map Resend Variables to Django Email Variables</h4>
<p>Delegate <code>Django</code> email settings to <code>Resend</code> environment variables:</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">EMAIL_HOST <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> RESEND_SMTP_HOST</span>
<span id="cb15-2">EMAIL_HOST_USER <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> RESEND_SMTP_USERNAME</span>
<span id="cb15-3">EMAIL_HOST_PASSWORD <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> RESEND_API_KEY</span>
<span id="cb15-4">EMAIL_PORT <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> RESEND_SMTP_PORT</span>
<span id="cb15-5">EMAIL_USE_TLS <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> RESEND_USE_TLS</span></code></pre></div>
</section>
</section>
</section>
<section id="tryout" class="level2">
<h2 class="anchored" data-anchor-id="tryout">Tryout</h2>
<p>Migrate the database and run the development server with the following commands:</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">python</span> manage.py migrate</span>
<span id="cb16-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">python</span> manage.py runserver</span></code></pre></div>
<p>Now, go to <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> and click the sign-up link. You should see the signup page. After submitting the form, you will be redirected to the homepage.</p>
<p>Next, check your inbox for an email with the subject <code>[127.0.0.1:8000] Please Confirm Your Email Address</code>.</p>
<p>The email will contain a confirmation link. Click the link, then click the confirmation button, and you’re all set for user registration!</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you encounter issues during configuration, the <a href="https://resend.com/logs">Resend logs</a> can be a helpful resource, as they provide the request body, response body, and status code. <img src="https://tech.ycwu.space/posts/django-allauth-resend/resend_logs.png" class="img-fluid" alt="resend_logs.png"></p>
</div>
</div>
</section>
<section id="final-words" class="level2">
<h2 class="anchored" data-anchor-id="final-words">Final Words</h2>
<p>The configuration is straightforward, and it’s great that <code>Resend</code> offers SMTP services. The modern dashboard operates smoothly, and the well-documented resources make it easy for developers to find needed information. So far, the user experience has been positive, and I look forward to using it in real projects.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Disclaimer
</div>
</div>
<div class="callout-body-container callout-body">
<p>This post was drafted by me, with AI assistance to refine the content.</p>
</div>
</div>


</section>

 ]]></description>
  <category>python</category>
  <category>django</category>
  <category>resend</category>
  <guid>https://tech.ycwu.space/posts/django-allauth-resend/20241223.html</guid>
  <pubDate>Mon, 23 Dec 2024 00:00:00 GMT</pubDate>
  <media:content url="https://tech.ycwu.space/posts/django-allauth-resend/resend_logs.png" medium="image" type="image/png" height="55" width="144"/>
</item>
</channel>
</rss>
